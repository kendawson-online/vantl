{"version":3,"file":"timeline.min.js","sources":["../src/js/shared/state.js","../src/js/features/modals.js","../src/js/features/deep-linking.js","../src/js/shared/config.js","../src/js/features/error-ui.js","../src/js/shared/utils.js","../src/js/features/colors.js","../src/js/core/timeline-engine.js","../src/js/features/data-loader.js","../src/js/shared/lipsum.js","../src/js/timeline.js"],"sourcesContent":["export const modalState = {\n  modal: null,\n  overlay: null\n};\n\n// Global registry to store timeline instances for programmatic navigation\nexport const timelineRegistry = {};\n","import { modalState } from '../shared/state.js';\n\nexport function createTimelineModal() {\n  if (modalState.modal) return;\n\n  modalState.overlay = document.createElement('div');\n  modalState.overlay.className = 'timeline-modal-overlay';\n  modalState.overlay.addEventListener('click', closeTimelineModal);\n\n  modalState.modal = document.createElement('div');\n  modalState.modal.className = 'timeline-modal';\n  modalState.modal.innerHTML = `\n    <button class=\"timeline-modal__close\" aria-label=\"Close modal\"></button>\n    <div class=\"timeline-modal__content\">\n      <img class=\"timeline-modal__image\" src=\"\" alt=\"\" loading=\"lazy\" style=\"display: none;\">\n      <h2 class=\"timeline-modal__title\"></h2>\n      <div class=\"timeline-modal__text\"></div>\n    </div>\n    <div class=\"timeline-modal__footer\">\n      <button class=\"timeline-modal__close-bottom\">Close</button>\n    </div>\n  `;\n\n  const closeBtn = modalState.modal.querySelector('.timeline-modal__close');\n  const closeBottomBtn = modalState.modal.querySelector('.timeline-modal__close-bottom');\n  closeBtn.addEventListener('click', closeTimelineModal);\n  closeBottomBtn.addEventListener('click', closeTimelineModal);\n\n  modalState.modal.addEventListener('click', function(e) {\n    e.stopPropagation();\n  });\n\n  document.body.appendChild(modalState.overlay);\n  document.body.appendChild(modalState.modal);\n\n  document.addEventListener('keydown', function(e) {\n    if (e.key === 'Escape' && modalState.modal.classList.contains('timeline-modal-show')) {\n      closeTimelineModal();\n    }\n  });\n}\n\nexport function openTimelineModal(itemEl) {\n  if (!modalState.modal) {\n    createTimelineModal();\n  }\n\n  const title = itemEl.getAttribute('data-modal-title');\n  const content = itemEl.getAttribute('data-modal-content');\n  const image = itemEl.getAttribute('data-modal-image');\n  const html = itemEl.getAttribute('data-modal-html');\n\n  const modalTitle = modalState.modal.querySelector('.timeline-modal__title');\n  const modalText = modalState.modal.querySelector('.timeline-modal__text');\n  const modalImage = modalState.modal.querySelector('.timeline-modal__image');\n\n  modalTitle.textContent = title || '';\n\n  if (image) {\n    modalImage.src = image;\n    modalImage.alt = title || '';\n    modalImage.style.display = 'block';\n  } else {\n    modalImage.style.display = 'none';\n  }\n\n  if (html) {\n    modalText.innerHTML = html;\n  } else if (content) {\n    modalText.innerHTML = '<p>' + content.replace(/\\n/g, '</p><p>') + '</p>';\n  } else {\n    modalText.innerHTML = '';\n  }\n\n  setTimeout(function() {\n    modalState.modal.classList.add('timeline-modal-show');\n    modalState.overlay.classList.add('timeline-modal-show');\n    document.body.style.overflow = 'hidden';\n  }, 10);\n}\n\nexport function closeTimelineModal() {\n  if (modalState.modal) {\n    modalState.modal.classList.remove('timeline-modal-show');\n    modalState.overlay.classList.remove('timeline-modal-show');\n    document.body.style.overflow = '';\n  }\n}\n","import { timelineRegistry } from '../shared/state.js';\n\nexport function handleDeepLinking(containerSelector) {\n  const urlParams = new URLSearchParams(window.location.search);\n  const timelineId = urlParams.get('timeline');\n  const nodeId = urlParams.get('id');\n  if (!nodeId) return;\n\n  let targetContainer;\n  if (timelineId) {\n    targetContainer = document.getElementById(timelineId);\n  } else {\n    targetContainer = document.querySelector(containerSelector);\n  }\n\n  if (!targetContainer) {\n    console.warn('Timeline not found for deep linking:', timelineId || containerSelector);\n    return;\n  }\n\n  targetContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\n  const targetNode = targetContainer.querySelector('[data-node-id=\"' + nodeId + '\"]');\n  if (targetNode) {\n    setTimeout(function() {\n      // Ensure only one active item is highlighted in this timeline\n      targetContainer.querySelectorAll('.timeline__item--active').forEach((n) => n.classList.remove('timeline__item--active'));\n      targetNode.classList.add('timeline__item--active');\n      const itemIndex = Array.from(targetNode.parentNode.children).indexOf(targetNode);\n      navigateToNodeIndex(targetContainer, itemIndex);\n    }, 500);\n  }\n}\n\nexport function navigateToNodeIndex(container, index) {\n  if (!container) return;\n  const timelineId = container.id || container.getAttribute('data-timeline-id');\n  if (!timelineId) {\n    console.warn('Cannot navigate: timeline container has no ID');\n    return;\n  }\n\n  const tlData = timelineRegistry[timelineId];\n  if (!tlData) {\n    console.warn('Timeline not found in registry:', timelineId);\n    return;\n  }\n\n  if (!container.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  if (tlData.setCurrentIndex && tlData.updatePosition) {\n    tlData.setCurrentIndex(index);\n    tlData.updatePosition();\n  }\n}\n","// Shared configuration values\n// Auto-detect the timeline.js script location to build correct image paths\nexport const timelineBasePath = (function() {\n  // Check for user override\n  if (typeof window !== 'undefined' && \n      window.TimelineConfig && \n      window.TimelineConfig.basePath) {\n    return window.TimelineConfig.basePath;\n  }\n  \n  const scripts = document.getElementsByTagName('script');\n  for (let i = 0; i < scripts.length; i++) {\n    const src = scripts[i].src || '';\n    if (!src) continue;\n    const dir = src.substring(0, src.lastIndexOf('/'));\n    if (src.indexOf('timeline.min.js') !== -1) {\n      // When loading from dist, map to src/images\n      return dir.replace('/dist', '/src/images');\n    }\n    if (src.indexOf('timeline.js') !== -1) {\n      // When loading from src/js, map to src/images\n      return dir.replace('/js', '/images');\n    }\n  }\n  // Fallback relative to demo pages; most demos live under demo/**\n  return '../src/images';\n})();\n\n// Minimum time (ms) to keep the loading spinner visible\n","import { timelineBasePath } from '../shared/config.js';\n\nexport function showTimelineError(container, errorType, details) {\n  if (!container) return;\n\n  const errorMessages = {\n    'json-load': {\n      title: 'Timeline Data Could Not Be Loaded',\n      message: 'The timeline data failed to load. This could be due to a network error or an incorrect file path.',\n      solution: 'Please check that the data-json-config path is correct and the file is accessible.'\n    },\n    'json-parse': {\n      title: 'Invalid Timeline Data',\n      message: 'The timeline data file exists but contains invalid JSON.',\n      solution: 'Please validate your JSON using a tool like jsonlint.com and ensure it follows the correct schema.'\n    },\n    'missing-element': {\n      title: 'Timeline Element Not Found',\n      message: 'The required timeline container element could not be found on the page.',\n      solution: 'Ensure your HTML includes a container with the class \"timeline\" and the correct selector.'\n    },\n    'invalid-config': {\n      title: 'Invalid Configuration',\n      message: 'One or more timeline configuration options are invalid.',\n      solution: 'Check your data attributes or JavaScript options and ensure they match the expected format.'\n    }\n  };\n\n  const errorInfo = errorMessages[errorType] || {\n    title: 'Timeline Error',\n    message: 'An unexpected error occurred while initializing the timeline.',\n    solution: 'Please check the browser console for more details.'\n  };\n\n  // mark container as error state so timeline visuals (lines, nav buttons) can be hidden via CSS\n  container.classList.add('timeline--error');\n  container.innerHTML = '';\n\n  const errorDiv = document.createElement('div');\n  errorDiv.className = 'timeline__error';\n\n  const errorIcon = document.createElement('img');\n  errorIcon.src = timelineBasePath + '/alert.svg';\n  errorIcon.alt = 'Error';\n  errorIcon.className = 'timeline__error-icon';\n  // Ensure a reasonable default size even if CSS isn't loaded\n  // This makes the error icon usable when a consumer forgets to include CSS.\n  errorIcon.width = 200;\n  errorIcon.style.height = 'auto';\n\n  const errorTitle = document.createElement('h2');\n  errorTitle.className = 'timeline__error-title';\n  errorTitle.textContent = errorInfo.title;\n\n  const errorMessage = document.createElement('p');\n  errorMessage.className = 'timeline__error-message';\n  errorMessage.textContent = errorInfo.message;\n\n  const errorSolution = document.createElement('p');\n  errorSolution.className = 'timeline__error-solution';\n  errorSolution.innerHTML = '<strong>Solution:</strong> ' + errorInfo.solution;\n\n  if (details) {\n    const errorDetails = document.createElement('p');\n    errorDetails.className = 'timeline__error-details';\n    errorDetails.innerHTML = '<strong>Details:</strong> ' + details;\n    errorDiv.appendChild(errorDetails);\n  }\n\n  errorDiv.appendChild(errorIcon);\n  errorDiv.appendChild(errorTitle);\n  errorDiv.appendChild(errorMessage);\n  errorDiv.appendChild(errorSolution);\n\n  container.appendChild(errorDiv);\n\n  console.error('Timeline Error [' + errorType + ']:', errorInfo.message, details || '');\n\n  // Emit a global event so host pages can react (e.g., cancel instructions UI)\n  try {\n    const evt = new CustomEvent('timeline:error', {\n      detail: {\n        type: errorType,\n        message: errorInfo.message,\n        details: details || null,\n        containerId: container.id || null\n      }\n    });\n    window.dispatchEvent(evt);\n  } catch (e) {\n    // ignore event errors in very old browsers\n  }\n}\n","// Utility helpers shared across modules\nexport function getContrastColor(bgColor) {\n  const brightness = getColorBrightness(bgColor);\n  return brightness > 128 ? 'rgba(0, 0, 0, 0.2)' : 'rgba(255, 255, 255, 0.3)';\n}\n\nexport function getColorBrightness(color) {\n  let rgb;\n  if (!color || typeof color !== 'string') return 128;\n\n  if (color.startsWith('#')) {\n    let hex = color.substring(1);\n    if (hex.length === 3) {\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n    }\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    rgb = [r, g, b];\n  } else if (color.startsWith('rgb')) {\n    const matches = color.match(/\\d+/g);\n    rgb = matches ? matches.map(Number) : [128, 128, 128];\n  } else {\n    return 128;\n  }\n\n  return (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;\n}\n","import { getContrastColor, getColorBrightness } from '../shared/utils.js';\n\nexport function applyTimelineColors(container, config) {\n  let nodeColor = config.nodeColor || null;\n  let lineColor = config.lineColor || null;\n  const navColor = config.navColor || null;\n\n  if (nodeColor && !lineColor) lineColor = nodeColor;\n  if (lineColor && !nodeColor) nodeColor = lineColor;\n\n  if (nodeColor) {\n    container.style.setProperty('--timeline-node-color', nodeColor);\n    // Use configured nodeColor for the active/current item outline\n    container.style.setProperty('--timeline-active-outline-color', nodeColor);\n  }\n  if (lineColor) {\n    container.style.setProperty('--timeline-line-color', lineColor);\n  }\n  if (navColor) {\n    container.style.setProperty('--timeline-nav-color', navColor);\n    container.style.setProperty('--timeline-nav-border', getContrastColor(navColor));\n    const brightness = getColorBrightness(navColor);\n    const arrowColor = brightness > 128 ? '#333' : '#fff';\n    container.style.setProperty('--timeline-arrow-color', arrowColor);\n    container.setAttribute('data-arrow-color', arrowColor);\n  }\n}\n","import { showTimelineError } from '../features/error-ui.js';\nimport { applyTimelineColors } from '../features/colors.js';\nimport { openTimelineModal } from '../features/modals.js';\nimport { timelineRegistry } from '../shared/state.js';\n\n/**\n * Calculate and apply responsive scaling for horizontal timeline based on viewport height\n * @param {HTMLElement} timelineEl - The timeline container element\n */\nfunction calculateHorizontalScale(timelineEl) {\n  if (!timelineEl || !timelineEl.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  // Define constraints\n  const constraints = {\n    nodeWidth: { min: 150, max: 200, default: 200 },\n    nodeMinHeight: { min: 135, max: 180, default: 180 },\n    imageSize: { min: 80, max: 100, default: 100 },\n    titleFontSize: { min: 14, max: 18, default: 18 },\n    textFontSize: { min: 11, max: 13, default: 11 }\n  };\n\n  // Get available viewport height (minus padding/margins)\n  const viewportHeight = window.innerHeight;\n  const timelinePadding = 180; // Account for heading, margins, bottom item padding (40px), and buffer\n  const availableHeight = viewportHeight - timelinePadding;\n\n  // Calculate required height for default (max) dimensions\n  // Two rows of nodes + divider line + spacing + bottom padding\n  const maxNodeHeight = constraints.nodeMinHeight.max;\n  const requiredHeight = (maxNodeHeight * 2) + 90; // 90px for divider, spacing, and bottom item padding\n\n  // Calculate scale factor\n  let scaleFactor = 1.0;\n  if (availableHeight < requiredHeight) {\n    scaleFactor = Math.max(0.75, availableHeight / requiredHeight); // Don't scale below 75%\n  }\n\n  // Apply scaling with constraints\n  function scaleValue(config) {\n    const scaled = Math.round(config.default * scaleFactor);\n    return Math.max(config.min, Math.min(config.max, scaled));\n  }\n\n  // Set CSS custom properties\n  timelineEl.style.setProperty('--timeline-h-node-width', scaleValue(constraints.nodeWidth) + 'px');\n  timelineEl.style.setProperty('--timeline-h-node-min-height', scaleValue(constraints.nodeMinHeight) + 'px');\n  timelineEl.style.setProperty('--timeline-h-image-size', scaleValue(constraints.imageSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-title-font-size', scaleValue(constraints.titleFontSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-text-font-size', scaleValue(constraints.textFontSize) + 'px');\n}\n\nfunction ensureInlineModalData(itemEl) {\n  if (!itemEl) return;\n  const content = itemEl.querySelector('.timeline__content') || itemEl;\n  if (!itemEl.hasAttribute('data-modal-title')) {\n    const heading = content.querySelector('h1,h2,h3,h4,h5,h6');\n    if (heading && heading.textContent) {\n      itemEl.setAttribute('data-modal-title', heading.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-content')) {\n    const firstP = content.querySelector('p');\n    if (firstP && firstP.textContent) {\n      itemEl.setAttribute('data-modal-content', firstP.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-image')) {\n    const img = content.querySelector('img');\n    if (img && img.getAttribute('src')) {\n      itemEl.setAttribute('data-modal-image', img.getAttribute('src'));\n    }\n  }\n}\n\nfunction enhanceInlineItems(timelineEl, items) {\n  if (!items || !items.length) return;\n  items.forEach(function(item){\n    if (item.getAttribute('data-modal-bound') === '1') return;\n    ensureInlineModalData(item);\n    const hasModal = item.hasAttribute('data-modal-title') || item.hasAttribute('data-modal-content') || item.hasAttribute('data-modal-image') || item.hasAttribute('data-modal-html');\n    if (hasModal) {\n      item.addEventListener('click', function(e){\n        e.preventDefault();\n        openTimelineModal(item);\n      });\n      item.setAttribute('data-modal-bound', '1');\n    }\n  });\n}\n\nfunction createArrowSVG(direction, color) {\n  if (direction === 'left') {\n    return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.8 1L1 7l5.8 6\"/></svg>';\n  }\n  return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M1 1l5.8 6L1 13\"/></svg>';\n}\n\nexport function timeline(collection, options) {\n  const timelines = [];\n  const warningLabel = 'Timeline:';\n  let winWidth = window.innerWidth;\n  let resizeTimer;\n  let currentIndex = 0;\n  const eventListeners = new Map(); // Track listeners for cleanup\n\n  const defaultSettings = {\n    minWidth: { type: 'integer', defaultValue: 600 },\n    maxWidth: { type: 'integer', defaultValue: 600 },\n    horizontalStartPosition: { type: 'string', acceptedValues: ['bottom', 'top'], defaultValue: 'top' },\n    mode: { type: 'string', acceptedValues: ['horizontal', 'vertical'], defaultValue: 'vertical' },\n    moveItems: { type: 'integer', defaultValue: 1 },\n    rtlMode: { type: 'boolean', acceptedValues: [true, false], defaultValue: false },\n    startIndex: { type: 'integer', defaultValue: 0 },\n    verticalStartPosition: { type: 'string', acceptedValues: ['left', 'right'], defaultValue: 'left' },\n    verticalTrigger: { type: 'string', defaultValue: '15%' },\n    visibleItems: { type: 'integer', defaultValue: 3 }\n  };\n\n  function testValues(value, settingName) {\n    if (typeof value !== 'number' && value % 1 !== 0) {\n      console.warn(`${warningLabel} The value \"${value}\" entered for the setting \"${settingName}\" is not an integer.`);\n      return false;\n    }\n    return true;\n  }\n\n  function itemWrap(el, wrapper, classes) {\n    wrapper.classList.add(classes);\n    el.parentNode.insertBefore(wrapper, el);\n    wrapper.appendChild(el);\n  }\n\n  function wrapElements(items) {\n    items.forEach((item) => {\n      itemWrap(item.querySelector('.timeline__content'), document.createElement('div'), 'timeline__content__wrap');\n      itemWrap(item.querySelector('.timeline__content__wrap'), document.createElement('div'), 'timeline__item__inner');\n    });\n  }\n\n  function isElementInViewport(el, triggerPosition) {\n    const rect = el.getBoundingClientRect();\n    const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    let triggerUnit = triggerPosition.unit;\n    let triggerValue = triggerPosition.value;\n    let trigger = windowHeight;\n    if (triggerUnit === 'px' && triggerValue >= windowHeight) {\n      console.warn('The value entered for the setting \"verticalTrigger\" is larger than the window height. The default value will be used instead.');\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n    if (triggerUnit === 'px') {\n      trigger = parseInt(trigger - triggerValue, 10);\n    } else if (triggerUnit === '%') {\n      trigger = parseInt(trigger * ((100 - triggerValue) / 100), 10);\n    }\n    return (\n      rect.top <= trigger &&\n      rect.left <= (window.innerWidth || document.documentElement.clientWidth) &&\n      (rect.top + rect.height) >= 0 &&\n      (rect.left + rect.width) >= 0\n    );\n  }\n\n  function addTransforms(el, transform) {\n    el.style.webkitTransform = transform;\n    el.style.msTransform = transform;\n    el.style.transform = transform;\n  }\n\n  function createTimelines(timelineEl) {\n    const timelineName = timelineEl.id ? `#${timelineEl.id}` : `.${timelineEl.className}`;\n    const errorPart = 'could not be found as a direct descendant of';\n    const data = timelineEl.dataset;\n    let wrap;\n    let scroller;\n    let items;\n    const settings = {};\n\n    try {\n      wrap = timelineEl.querySelector('.timeline__wrap');\n      if (!wrap) {\n        throw new Error(`${warningLabel} .timeline__wrap ${errorPart} ${timelineName}`);\n      } else {\n        scroller = wrap.querySelector('.timeline__items');\n        if (!scroller) {\n          throw new Error(`${warningLabel} .timeline__items ${errorPart} .timeline__wrap`);\n        } else {\n          items = [].slice.call(scroller.children, 0);\n        }\n      }\n    } catch (e) {\n      console.warn(e.message);\n      showTimelineError(timelineEl, 'missing-element', e.message);\n      return false;\n    }\n\n    Object.keys(defaultSettings).forEach((key) => {\n      settings[key] = defaultSettings[key].defaultValue;\n\n      if (key === 'minWidth') {\n        let candidate = undefined;\n        if (data.minWidth !== undefined) candidate = data.minWidth;\n        if (data.minwidth !== undefined) candidate = data.minwidth;\n        if (data.forceVerticalMode !== undefined) candidate = data.forceVerticalMode;\n        if (data.forceverticalmode !== undefined) candidate = data.forceverticalmode;\n        if (candidate === undefined && options) {\n          if (options.minWidth !== undefined) candidate = options.minWidth;\n          else if (options.forceVerticalMode !== undefined) candidate = options.forceVerticalMode;\n        }\n        if (candidate !== undefined) settings.minWidth = candidate;\n      } else if (key === 'maxWidth') {\n        let candidate = undefined;\n        if (data.maxWidth !== undefined) candidate = data.maxWidth;\n        if (data.maxwidth !== undefined) candidate = data.maxwidth;\n        if (candidate === undefined && options) {\n          if (options.maxWidth !== undefined) candidate = options.maxWidth;\n        }\n        if (candidate !== undefined) settings.maxWidth = candidate;\n      } else {\n        if (data[key]) {\n          settings[key] = data[key];\n        } else if (options && options[key] !== undefined) {\n          settings[key] = options[key];\n        }\n      }\n\n      if (defaultSettings[key].type === 'integer') {\n        if (!settings[key] || !testValues(settings[key], key)) {\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      } else if (defaultSettings[key].type === 'string') {\n        if (defaultSettings[key].acceptedValues && defaultSettings[key].acceptedValues.indexOf(settings[key]) === -1) {\n          console.warn(`${warningLabel} The value \"${settings[key]}\" entered for the setting \"${key}\" was not recognised.`);\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      }\n    });\n\n    (function applyColorParity(){\n      const data = timelineEl.dataset;\n      const getData = function(k){\n        return data[k] !== undefined ? data[k] : (data[k && k.toLowerCase()] !== undefined ? data[k.toLowerCase()] : undefined);\n      };\n      let nodeColor = getData('nodeColor');\n      let lineColor = getData('lineColor');\n      let navColor = getData('navColor');\n      if (options) {\n        if (options.nodeColor !== undefined) nodeColor = options.nodeColor;\n        if (options.lineColor !== undefined) lineColor = options.lineColor;\n        if (options.navColor !== undefined) navColor = options.navColor;\n      }\n      if (nodeColor || lineColor || navColor) {\n        applyTimelineColors(timelineEl, { nodeColor, lineColor, navColor });\n      }\n    })();\n\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    const triggerArray = settings.verticalTrigger.match(/(\\d*\\.?\\d*)(.*)/);\n    let [, triggerValue, triggerUnit] = triggerArray;\n    let triggerValid = true;\n    if (!triggerValue) {\n      console.warn(`${warningLabel} No numercial value entered for the 'verticalTrigger' setting.`);\n      triggerValid = false;\n    }\n    if (triggerUnit !== 'px' && triggerUnit !== '%') {\n      console.warn(`${warningLabel} The setting 'verticalTrigger' must be a percentage or pixel value.`);\n      triggerValid = false;\n    }\n    if (triggerUnit === '%' && (triggerValue > 100 || triggerValue < 0)) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be between 0 and 100 if using a percentage value.`);\n      triggerValid = false;\n    } else if (triggerUnit === 'px' && triggerValue < 0) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be above 0 if using a pixel value.`);\n      triggerValid = false;\n    }\n\n    if (triggerValid === false) {\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n\n    settings.verticalTrigger = {\n      unit: triggerUnit,\n      value: triggerValue\n    };\n\n    if (settings.moveItems > settings.visibleItems) {\n      console.warn(`${warningLabel} The value of \"moveItems\" (${settings.moveItems}) is larger than the number of \"visibleItems\" (${settings.visibleItems}). The value of \"visibleItems\" has been used instead.`);\n      settings.moveItems = settings.visibleItems;\n    }\n\n    if (settings.startIndex > (items.length - settings.visibleItems) && items.length > settings.visibleItems) {\n      console.warn(`${warningLabel} The 'startIndex' setting must be between 0 and ${items.length - settings.visibleItems} for this timeline. The value of ${items.length - settings.visibleItems} has been used instead.`);\n      settings.startIndex = items.length - settings.visibleItems;\n    } else if (items.length <= settings.visibleItems) {\n      console.warn(`${warningLabel} The number of items in the timeline must exceed the number of visible items to use the 'startIndex' option.`);\n      settings.startIndex = 0;\n    } else if (settings.startIndex < 0) {\n      console.warn(`${warningLabel} The 'startIndex' setting must be between 0 and ${items.length - settings.visibleItems} for this timeline. The value of 0 has been used instead.`);\n      settings.startIndex = 0;\n    }\n\n    enhanceInlineItems(timelineEl, items);\n\n    if (!timelineEl.id) {\n      timelineEl.setAttribute('data-timeline-id', 'timeline-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9));\n    }\n\n    timelines.push({\n      timelineEl,\n      wrap,\n      scroller,\n      items,\n      settings,\n      listeners: [] // Store listeners for cleanup\n    });\n  }\n\n  if (collection.length) {\n    Array.from(collection).forEach(createTimelines);\n  }\n\n  function setHeightandWidths(tl) {\n    function setWidths() {\n      // Get the current scaled node width from CSS variable\n      const computedStyle = getComputedStyle(tl.timelineEl);\n      const nodeWidth = parseInt(computedStyle.getPropertyValue('--timeline-h-node-width')) || 200;\n      tl.itemWidth = nodeWidth;\n      tl.items.forEach((item) => {\n        item.style.width = `${tl.itemWidth}px`;\n      });\n      tl.scrollerWidth = tl.itemWidth * tl.items.length;\n      tl.scroller.style.width = `${tl.scrollerWidth}px`;\n    }\n\n    function setHeights() {\n      let oddIndexTallest = 0;\n      let evenIndexTallest = 0;\n      tl.items.forEach((item, i) => {\n        item.style.height = 'auto';\n        const height = item.offsetHeight;\n        if (i % 2 === 0) {\n          evenIndexTallest = height > evenIndexTallest ? height : evenIndexTallest;\n        } else {\n          oddIndexTallest = height > oddIndexTallest ? height : oddIndexTallest;\n        }\n      });\n\n      const transformString = `translateY(${evenIndexTallest}px)`;\n      tl.items.forEach((item, i) => {\n        if (i % 2 === 0) {\n          item.style.height = `${evenIndexTallest}px`;\n          if (tl.settings.horizontalStartPosition === 'bottom') {\n            item.classList.add('timeline__item--bottom');\n            addTransforms(item, transformString);\n          } else {\n            item.classList.add('timeline__item--top');\n          }\n        } else {\n          item.style.height = `${oddIndexTallest}px`;\n          if (tl.settings.horizontalStartPosition !== 'bottom') {\n            item.classList.add('timeline__item--bottom');\n            addTransforms(item, transformString);\n          } else {\n            item.classList.add('timeline__item--top');\n          }\n        }\n      });\n      // Add 40px to account for bottom padding on items to prevent clipping\n      tl.scroller.style.height = `${evenIndexTallest + oddIndexTallest + 40}px`;\n    }\n\n    if (window.innerWidth > tl.settings.minWidth) {\n      setWidths();\n      setHeights();\n    }\n  }\n\n  function addNavigation(tl) {\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n\n    if (tl.items.length > itemsVisible) {\n      const prevArrow = document.createElement('button');\n      const nextArrow = document.createElement('button');\n      const topPosition = tl.items[0].offsetHeight;\n      prevArrow.className = 'timeline-nav-button timeline-nav-button--prev';\n      nextArrow.className = 'timeline-nav-button timeline-nav-button--next';\n      prevArrow.textContent = 'Previous';\n      prevArrow.title = 'Go to previous items';\n      nextArrow.textContent = 'Next';\n      nextArrow.title = 'Go to next items';\n      prevArrow.style.top = `${topPosition}px`;\n      nextArrow.style.top = `${topPosition}px`;\n\n      const arrowColor = tl.timelineEl.getAttribute('data-arrow-color') || '#333';\n      prevArrow.innerHTML = createArrowSVG('left', arrowColor);\n      nextArrow.innerHTML = createArrowSVG('right', arrowColor);\n\n      const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n      if (currentIndex === 0) {\n        prevArrow.classList.add('timeline-nav-button--at-start');\n        prevArrow.title = 'Already at beginning of timeline';\n      }\n      if (currentIndex >= maxIndex) {\n        nextArrow.classList.add('timeline-nav-button--at-end');\n        nextArrow.title = 'Already at end of timeline';\n      }\n      tl.timelineEl.appendChild(prevArrow);\n      tl.timelineEl.appendChild(nextArrow);\n    }\n  }\n\n  function addHorizontalDivider(tl) {\n    const divider = tl.timelineEl.querySelector('.timeline-divider');\n    if (divider) {\n      tl.timelineEl.removeChild(divider);\n    }\n    const topPosition = tl.items[0].offsetHeight;\n    const horizontalDivider = document.createElement('span');\n    horizontalDivider.className = 'timeline-divider';\n    horizontalDivider.style.top = `${topPosition}px`;\n    tl.timelineEl.appendChild(horizontalDivider);\n  }\n\n  function timelinePosition(tl) {\n    const position = tl.items[currentIndex].offsetLeft;\n    const str = `translate3d(-${position}px, 0, 0)`;\n    addTransforms(tl.scroller, str);\n  }\n\n  function updateActiveItem(tl, index) {\n    // Remove active class from all items\n    tl.items.forEach(item => item.classList.remove('timeline__item--active'));\n    // Add active class to current item\n    if (tl.items[index]) {\n      tl.items[index].classList.add('timeline__item--active');\n    }\n  }\n\n  function slideTimeline(tl) {\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n    const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n    const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n\n    const moveItems = parseInt(tl.settings.moveItems, 10);\n    \n    const handleArrowClick = function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n\n      // If at bounds, show tooltip message and return (no-op)\n      if (this.classList.contains('timeline-nav-button--at-start') || this.classList.contains('timeline-nav-button--at-end')) {\n        return;\n      }\n\n      currentIndex = this.classList.contains('timeline-nav-button--next') ? (currentIndex += moveItems) : (currentIndex -= moveItems);\n      if (currentIndex === 0 || currentIndex < 0) {\n        currentIndex = 0;\n        arrowPrev.classList.add('timeline-nav-button--at-start');\n        arrowPrev.title = 'Already at beginning of timeline';\n        arrowNext.classList.remove('timeline-nav-button--at-end');\n        arrowNext.title = 'Go to next items';\n      } else if (currentIndex === maxIndex || currentIndex > maxIndex) {\n        currentIndex = maxIndex;\n        arrowPrev.classList.remove('timeline-nav-button--at-start');\n        arrowPrev.title = 'Go to previous items';\n        arrowNext.classList.add('timeline-nav-button--at-end');\n        arrowNext.title = 'Already at end of timeline';\n      } else {\n        arrowPrev.classList.remove('timeline-nav-button--at-start');\n        arrowPrev.title = 'Go to previous items';\n        arrowNext.classList.remove('timeline-nav-button--at-end');\n        arrowNext.title = 'Go to next items';\n      }\n      timelinePosition(tl);\n      tl.activeIndex = currentIndex;\n      updateActiveItem(tl, tl.activeIndex);\n      // Remove focus from button to avoid keyboard navigation side effects\n      this.blur();\n    };\n    \n    Array.from(navArrows).forEach((arrow) => {\n      arrow.addEventListener('click', handleArrowClick);\n      tl.listeners.push({ element: arrow, type: 'click', handler: handleArrowClick });\n    });\n  }\n\n  function setUpHorinzontalTimeline(tl) {\n    if (tl.settings.rtlMode) {\n      currentIndex = tl.items.length > tl.settings.visibleItems ? tl.items.length - tl.settings.visibleItems : 0;\n    } else {\n      currentIndex = tl.settings.startIndex;\n    }\n    // Track the \"active\" item separately from the scroll position.\n    // Usually these are the same, but they can diverge near the end (e.g. last item).\n    tl.activeIndex = currentIndex;\n    tl.timelineEl.classList.add('timeline--horizontal');\n    // Calculate responsive scaling before layout calculations\n    calculateHorizontalScale(tl.timelineEl);\n    setHeightandWidths(tl);\n    timelinePosition(tl);\n    updateActiveItem(tl, tl.activeIndex);\n    addNavigation(tl);\n    addHorizontalDivider(tl);\n    slideTimeline(tl);\n\n    const timelineId = tl.timelineEl.id || tl.timelineEl.getAttribute('data-timeline-id');\n    if (timelineId) {\n      timelineRegistry[timelineId] = {\n        setCurrentIndex: function(index) {\n          const viewportWidth = tl.wrap.offsetWidth;\n          const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n          const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n          // Scroll position clamps to maxIndex, but the active highlight can be the actual requested item.\n          tl.activeIndex = Math.max(0, Math.min(index, tl.items.length - 1));\n          currentIndex = Math.max(0, Math.min(index, maxIndex));\n        },\n        updatePosition: function() {\n          timelinePosition(tl);\n          updateActiveItem(tl, tl.activeIndex);\n          const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n          const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n          if (arrowPrev && arrowNext) {\n            const viewportWidth = tl.wrap.offsetWidth;\n            const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n            const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n            // Use classes instead of disabled attribute to avoid focus issues\n            if (currentIndex === 0) {\n              arrowPrev.classList.add('timeline-nav-button--at-start');\n              arrowPrev.title = 'Already at beginning of timeline';\n            } else {\n              arrowPrev.classList.remove('timeline-nav-button--at-start');\n              arrowPrev.title = 'Go to previous items';\n            }\n            if (currentIndex >= maxIndex) {\n              arrowNext.classList.add('timeline-nav-button--at-end');\n              arrowNext.title = 'Already at end of timeline';\n            } else {\n              arrowNext.classList.remove('timeline-nav-button--at-end');\n              arrowNext.title = 'Go to next items';\n            }\n          }\n        }\n      };\n\n      // Clicking an item (dot or card) should also make it the current/active node.\n      // This runs alongside modal opening.\n      const tlData = timelineRegistry[timelineId];\n      tl.items.forEach((item, idx) => {\n        const activateHandler = () => {\n          if (!tl.timelineEl.classList.contains('timeline--horizontal')) return;\n          if (tlData && tlData.setCurrentIndex && tlData.updatePosition) {\n            tlData.setCurrentIndex(idx);\n            tlData.updatePosition();\n          }\n        };\n        item.addEventListener('click', activateHandler);\n        tl.listeners.push({ element: item, type: 'click', handler: activateHandler });\n      });\n    }\n  }\n\n  function setUpVerticalTimeline(tl) {\n    let lastVisibleIndex = 0;\n    tl.items.forEach((item, i) => {\n      item.classList.remove('animated', 'fadeIn');\n      if (!isElementInViewport(item, tl.settings.verticalTrigger) && i > 0) {\n        item.classList.add('animated');\n      } else {\n        lastVisibleIndex = i;\n      }\n      const divider = tl.settings.verticalStartPosition === 'left' ? 1 : 0;\n      if (i % 2 === divider && window.innerWidth > tl.settings.minWidth) {\n        item.classList.add('timeline__item--right');\n      } else {\n        item.classList.add('timeline__item--left');\n      }\n    });\n    for (let i = 0; i < lastVisibleIndex; i += 1) {\n      tl.items[i].classList.remove('animated', 'fadeIn');\n    }\n    \n    // Use IntersectionObserver instead of scroll listener for better performance\n    if ('IntersectionObserver' in window) {\n      const observerOptions = {\n        rootMargin: tl.settings.verticalTrigger.unit === '%' \n          ? `${tl.settings.verticalTrigger.value}%` \n          : `${tl.settings.verticalTrigger.value}px`,\n        threshold: 0.01\n      };\n      \n      const observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            entry.target.classList.add('fadeIn');\n          }\n        });\n      }, observerOptions);\n      \n      tl.items.forEach((item) => {\n        if (item.classList.contains('animated')) {\n          observer.observe(item);\n        }\n      });\n      \n      // Store observer for cleanup\n      tl.observer = observer;\n    } else {\n      // Fallback for older browsers (though we're targeting 2018+)\n      const scrollHandler = () => {\n        tl.items.forEach((item) => {\n          if (isElementInViewport(item, tl.settings.verticalTrigger)) {\n            item.classList.add('fadeIn');\n          }\n        });\n      };\n      window.addEventListener('scroll', scrollHandler);\n      tl.listeners.push({ element: window, type: 'scroll', handler: scrollHandler });\n    }\n  }\n\n  function resetTimelines(tl) {\n    // Clean up event listeners\n    if (tl.listeners && tl.listeners.length > 0) {\n      tl.listeners.forEach(({ element, type, handler }) => {\n        element.removeEventListener(type, handler);\n      });\n      tl.listeners = [];\n    }\n    \n    // Clean up IntersectionObserver\n    if (tl.observer) {\n      tl.observer.disconnect();\n      tl.observer = null;\n    }\n    \n    tl.timelineEl.classList.remove('timeline--horizontal', 'timeline--mobile');\n    tl.scroller.removeAttribute('style');\n    tl.items.forEach((item) => {\n      item.removeAttribute('style');\n      item.classList.remove('animated', 'fadeIn', 'timeline__item--left', 'timeline__item--right');\n    });\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    Array.from(navArrows).forEach((arrow) => {\n      arrow.parentNode.removeChild(arrow);\n    });\n  }\n\n  function setUpTimelines() {\n    timelines.forEach((tl) => {\n      tl.timelineEl.style.opacity = 0;\n      if (!tl.timelineEl.classList.contains('timeline--loaded')) {\n        wrapElements(tl.items);\n      }\n      resetTimelines(tl);\n      if (window.innerWidth <= tl.settings.minWidth) {\n        tl.timelineEl.classList.add('timeline--mobile');\n      }\n      \n      // Determine which mode to use based on settings and viewport width\n      let useHorizontalMode = false;\n      if (tl.settings.mode === 'horizontal' && window.innerWidth > tl.settings.minWidth) {\n        useHorizontalMode = true;\n      } else if (tl.settings.mode === 'vertical' && window.innerWidth > tl.settings.maxWidth) {\n        useHorizontalMode = true;\n      }\n      \n      if (useHorizontalMode) {\n        setUpHorinzontalTimeline(tl);\n      } else {\n        setUpVerticalTimeline(tl);\n      }\n      tl.timelineEl.classList.add('timeline--loaded');\n    });\n\n    setTimeout(() => {\n      timelines.forEach((tl) => {\n        tl.timelineEl.style.opacity = 1;\n      });\n    }, 500);\n  }\n\n  try {\n    setUpTimelines();\n\n    window.addEventListener('resize', () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        const newWinWidth = window.innerWidth;\n        if (newWinWidth !== winWidth) {\n          setUpTimelines();\n          winWidth = newWinWidth;\n        }\n      }, 250);\n    });\n  } catch (e) {\n    console.error('Timeline initialization failed:', e);\n  }\n}","import { timelineBasePath } from '../shared/config.js';\nimport { showTimelineError } from './error-ui.js';\nimport { applyTimelineColors } from './colors.js';\nimport { handleDeepLinking } from './deep-linking.js';\nimport { timeline } from '../core/timeline-engine.js';\nimport { LOREM_PARAGRAPH, LOREM_FULL } from '../shared/lipsum.js';\n\n/**\n * Normalize item data to standard 5-field schema\n * Fields: date, heading, summary, content (HTML), image\n */\nfunction normalizeItemData(rawData) {\n  const normalized = {\n    id: rawData.id || null,\n    date: rawData.date || 'DD/MM/YYYY',\n    heading: rawData.heading || 'Node Title',\n    summary: rawData.summary || LOREM_PARAGRAPH,\n    content: rawData.content || LOREM_FULL,\n    image: rawData.image || null\n  };\n  \n  return normalized;\n}\n\n/**\n * Sanitize HTML content - remove potentially problematic tags\n * Allow: p, strong, em, u, a, ul, ol, li, br, blockquote\n * Strip: script, iframe, form, input, h1, h2\n */\nfunction sanitizeContent(html) {\n  if (!html) return '';\n  \n  let clean = html;\n  \n  // Remove script tags and content\n  clean = clean.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '');\n  \n  // Remove form tags and content\n  clean = clean.replace(/<form[^>]*>[\\s\\S]*?<\\/form>/gi, '');\n  \n  // Remove input tags\n  clean = clean.replace(/<input[^>]*>/gi, '');\n  \n  // Remove h1 tags (replace with h3)\n  clean = clean.replace(/<h1/gi, '<h3');\n  clean = clean.replace(/<\\/h1>/gi, '</h3>');\n  \n  // Remove h2 tags (replace with h3)\n  clean = clean.replace(/<h2/gi, '<h3');\n  clean = clean.replace(/<\\/h2>/gi, '</h3>');\n  \n  return clean.trim();\n}\n\n/**\n * Create DOM node from normalized item data\n */\nfunction createItemNode(item) {\n  const normalized = normalizeItemData(item);\n  \n  const itemEl = document.createElement('div');\n  itemEl.className = 'timeline__item';\n  \n  if (normalized.id) {\n    itemEl.setAttribute('data-node-id', normalized.id);\n  }\n\n  // Timeline content (visible in node)\n  const content = document.createElement('div');\n  content.className = 'timeline__content';\n\n  // Date\n  const dateEl = document.createElement('div');\n  dateEl.className = 'timeline__date';\n  dateEl.textContent = normalized.date;\n  content.appendChild(dateEl);\n\n  // Image (optional)\n  if (normalized.image) {\n    const img = document.createElement('img');\n    img.src = normalized.image;\n    img.className = 'timeline__image';\n    img.alt = normalized.heading || 'Timeline image';\n    img.loading = 'lazy';\n    img.onerror = function() {\n      console.error('Timeline: Image failed to load:', normalized.image);\n      this.src = timelineBasePath + '/missing-image.svg';\n      this.alt = 'Image not found';\n    };\n    content.appendChild(img);\n  }\n\n  // Heading\n  const headingEl = document.createElement('h3');\n  headingEl.className = 'timeline__heading';\n  headingEl.textContent = normalized.heading;\n  content.appendChild(headingEl);\n\n  // Summary (truncated by CSS)\n  const summaryEl = document.createElement('div');\n  summaryEl.className = 'timeline__summary';\n  summaryEl.textContent = normalized.summary;\n  content.appendChild(summaryEl);\n\n  itemEl.appendChild(content);\n\n  // Modal content (hidden by default, shown in popup)\n  const modalContent = document.createElement('div');\n  modalContent.className = 'timeline__modal-content';\n  const contentFull = document.createElement('div');\n  contentFull.className = 'timeline__content-full';\n  contentFull.innerHTML = sanitizeContent(normalized.content);\n  modalContent.appendChild(contentFull);\n  itemEl.appendChild(modalContent);\n\n  // Click handler to open modal\n  itemEl.addEventListener('click', function(e) {\n    e.preventDefault();\n    if (typeof window.openTimelineModal === 'function') {\n      window.openTimelineModal(itemEl);\n    }\n  });\n\n  return itemEl;\n}\n\n/**\n * Apply configuration as data attributes\n */\nfunction applyDataAttributes(container, config) {\n  if (config.layoutMode) {\n    container.setAttribute('data-mode', config.layoutMode);\n  }\n  if (config.visibleItems !== undefined) {\n    container.setAttribute('data-visible-items', config.visibleItems);\n  }\n  if (config.minWidth !== undefined) {\n    container.setAttribute('data-min-width', config.minWidth);\n  }\n  if (config.maxWidth !== undefined) {\n    container.setAttribute('data-max-width', config.maxWidth);\n  }\n}\n\n/**\n * Render timeline from data array\n */\nexport function renderTimelineFromData(containerSelector, data, config) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    return null;\n  }\n\n  // Remove any previous error state\n  container.classList.remove('timeline--error');\n\n  // Get or create timeline structure\n  let itemsWrap = container.querySelector('.timeline__items');\n  if (!itemsWrap) {\n    const wrap = document.createElement('div');\n    wrap.className = 'timeline__wrap';\n    itemsWrap = document.createElement('div');\n    itemsWrap.className = 'timeline__items';\n    wrap.appendChild(itemsWrap);\n    container.appendChild(wrap);\n  } else {\n    itemsWrap.innerHTML = '';\n  }\n\n  // Apply configuration\n  if (config) {\n    applyDataAttributes(container, config);\n    applyTimelineColors(container, config);\n\n    // Add timeline heading if provided\n    if (config.timelineName && config.timelineName.trim() !== '') {\n      const existingHeading = container.previousElementSibling;\n      if (existingHeading && existingHeading.classList.contains('timeline__heading')) {\n        existingHeading.textContent = config.timelineName;\n      } else {\n        const heading = document.createElement('h1');\n        heading.className = 'timeline__heading';\n        heading.textContent = config.timelineName;\n        container.parentNode.insertBefore(heading, container);\n      }\n      container.setAttribute('data-timeline-name', config.timelineName);\n    }\n  }\n\n  // Create timeline items from data\n  if (!Array.isArray(data) || data.length === 0) {\n    showTimelineError(container, 'no-data', 'No timeline items provided');\n    return null;\n  }\n\n  data.forEach(function(item) {\n    itemsWrap.appendChild(createItemNode(item));\n  });\n\n  return container;\n}\n\n/**\n * Initialize timeline from provided data\n */\nexport function timelineFromData(containerSelector, data, options) {\n  const container = renderTimelineFromData(containerSelector, data, options);\n  if (!container) return;\n  timeline([container], options || {});\n}\n\n/**\n * Load timeline data from JSON file and initialize\n */\nexport function loadDataFromJson(url, containerSelector) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    showTimelineError(null, 'missing-element', 'Timeline container not found: ' + containerSelector);\n    return;\n  }\n\n  // Check cache first\n  const cacheKey = 'timeline_cache_' + url;\n  let cachedData = null;\n  let cachedTime = null;\n\n  if (typeof(Storage) !== 'undefined') {\n    try {\n      const cached = localStorage.getItem(cacheKey);\n      if (cached) {\n        const parsedCache = JSON.parse(cached);\n        cachedData = parsedCache.data;\n        cachedTime = parsedCache.timestamp;\n      }\n    } catch (e) {\n      console.warn('Timeline: Failed to parse cached data');\n    }\n  }\n\n  // Fetch JSON\n  fetch(url)\n    .then(response => {\n      if (!response.ok) throw new Error('Failed to load: ' + response.statusText);\n      return response.json();\n    })\n    .then(jsonData => {\n      // Check if we need to update cache\n      const needsUpdate = !cachedData || \n        !jsonData.lastupdated || \n        new Date(jsonData.lastupdated) > new Date(cachedTime);\n\n      if (needsUpdate && jsonData.nodes && typeof(Storage) !== 'undefined') {\n        try {\n          localStorage.setItem(cacheKey, JSON.stringify({\n            data: jsonData.nodes,\n            timestamp: jsonData.lastupdated || new Date().toISOString()\n          }));\n        } catch (e) {\n          console.warn('Timeline: Unable to cache data', e);\n        }\n      }\n\n      const dataToUse = jsonData.nodes || jsonData;\n      const config = Object.assign({}, jsonData);\n      delete config.nodes;\n\n      renderTimelineFromData(containerSelector, dataToUse, config);\n      timeline([container], {});\n      handleDeepLinking();\n    })\n    .catch(error => {\n      console.error('Timeline: Error loading JSON:', error);\n      \n      // Try to use cached data as fallback\n      if (cachedData && cachedData.length > 0) {\n        console.log('Timeline: Using cached data as fallback');\n        renderTimelineFromData(containerSelector, cachedData, {});\n        timeline([container], {});\n      } else {\n        showTimelineError(container, 'load-failed', 'Failed to load timeline data: ' + error.message);\n      }\n    });\n}\n\n/**\n * Clear timeline cache\n */\nexport function clearTimelineCache(url) {\n  if (typeof(Storage) === 'undefined') {\n    console.warn('Timeline: localStorage not supported');\n    return;\n  }\n\n  if (url) {\n    const cacheKey = 'timeline_cache_' + url;\n    localStorage.removeItem(cacheKey);\n    console.log('Timeline: Cleared cache for', url);\n  } else {\n    // Clear all timeline caches\n    const keys = Object.keys(localStorage);\n    let cleared = 0;\n    keys.forEach(key => {\n      if (key.startsWith('timeline_cache_')) {\n        localStorage.removeItem(key);\n        cleared++;\n      }\n    });\n    console.log('Timeline: Cleared', cleared, 'cache(s)');\n  }\n}\n\n/**\n * Process timeline data (alias for renderTimelineFromData for backwards compat)\n */\nexport function processTimelineData(containerSelector, data, config) {\n  return renderTimelineFromData(containerSelector, data, config);\n}\n","/**\n * Lorem Ipsum placeholder text utility\n * Provides reusable placeholder content for timeline nodes\n */\n\n// Full paragraph of Lorem Ipsum\nconst LOREM_PARAGRAPH = 'Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident.';\n\n// Short sentence\nconst LOREM_SHORT = 'Lorem ipsum dolor sit amet, qui minim labore adipisicing minim sint cillum sint consectetur cupidatat.';\n\n// Multiple paragraphs\nconst LOREM_FULL = `<p>Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate.</p><p>Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.</p>`;\n\nexport { LOREM_PARAGRAPH, LOREM_SHORT, LOREM_FULL };\n","// --------------------------------------------------------------------------\r\n// timeline.js - a vanilla JS app to display timelines\r\n// \r\n// Created in 2018 by Mike Collins (https://github.com/squarechip/timeline)\r\n// Modified in 2026 by Ken Dawson (https://github.com/kendawson-online)\r\n// Last updated: 01/08/26\r\n//\r\n// --------------------------------------------------------------------------\r\n\r\nimport { createTimelineModal, openTimelineModal, closeTimelineModal } from './features/modals.js';\r\nimport { handleDeepLinking, navigateToNodeIndex } from './features/deep-linking.js';\r\nimport { renderTimelineFromData, timelineFromData, loadDataFromJson, processTimelineData, clearTimelineCache } from './features/data-loader.js';\r\nimport { timeline } from './core/timeline-engine.js';\r\nimport '../css/timeline.css';\r\n\r\nfunction autoInitJsonTimelines() {\r\n  const timelinesWithJson = document.querySelectorAll('[data-json-config]');\r\n  timelinesWithJson.forEach(function(timelineEl) {\r\n    const jsonUrl = timelineEl.getAttribute('data-json-config');\r\n    if (!jsonUrl) return;\r\n    const className = (timelineEl.className || '').split(' ')[0];\r\n    const selector = timelineEl.id ? '#' + timelineEl.id : (className ? '.' + className : null);\r\n    if (selector) {\r\n      loadDataFromJson(jsonUrl, selector);\r\n    }\r\n  });\r\n}\r\n\r\nfunction exposeGlobals() {\r\n  if (typeof window === 'undefined') return;\r\n  window.timeline = timeline;\r\n  window.timelineFromData = timelineFromData;\r\n  window.renderTimelineFromData = renderTimelineFromData;\r\n  window.processTimelineData = processTimelineData;\r\n  window.loadDataFromJson = loadDataFromJson;\r\n  window.clearTimelineCache = clearTimelineCache;\r\n  window.createTimelineModal = createTimelineModal;\r\n  window.openTimelineModal = openTimelineModal;\r\n  window.closeTimelineModal = closeTimelineModal;\r\n  window.handleTimelineDeepLinking = handleDeepLinking;\r\n  window.navigateTimelineToNodeIndex = navigateToNodeIndex;\r\n}\r\n\r\nexposeGlobals();\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  autoInitJsonTimelines();\r\n});\r\n\r\nif (typeof window !== 'undefined' && window.jQuery) {\r\n  (( $) => {\r\n    $.fn.timeline = function(opts) {\r\n      timeline(this, opts);\r\n      return this;\r\n    };\r\n  })(window.jQuery);\r\n}\r\n\r\nexport {\r\n  timeline,\r\n  timelineFromData,\r\n  renderTimelineFromData,\r\n  loadDataFromJson,\r\n  processTimelineData,\r\n  clearTimelineCache,\r\n  createTimelineModal,\r\n  openTimelineModal,\r\n  closeTimelineModal,\r\n  handleDeepLinking,\r\n  navigateToNodeIndex\r\n};"],"names":["modalState","modal","overlay","timelineRegistry","createTimelineModal","document","createElement","className","addEventListener","closeTimelineModal","innerHTML","closeBtn","querySelector","closeBottomBtn","e","stopPropagation","body","appendChild","key","classList","contains","openTimelineModal","itemEl","title","getAttribute","content","image","html","modalTitle","modalText","modalImage","textContent","src","alt","style","display","replace","setTimeout","add","overflow","remove","handleDeepLinking","containerSelector","urlParams","URLSearchParams","window","location","search","timelineId","get","nodeId","targetContainer","getElementById","console","warn","scrollIntoView","behavior","block","targetNode","querySelectorAll","forEach","n","itemIndex","Array","from","parentNode","children","indexOf","navigateToNodeIndex","container","index","id","tlData","setCurrentIndex","updatePosition","timelineBasePath","TimelineConfig","basePath","scripts","getElementsByTagName","i","length","dir","substring","lastIndexOf","showTimelineError","errorType","details","errorInfo","message","solution","errorDiv","errorIcon","width","height","errorTitle","errorMessage","errorSolution","errorDetails","error","evt","CustomEvent","detail","type","containerId","dispatchEvent","getColorBrightness","color","rgb","startsWith","hex","parseInt","matches","match","map","Number","applyTimelineColors","config","nodeColor","lineColor","navColor","setProperty","arrowColor","setAttribute","createArrowSVG","direction","timeline","collection","options","timelines","warningLabel","resizeTimer","winWidth","innerWidth","currentIndex","defaultSettings","minWidth","defaultValue","maxWidth","horizontalStartPosition","acceptedValues","mode","moveItems","rtlMode","startIndex","verticalStartPosition","verticalTrigger","visibleItems","itemWrap","el","wrapper","classes","insertBefore","isElementInViewport","triggerPosition","rect","getBoundingClientRect","windowHeight","innerHeight","documentElement","clientHeight","defaultTrigger","triggerUnit","unit","triggerValue","value","trigger","top","left","clientWidth","addTransforms","transform","webkitTransform","msTransform","timelinePosition","tl","str","items","offsetLeft","scroller","updateActiveItem","item","setUpHorinzontalTimeline","settings","activeIndex","timelineEl","constraints","min","max","default","availableHeight","requiredHeight","scaleFactor","scaleValue","scaled","Math","round","calculateHorizontalScale","computedStyle","getComputedStyle","nodeWidth","getPropertyValue","itemWidth","scrollerWidth","setWidths","oddIndexTallest","evenIndexTallest","offsetHeight","transformString","setHeights","setHeightandWidths","viewportWidth","wrap","offsetWidth","itemsVisible","floor","prevArrow","nextArrow","topPosition","maxIndex","addNavigation","divider","removeChild","horizontalDivider","addHorizontalDivider","navArrows","arrowPrev","arrowNext","handleArrowClick","preventDefault","stopImmediatePropagation","this","blur","arrow","listeners","push","element","handler","slideTimeline","idx","activateHandler","setUpTimelines","opacity","removeEventListener","observer","disconnect","removeAttribute","resetTimelines","useHorizontalMode","lastVisibleIndex","observerOptions","rootMargin","threshold","IntersectionObserver","entries","entry","isIntersecting","target","observe","scrollHandler","setUpVerticalTimeline","timelineName","errorPart","data","dataset","Error","slice","call","Object","keys","candidate","undefined","minwidth","forceVerticalMode","forceverticalmode","maxwidth","settingName","getData","k","toLowerCase","triggerArray","triggerValid","hasAttribute","heading","trim","firstP","img","ensureInlineModalData","enhanceInlineItems","Date","now","random","toString","substr","clearTimeout","newWinWidth","renderTimelineFromData","itemsWrap","layoutMode","applyDataAttributes","existingHeading","previousElementSibling","isArray","normalized","rawData","date","summary","dateEl","loading","onerror","headingEl","summaryEl","modalContent","contentFull","clean","sanitizeContent","createItemNode","timelineFromData","loadDataFromJson","url","cacheKey","cachedData","cachedTime","cached","localStorage","getItem","parsedCache","JSON","parse","timestamp","fetch","then","response","ok","statusText","json","jsonData","lastupdated","nodes","setItem","stringify","toISOString","dataToUse","assign","catch","log","clearTimelineCache","removeItem","cleared","processTimelineData","handleTimelineDeepLinking","navigateTimelineToNodeIndex","jsonUrl","split","selector","jQuery","fn","opts"],"mappings":"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"}