{"version":3,"file":"timeline.min.js","sources":["../src/js/shared/state.js","../src/js/features/modals.js","../src/js/features/deep-linking.js","../src/js/shared/config.js","../src/js/features/error-ui.js","../src/js/shared/utils.js","../src/js/features/colors.js","../src/adapters/swiper-adapter.js","../src/js/features/layout-fallbacks.js","../src/js/core/timeline-engine.js","../src/js/features/data-loader.js","../src/js/shared/lipsum.js","../src/js/features/keyboard.js","../src/js/timeline.js"],"sourcesContent":["/**\n * Global state management for timeline features\n *\n * Provides shared state variables used across multiple modules.\n * All state is managed globally to ensure single instances of shared components (e.g., modal).\n */\n\n/**\n * Global modal state\n *\n * Stores references to the singleton modal and overlay DOM elements.\n * Managed by features/modals.js\n *\n * @type {Object}\n * @property {HTMLElement|null} modal - The modal dialog element\n * @property {HTMLElement|null} overlay - The modal background overlay element\n */\nexport const modalState = {\n  modal: null,\n  overlay: null\n};\n\n/**\n * Global timeline instances registry\n *\n * Maps timeline element IDs to their instance objects for programmatic navigation\n * and cross-timeline communication. Used by deep-linking and navigation features.\n *\n * @type {Object.<string, Object>}\n * @example\n * // After timeline initialized with id=\"my-timeline\"\n * timelineRegistry['my-timeline'] = { scrollIndex: 0, ... }\n */\nexport const timelineRegistry = {};\n","/**\n * Timeline modal popups\n *\n * Manages a singleton modal dialog for displaying detailed timeline item information.\n * Auto-populates from data-modal-* attributes or extracted heading/image/content.\n */\n\nimport { modalState } from '../shared/state.js';\n\nlet lastFocusedElement = null;\n\nfunction getFocusableElements(container) {\n  const focusable = container ? container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])') : [];\n  return Array.from(focusable).filter(el => !el.hasAttribute('disabled'));\n}\n\nfunction trapFocus(e) {\n  if (!modalState.modal || e.key !== 'Tab') return;\n\n  const focusable = getFocusableElements(modalState.modal);\n  if (focusable.length === 0) return;\n\n  const first = focusable[0];\n  const last = focusable[focusable.length - 1];\n  const active = document.activeElement;\n\n  if (e.shiftKey) {\n    if (active === first || !modalState.modal.contains(active)) {\n      e.preventDefault();\n      last.focus();\n    }\n  } else if (active === last || !modalState.modal.contains(active)) {\n    e.preventDefault();\n    first.focus();\n  }\n}\n\n/**\n * Create the global modal and overlay elements\n *\n * Creates a single modal instance that is reused for all timeline items.\n * Sets up event listeners for close button, overlay click, and ESC key.\n * Safe to call multiple times (does nothing if modal already exists).\n *\n * @returns {void}\n */\nexport function createTimelineModal() {\n  if (modalState.modal) return;\n\n  modalState.overlay = document.createElement('div');\n  modalState.overlay.className = 'timeline-modal-overlay';\n  modalState.overlay.addEventListener('click', closeTimelineModal);\n\n  modalState.modal = document.createElement('div');\n  modalState.modal.className = 'timeline-modal';\n  modalState.modal.setAttribute('role', 'dialog');\n  modalState.modal.setAttribute('aria-modal', 'true');\n\n  const titleId = 'timeline-modal-title';\n  modalState.modal.setAttribute('aria-labelledby', titleId);\n\n  modalState.modal.innerHTML = `\n    <button class=\"timeline-modal__close\" aria-label=\"Close modal\" type=\"button\"></button>\n    <div class=\"timeline-modal__content\">\n      <img class=\"timeline-modal__image\" src=\"\" alt=\"\" loading=\"lazy\" style=\"display: none;\">\n      <h2 class=\"timeline-modal__title\" id=\"${titleId}\"></h2>\n      <div class=\"timeline-modal__text\"></div>\n    </div>\n    <div class=\"timeline-modal__footer\">\n      <button class=\"timeline-modal__close-bottom\" type=\"button\">Close</button>\n    </div>\n  `;\n\n  const closeBtn = modalState.modal.querySelector('.timeline-modal__close');\n  const closeBottomBtn = modalState.modal.querySelector('.timeline-modal__close-bottom');\n  closeBtn.addEventListener('click', closeTimelineModal);\n  closeBottomBtn.addEventListener('click', closeTimelineModal);\n  modalState.modal.addEventListener('keydown', trapFocus);\n\n  modalState.modal.addEventListener('click', function(e) {\n    e.stopPropagation();\n  });\n\n  document.body.appendChild(modalState.overlay);\n  document.body.appendChild(modalState.modal);\n\n  document.addEventListener('keydown', function(e) {\n    if (e.key === 'Escape' && modalState.modal.classList.contains('timeline-modal-show')) {\n      closeTimelineModal();\n    }\n  });\n}\n\nexport function openTimelineModal(itemEl) {\n  /**\n   * Open the modal and populate with data from a timeline item\n   *\n   * Populates modal with item data from attributes:\n   * - data-modal-title: Modal heading (required)\n   * - data-modal-content: Modal body text (plain text, newlines become paragraphs)\n   * - data-modal-image: Modal image src\n   * - data-modal-html: Modal body HTML (overrides data-modal-content)\n   *\n   * Falls back to extracting from DOM if attributes missing:\n   * - First heading (h1-h6) → title\n   * - First image → image\n   * - Inline modal content div\n   *\n   * Adds 'timeline-modal-show' class after 10ms delay for CSS transitions.\n   * Hides body scrollbar while modal is open.\n   *\n   * @param {HTMLElement} itemEl - Timeline item element to open modal for\n   * @returns {void}\n   */\n  if (!modalState.modal) {\n    createTimelineModal();\n  }\n\n  lastFocusedElement = document.activeElement;\n\n  const title = itemEl.getAttribute('data-modal-title');\n  const content = itemEl.getAttribute('data-modal-content');\n  const image = itemEl.getAttribute('data-modal-image');\n  const html = itemEl.getAttribute('data-modal-html');\n\n  const modalTitle = modalState.modal.querySelector('.timeline-modal__title');\n  const modalText = modalState.modal.querySelector('.timeline-modal__text');\n  const modalImage = modalState.modal.querySelector('.timeline-modal__image');\n\n  modalTitle.textContent = title || '';\n\n  if (image) {\n    modalImage.src = image;\n    modalImage.alt = title || '';\n    modalImage.style.display = 'block';\n  } else {\n    modalImage.style.display = 'none';\n  }\n\n  if (html) {\n    modalText.innerHTML = html;\n  } else {\n    // If the item contains inline modal HTML (rendered by data-loader or present in markup), prefer it\n    const domModal = itemEl.querySelector('.timeline__modal-content');\n    if (domModal && domModal.innerHTML && domModal.innerHTML.trim() !== '') {\n      modalText.innerHTML = domModal.innerHTML;\n    }\n    else if (content) {\n      modalText.innerHTML = '<p>' + content.replace(/\\n/g, '</p><p>') + '</p>';\n    } else {\n      modalText.innerHTML = '';\n    }\n  }\n\n  setTimeout(function() {\n    // Check if modal still exists (defensive against cleanup race conditions)\n    if (modalState.modal && modalState.overlay) {\n      modalState.modal.classList.add('timeline-modal-show');\n      modalState.overlay.classList.add('timeline-modal-show');\n      document.body.style.overflow = 'hidden';\n\n      const firstFocusable = getFocusableElements(modalState.modal)[0];\n      if (firstFocusable) firstFocusable.focus();\n    }\n  }, 10);\n}\n\nexport function closeTimelineModal() {\n  /**\n   * Close the modal and restore page scroll\n   *\n   * Removes 'timeline-modal-show' class from modal and overlay, triggering CSS transition.\n   * Restores body scrollbar visibility.\n   *\n   * Safe to call when modal is not open (no-op if modal doesn't exist).\n   *\n   * @returns {void}\n   */\n  if (modalState.modal) {\n    modalState.modal.classList.remove('timeline-modal-show');\n    modalState.overlay.classList.remove('timeline-modal-show');\n    document.body.style.overflow = '';\n    if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {\n      lastFocusedElement.focus();\n    }\n  }\n}\n","/**\n * Deep linking support for timeline navigation\n *\n * Allows users to link directly to specific timeline items via URL parameters.\n * Implements browser back/forward history integration.\n */\n\nimport { timelineRegistry } from '../shared/state.js';\n\n/**\n * Handle deep link URL parameters and navigate to specific timeline item\n *\n * Looks for URL parameters:  *  - ?id=nodeId - ID of the timeline item to show\n *  - ?timeline=timelineId - Specific timeline (optional, for multiple timelines)\n *\n * If found, scrolls timeline into view and highlights the item.\n *\n * @param {string} containerSelector - CSS selector for fallback timeline container\n * @returns {void}\n */\nexport function handleDeepLinking(containerSelector) {\n  const urlParams = new URLSearchParams(window.location.search);\n  const timelineId = urlParams.get('timeline');\n  const nodeId = urlParams.get('id');\n  if (!nodeId) return;\n\n  let targetContainer;\n  if (timelineId) {\n    targetContainer = document.getElementById(timelineId);\n  } else {\n    targetContainer = document.querySelector(containerSelector);\n  }\n\n  if (!targetContainer) {\n    console.warn('Timeline not found for deep linking:', timelineId || containerSelector);\n    return;\n  }\n\n  targetContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\n  const targetNode = targetContainer.querySelector('[data-node-id=\"' + nodeId + '\"]');\n  if (targetNode) {\n    setTimeout(function() {\n      // Ensure only one active item is highlighted in this timeline\n      targetContainer.querySelectorAll('.timeline__item--active').forEach((n) => n.classList.remove('timeline__item--active'));\n      targetNode.classList.add('timeline__item--active');\n      const itemIndex = Array.from(targetNode.parentNode.children).indexOf(targetNode);\n      navigateToNodeIndex(targetContainer, itemIndex);\n    }, 500);\n  }\n}\n\n/**\n * Navigate timeline to a specific item by index\n *\n * Scrolls the timeline to display the item at the given index and updates the URL.\n * For horizontal timelines, uses horizontal scroll. For vertical, uses IntersectionObserver.\n *\n * @param {HTMLElement} container - Timeline container element\n * @param {number} index - Zero-based index of item to navigate to\n * @returns {void}\n */\nexport function navigateToNodeIndex(container, index) {\n  if (!container) return;\n  const timelineId = container.id || container.getAttribute('data-timeline-id');\n  if (!timelineId) {\n    console.warn('Cannot navigate: timeline container has no ID');\n    return;\n  }\n\n  const tlData = timelineRegistry[timelineId];\n  if (!tlData) {\n    console.warn('Timeline not found in registry:', timelineId);\n    return;\n  }\n\n  if (!container.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  if (tlData.setCurrentIndex && tlData.updatePosition) {\n    tlData.setCurrentIndex(index);\n    tlData.updatePosition();\n  }\n}\n","/**\n * Shared configuration and path resolution\n */\n\n/**\n * Resolve the base path for loading timeline assets (images, sprites, etc.)\n *\n * Auto-detects script location and maps to the correct asset directory:\n * - dist/timeline.min.js  → src/images\n * - src/js/timeline.js    → src/images\n * - Custom override via window.TimelineConfig.basePath\n *\n * Fallback: ../src/images (relative to demo pages)\n *\n * @type {string}\n */\nexport const timelineBasePath = (function() {\n  // Check for user override\n  if (typeof window !== 'undefined' && \n      window.TimelineConfig && \n      window.TimelineConfig.basePath) {\n    return window.TimelineConfig.basePath;\n  }\n  \n  const scripts = document.getElementsByTagName('script');\n  for (let i = 0; i < scripts.length; i++) {\n    const src = scripts[i].src || '';\n    if (!src) continue;\n    const dir = src.substring(0, src.lastIndexOf('/'));\n    if (src.indexOf('timeline.min.js') !== -1) {\n      // When loading from dist, map to src/images\n      return dir.replace('/dist', '/src/images');\n    }\n    if (src.indexOf('timeline.js') !== -1) {\n      // When loading from src/js, map to src/images\n      return dir.replace('/js', '/images');\n    }\n  }\n  // Fallback relative to demo pages; most demos live under demo/**\n  return '../src/images';\n})();\n\n/**\n * Minimum duration (ms) to display loading spinner\n *\n * Even if data loads quickly, show spinner for at least this duration\n * to avoid visual flashing.\n *\n * @type {number}\n */\n","/**\n * Error handling and display for timeline\n *\n * Shows user-friendly error messages when timeline initialization fails.\n * Prevents broken DOM from affecting page layout.\n */\n\nimport { timelineBasePath } from '../shared/config.js';\n\n/**\n * Display error message in timeline container\n *\n * Replaces timeline content with an error card showing icon, title, message, and solution.\n * Supports predefined error types or custom messages.\n *\n * Error types:\n *  - 'json-load': Failed to fetch JSON file (network error, CORS, 404)\n *  - 'json-parse': JSON file exists but contains invalid JSON\n *  - 'missing-element': Container element not found on page\n *  - 'invalid-config': Configuration options out of valid range\n *\n * @param {HTMLElement|null} container - Timeline container element to show error in\n * @param {string} errorType - Error type key (see list above)\n * @param {string} [details] - Optional additional details to log to console\n * @returns {void}\n */\nexport function showTimelineError(container, errorType, details) {\n  if (!container) return;\n\n  const errorMessages = {\n    'json-load': {\n      title: 'Timeline Data Could Not Be Loaded',\n      message: 'The timeline data failed to load. This could be due to a network error or an incorrect file path.',\n      solution: 'Please check that the data-json-config path is correct and the file is accessible.'\n    },\n    'json-parse': {\n      title: 'Invalid Timeline Data',\n      message: 'The timeline data file exists but contains invalid JSON.',\n      solution: 'Please validate your JSON using a tool like jsonlint.com and ensure it follows the correct schema.'\n    },\n    'missing-element': {\n      title: 'Timeline Element Not Found',\n      message: 'The required timeline container element could not be found on the page.',\n      solution: 'Ensure your HTML includes a container with the class \"timeline\" and the correct selector.'\n    },\n    'invalid-config': {\n      title: 'Invalid Configuration',\n      message: 'One or more timeline configuration options are invalid.',\n      solution: 'Check your data attributes or JavaScript options and ensure they match the expected format.'\n    }\n  };\n\n  const errorInfo = errorMessages[errorType] || {\n    title: 'Timeline Error',\n    message: 'An unexpected error occurred while initializing the timeline.',\n    solution: 'Please check the browser console for more details.'\n  };\n\n  // mark container as error state so timeline visuals (lines, nav buttons) can be hidden via CSS\n  container.classList.add('timeline--error');\n  container.innerHTML = '';\n\n  const errorDiv = document.createElement('div');\n  errorDiv.className = 'timeline__error';\n\n  const errorIcon = document.createElement('img');\n  errorIcon.src = timelineBasePath + '/alert.svg';\n  errorIcon.alt = 'Error';\n  errorIcon.className = 'timeline__error-icon';\n  // Ensure a reasonable default size even if CSS isn't loaded\n  // This makes the error icon usable when a consumer forgets to include CSS.\n  errorIcon.width = 200;\n  errorIcon.style.height = 'auto';\n\n  const errorTitle = document.createElement('h2');\n  errorTitle.className = 'timeline__error-title';\n  errorTitle.textContent = errorInfo.title;\n\n  const errorMessage = document.createElement('p');\n  errorMessage.className = 'timeline__error-message';\n  errorMessage.textContent = errorInfo.message;\n\n  const errorSolution = document.createElement('p');\n  errorSolution.className = 'timeline__error-solution';\n  errorSolution.innerHTML = '<strong>Solution:</strong> ' + errorInfo.solution;\n\n  if (details) {\n    const errorDetails = document.createElement('p');\n    errorDetails.className = 'timeline__error-details';\n    errorDetails.innerHTML = '<strong>Details:</strong> ' + details;\n    errorDiv.appendChild(errorDetails);\n  }\n\n  errorDiv.appendChild(errorIcon);\n  errorDiv.appendChild(errorTitle);\n  errorDiv.appendChild(errorMessage);\n  errorDiv.appendChild(errorSolution);\n\n  container.appendChild(errorDiv);\n\n  console.error('Timeline Error [' + errorType + ']:', errorInfo.message, details || '');\n\n  // Emit a global event so host pages can react (e.g., cancel instructions UI)\n  try {\n    const evt = new CustomEvent('timeline:error', {\n      detail: {\n        type: errorType,\n        message: errorInfo.message,\n        details: details || null,\n        containerId: container.id || null\n      }\n    });\n    window.dispatchEvent(evt);\n  } catch (e) {\n    // ignore event errors in very old browsers\n  }\n}\n","/**\n * Shared utility functions for color and styling calculations\n */\n\n/**\n * Get a contrasting overlay color for the given background color\n *\n * Returns a semi-transparent dark or light overlay color based on the brightness\n * of the input color to ensure sufficient contrast.\n *\n * @param {string} bgColor - CSS color value (hex, rgb, or rgba)\n * @returns {string} - 'rgba(0, 0, 0, 0.2)' for bright backgrounds, 'rgba(255, 255, 255, 0.3)' for dark\n */\nexport function getContrastColor(bgColor) {\n  const brightness = getColorBrightness(bgColor);\n  return brightness > 128 ? 'rgba(0, 0, 0, 0.2)' : 'rgba(255, 255, 255, 0.3)';\n}\n\n/**\n * Calculate perceived brightness of a color using relative luminance\n *\n * Uses the standard formula (RGB to perceived brightness) to determine if a color\n * is light (> 128) or dark (< 128). Handles hex (#fff, #ffffff), rgb(), and rgba() formats.\n *\n * @param {string} color - CSS color value (hex, rgb, or rgba)\n * @returns {number} - Brightness value 0-255 (or 128 if input invalid)\n */\nexport function getColorBrightness(color) {\n  let rgb;\n  if (!color || typeof color !== 'string') return 128;\n\n  if (color.startsWith('#')) {\n    let hex = color.substring(1);\n    if (hex.length === 3) {\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n    }\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    rgb = [r, g, b];\n  } else if (color.startsWith('rgb')) {\n    const matches = color.match(/\\d+/g);\n    rgb = matches ? matches.map(Number) : [128, 128, 128];\n  } else {\n    return 128;\n  }\n\n  return (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;\n}\n\n/**\n * Format a date string into a human-friendly, locale-aware label.\n * If parsing fails, returns the original input.\n * Example output: \"October 23rd, 2023\"\n *\n * @param {string} dateString\n * @param {string} [locale=navigator.language]\n * @returns {string}\n */\nexport function formatAccessibleDate(dateString, locale = (typeof navigator !== 'undefined' && navigator.language) || 'en-US') {\n  if (!dateString || typeof dateString !== 'string') return String(dateString);\n  const parsed = Date.parse(dateString);\n  if (Number.isNaN(parsed)) {\n    // Try common MM/DD/YYYY or YYYY-MM-DD heuristics\n      const parts = dateString.split(/[\\/\\.\\-]/).map(p => p.trim());\n    if (parts.length === 3) {\n      // Assume MM/DD/YYYY if month <= 12\n      let mm = parseInt(parts[0], 10);\n      let dd = parseInt(parts[1], 10);\n      let yy = parseInt(parts[2], 10);\n      if (!Number.isNaN(mm) && !Number.isNaN(dd) && !Number.isNaN(yy)) {\n        // Normalize year\n        if (yy < 100) yy += 2000;\n        const d = new Date(yy, mm - 1, dd);\n        if (!Number.isNaN(d.getTime())) {\n          return formatDateWithOrdinal(d, locale);\n        }\n      }\n    }\n    return dateString;\n  }\n  const d = new Date(parsed);\n  return formatDateWithOrdinal(d, locale);\n}\n\nfunction ordinalSuffix(n) {\n  const s = [\"th\", \"st\", \"nd\", \"rd\"], v = n % 100;\n  return (s[(v - 20) % 10] || s[v] || s[0]);\n}\n\nfunction formatDateWithOrdinal(dateObj, locale) {\n  try {\n    const fmt = new Intl.DateTimeFormat(locale, { month: 'long', day: 'numeric', year: 'numeric' });\n    // Use formatToParts to insert ordinal for day\n    if (typeof Intl.DateTimeFormat.prototype.formatToParts === 'function') {\n      const parts = new Intl.DateTimeFormat(locale, { month: 'long', day: 'numeric', year: 'numeric' }).formatToParts(dateObj);\n      let month = '';\n      let day = '';\n      let year = '';\n      parts.forEach(p => {\n        if (p.type === 'month') month = p.value;\n        if (p.type === 'day') day = p.value;\n        if (p.type === 'year') year = p.value;\n      });\n      const dayNum = parseInt(day, 10) || dateObj.getDate();\n      return `${month} ${dayNum}${ordinalSuffix(dayNum)}, ${year}`;\n    }\n    return fmt.format(dateObj);\n  } catch (e) {\n    return dateObj.toDateString();\n  }\n}\n","/**\n * Timeline color theming\n *\n * Applies dynamic color customization to timeline elements using CSS custom properties.\n * Automatically calculates accessible navigation arrow colors based on background brightness.\n */\n\nimport { getContrastColor, getColorBrightness } from '../shared/utils.js';\n\n/**\n * Apply color customization to a timeline\n *\n * Sets CSS custom properties for node, line, and navigation colors. Automatically\n * calculates arrow color (light/dark) for accessible navigation based on navColor brightness.\n *\n * @param {HTMLElement} container - Timeline container element\n * @param {Object} config - Color configuration\n * @param {string} [config.nodeColor] - CSS color for timeline nodes (circle or box)\n * @param {string} [config.lineColor] - CSS color for timeline connector line\n * @param {string} [config.navColor] - CSS color for navigation buttons/arrows\n * @returns {void}\n */\nexport function applyTimelineColors(container, config) {\n  let nodeColor = config.nodeColor || null;\n  let lineColor = config.lineColor || null;\n  const navColor = config.navColor || null;\n\n  if (nodeColor && !lineColor) lineColor = nodeColor;\n  if (lineColor && !nodeColor) nodeColor = lineColor;\n\n  if (nodeColor) {\n    container.style.setProperty('--timeline-node-color', nodeColor);\n    // Use configured nodeColor for the active/current item outline\n    container.style.setProperty('--timeline-active-outline-color', nodeColor);\n  }\n  if (lineColor) {\n    container.style.setProperty('--timeline-line-color', lineColor);\n  }\n  if (navColor) {\n    container.style.setProperty('--timeline-nav-color', navColor);\n    container.style.setProperty('--timeline-nav-border', getContrastColor(navColor));\n    const brightness = getColorBrightness(navColor);\n    const arrowColor = brightness > 128 ? '#333' : '#fff';\n    container.style.setProperty('--timeline-arrow-color', arrowColor);\n    container.setAttribute('data-arrow-color', arrowColor);\n  }\n}\n","/**\n * Swiper carousel adapter for timeline\n *\n * Optional integration with Swiper (https://swiperjs.com/) for touch-friendly carousel navigation.\n * Dynamically loads Swiper library with fallback strategies and gracefully degrades if unavailable.\n *\n * Swiper resolution order:\n *  1. ESM CDN URL provided via options.swiperCdn\n *  2. NPM-installed package (dynamic import)\n *  3. Global window.Swiper (UMD CDN bundle)\n *\n * If Swiper not found, timeline still functions normally without carousel.\n */\n\nexport default class SwiperAdapter {\n  /**\n   * Create adapter instance\n   */\n  constructor() {\n    /** @type {Object|null} Swiper library instance */\n    this.swiper = null;\n    /** @type {HTMLElement|null} Timeline wrap element (Swiper container) */\n    this._container = null;\n    /** @type {Object} Original DOM state (classes, attributes) for restoration on destroy */\n    this._original = {};\n  }\n\n  /**\n   * Initialize Swiper for timeline\n   *\n   * Attempts to resolve Swiper library and configure it for timeline carousel mode.\n   * Adds required Swiper classes (swiper, swiper-wrapper, swiper-slide) to DOM.\n   * Gracefully returns null if Swiper unavailable.\n   *\n   * @param {HTMLElement} timelineEl - Timeline container element\n   * @param {Object} timelineApi - Timeline API object (unused, for future extensibility)\n   * @param {Object} [options={}] - Swiper configuration options\n   * @param {string} [options.swiperCdn] - ESM CDN URL for Swiper library\n   * @param {...any} [options.otherOptions] - Additional Swiper options (passed to Swiper constructor)\n   * @returns {Promise<Object|null>} Swiper instance, or null if initialization failed or library unavailable\n   */\n  async init(timelineEl, timelineApi, options = {}) {\n    this._container = timelineEl.querySelector('.timeline__wrap');\n    if (!this._container) {\n      console.warn('SwiperAdapter: No .timeline__wrap found');\n      return null;\n    }\n\n    let SwiperLib = null;\n    // Try ESM CDN if provided via options.swiperCdn\n    if (options && options.swiperCdn && typeof options.swiperCdn === 'string') {\n      try {\n        const mod = await import(/* @vite-ignore */ options.swiperCdn);\n        SwiperLib = mod.default || mod.Swiper || mod || null;\n      } catch (e) {\n        console.warn('SwiperAdapter: failed to import swiper from swiperCdn:', e);\n      }\n    }\n\n    // Try package import (npm-installed) if not already resolved\n    if (!SwiperLib) {\n      try {\n        const mod = await import('swiper');\n        SwiperLib = mod.default || mod.Swiper || mod || null;\n      } catch (e) {\n        // ignore - handled by fallback\n      }\n    }\n\n    // Fallback to global window.Swiper (UMD bundle via CDN)\n    if (!SwiperLib && typeof window !== 'undefined' && window.Swiper) {\n      SwiperLib = window.Swiper;\n    }\n\n    if (!SwiperLib) {\n      // Friendly, one-time notice. Remember via localStorage.\n      try {\n        const seen = typeof Storage !== 'undefined' && localStorage.getItem('swiperJSLib');\n        if (!(seen === '0' || seen === 'false')) {\n          console.log('SwiperAdapter: Swiper library not found (tried options.swiperCdn, dynamic import, and window.Swiper)');\n          if (typeof Storage !== 'undefined') localStorage.setItem('swiperJSLib', '0');\n        }\n      } catch (e) {\n        // no-op if storage inaccessible\n        console.log('SwiperAdapter: Swiper library not found (tried options.swiperCdn, dynamic import, and window.Swiper)');\n      }\n      return null;\n    }\n\n    // Preserve original classes/styles so we can restore on destroy\n    const items = this._container.querySelector('.timeline__items');\n    this._original.itemsClass = items ? items.className : null;\n    this._original.itemClasses = [];\n    if (items) {\n      Array.from(items.children).forEach((child) => {\n        this._original.itemClasses.push(child.className || '');\n      });\n    }\n\n    // Add Swiper required classes\n    this._container.classList.add('swiper');\n    if (items) {\n      items.classList.add('swiper-wrapper');\n      Array.from(items.children).forEach((child) => {\n        child.classList.add('swiper-slide');\n      });\n    }\n\n    // Merge sensible defaults for timeline usage\n    const defaultOpts = Object.assign({\n      slidesPerView: 'auto',\n      freeMode: false,\n      spaceBetween: 20,\n      // Ensure horizontal direction\n      direction: 'horizontal'\n    }, options || {});\n\n    try {\n      if (typeof SwiperLib !== 'function') {\n        console.warn('SwiperAdapter: Swiper resolved but is not a constructor');\n        this.swiper = null;\n      } else {\n        this.swiper = new SwiperLib(this._container, defaultOpts);\n        try {\n          if (typeof Storage !== 'undefined') localStorage.setItem('swiperJSLib', '1');\n        } catch (_) { /* ignore storage errors */ }\n      }\n    } catch (e) {\n      console.warn('SwiperAdapter: failed to initialize Swiper instance', e);\n      this.swiper = null;\n    }\n\n    return this.swiper;\n  }\n\n  slideTo(index, opts) {\n    if (this.swiper && typeof this.swiper.slideTo === 'function') {\n      this.swiper.slideTo(index, opts && opts.speed);\n    }\n  }\n\n  slideBy(delta, opts) {\n    if (this.swiper && typeof this.swiper.slideTo === 'function' && typeof this.swiper.activeIndex === 'number') {\n      this.slideTo(this.swiper.activeIndex + delta, opts);\n    }\n  }\n\n  update() {\n    if (this.swiper && typeof this.swiper.update === 'function') this.swiper.update();\n  }\n\n  destroy() {\n    if (this.swiper && typeof this.swiper.destroy === 'function') {\n      try { this.swiper.destroy(true, true); } catch (e) { /* ignore */ }\n      this.swiper = null;\n    }\n\n    if (this._container) {\n      const items = this._container.querySelector('.timeline__items');\n      this._container.classList.remove('swiper');\n      if (items) {\n        items.classList.remove('swiper-wrapper');\n        Array.from(items.children).forEach((child, i) => {\n          child.classList.remove('swiper-slide');\n          if (this._original.itemClasses && this._original.itemClasses[i] !== undefined) {\n            child.className = this._original.itemClasses[i];\n          }\n        });\n        if (this._original.itemsClass !== null) items.className = this._original.itemsClass;\n      }\n    }\n  }\n}\n","/**\n * layout-fallbacks.js\n * \n * Applies CSS class fallbacks for missing images and summaries in timeline nodes.\n * These fallbacks ensure proper visual layout when optional content is absent.\n * \n * - `.no-image` is added to `.timeline__content` when the image is missing or fails to load\n * - `.no-summary` is added to `.timeline__content` when the summary is empty or missing\n * \n * The module also observes timeline containers for dynamically inserted items and\n * automatically applies fallbacks to new content.\n */\n\n/**\n * Apply .no-image class to timeline content nodes when images are absent or fail to load\n * @param {Document|HTMLElement} root - Root element to search within (defaults to document)\n */\nfunction applyNoImageFallback(root = document) {\n    const contents = (root || document).querySelectorAll('.timeline__content');\n    contents.forEach(c => {\n        const img = c.querySelector('.timeline__image');\n        if (!img) {\n            c.classList.add('no-image');\n            return;\n        }\n\n        // If image exists, check load state\n        if (img.complete) {\n            if (img.naturalWidth === 0) c.classList.add('no-image'); else c.classList.remove('no-image');\n        } else {\n            img.addEventListener('load', () => c.classList.remove('no-image'), { once: true });\n            img.addEventListener('error', () => c.classList.add('no-image'), { once: true });\n        }\n    });\n}\n\n/**\n * Apply .no-summary class to timeline content nodes when summary is absent or empty\n * @param {Document|HTMLElement} root - Root element to search within (defaults to document)\n */\nfunction applyNoSummaryFallback(root = document) {\n    const contents = (root || document).querySelectorAll('.timeline__content');\n    contents.forEach(c => {\n        const summary = c.querySelector('.timeline__summary');\n        const hasSummary = !!(summary && summary.textContent && summary.textContent.trim().length > 0);\n        if (!hasSummary) {\n            c.classList.add('no-summary');\n        } else {\n            c.classList.remove('no-summary');\n        }\n    });\n}\n\n/**\n * Observe timeline item containers for dynamic insertions and apply fallbacks to new content\n * Uses MutationObserver to watch for DOM changes in .timeline__items containers\n */\nfunction observeTimelineInsertions() {\n    const containers = document.querySelectorAll('.timeline__items');\n    containers.forEach(container => {\n        const mo = new MutationObserver(() => { \n            applyNoImageFallback(container); \n            applyNoSummaryFallback(container); \n        });\n        mo.observe(container, { childList: true, subtree: true });\n    });\n}\n\n/**\n * Initialize layout fallbacks for all timeline content\n * Call this after timeline is loaded or when content is added\n * @param {Document|HTMLElement} root - Root element to search within (defaults to document)\n */\nexport function initLayoutFallbacks(root = document) {\n    applyNoImageFallback(root);\n    applyNoSummaryFallback(root);\n    observeTimelineInsertions();\n}\n\nexport {\n    applyNoImageFallback,\n    applyNoSummaryFallback,\n    observeTimelineInsertions\n};\n","import { showTimelineError } from '../features/error-ui.js';\nimport { applyTimelineColors } from '../features/colors.js';\nimport { openTimelineModal } from '../features/modals.js';\nimport { timelineRegistry } from '../shared/state.js';\nimport SwiperAdapter from '../../adapters/swiper-adapter.js';\nimport { formatAccessibleDate } from '../shared/utils.js';\nimport { initLayoutFallbacks } from '../features/layout-fallbacks.js';\n\n/**\n * Calculate and apply responsive scaling for horizontal timeline based on viewport height\n *\n * Automatically adjusts node dimensions, image sizes, and font sizes to fit the available\n * viewport height while respecting minimum and maximum constraints. Uses CSS custom properties\n * to apply scaling dynamically without rebuilding the DOM.\n *\n * @param {HTMLElement} timelineEl - The timeline container element\n * @returns {void}\n */\nfunction calculateHorizontalScale(timelineEl) {\n  if (!timelineEl || !timelineEl.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  // Define constraints\n  const constraints = {\n    nodeWidth: { min: 150, max: 200, default: 200 },\n    nodeMinHeight: { min: 135, max: 180, default: 180 },\n    imageSize: { min: 80, max: 100, default: 100 },\n    titleFontSize: { min: 14, max: 18, default: 18 },\n    textFontSize: { min: 11, max: 13, default: 11 }\n  };\n\n  // Get available viewport height (minus padding/margins)\n  const viewportHeight = window.innerHeight;\n  const timelinePadding = 180; // Account for heading, margins, bottom item padding (40px), and buffer\n  const availableHeight = viewportHeight - timelinePadding;\n\n  // Calculate required height for default (max) dimensions\n  // Two rows of nodes + divider line + spacing + bottom padding\n  const maxNodeHeight = constraints.nodeMinHeight.max;\n  const requiredHeight = (maxNodeHeight * 2) + 90; // 90px for divider, spacing, and bottom item padding\n\n  // Calculate scale factor\n  let scaleFactor = 1.0;\n  if (availableHeight < requiredHeight) {\n    scaleFactor = Math.max(0.75, availableHeight / requiredHeight); // Don't scale below 75%\n  }\n\n  // Apply scaling with constraints\n  function scaleValue(config) {\n    const scaled = Math.round(config.default * scaleFactor);\n    return Math.max(config.min, Math.min(config.max, scaled));\n  }\n\n  // Set CSS custom properties\n  timelineEl.style.setProperty('--timeline-h-node-width', scaleValue(constraints.nodeWidth) + 'px');\n  timelineEl.style.setProperty('--timeline-h-node-min-height', scaleValue(constraints.nodeMinHeight) + 'px');\n  timelineEl.style.setProperty('--timeline-h-image-size', scaleValue(constraints.imageSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-title-font-size', scaleValue(constraints.titleFontSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-text-font-size', scaleValue(constraints.textFontSize) + 'px');\n}\n\nfunction ensureInlineModalData(itemEl) {\n  if (!itemEl) return;\n  const content = itemEl.querySelector('.timeline__content') || itemEl;\n  if (!itemEl.hasAttribute('data-modal-title')) {\n    const heading = content.querySelector('h1,h2,h3,h4,h5,h6');\n    if (heading && heading.textContent) {\n      itemEl.setAttribute('data-modal-title', heading.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-content')) {\n    const firstP = content.querySelector('p');\n    if (firstP && firstP.textContent) {\n      itemEl.setAttribute('data-modal-content', firstP.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-image')) {\n    const img = content.querySelector('img');\n    if (img && img.getAttribute('src')) {\n      itemEl.setAttribute('data-modal-image', img.getAttribute('src'));\n    }\n  }\n}\n\nfunction ensureAccessibleLabelForInlineItem(itemEl) {\n  if (!itemEl) return;\n  // If an explicit aria-label is present, leave it alone\n  if (itemEl.hasAttribute('aria-label')) return;\n  // If already aria-labelledby, nothing to do\n  if (itemEl.hasAttribute('aria-labelledby')) return;\n\n  // Check for data-aria-label attribute (dataset.ariaLabel)\n  const dataLabel = itemEl.dataset && itemEl.dataset.ariaLabel;\n  let labelText = dataLabel && String(dataLabel).trim();\n\n  // Otherwise, build from existing DOM: date + heading\n  if (!labelText || labelText === '') {\n    const dateEl = itemEl.querySelector('.timeline__date');\n    const headingEl = itemEl.querySelector('.timeline__heading');\n    const dateText = dateEl ? dateEl.textContent.trim() : '';\n    const headingText = headingEl ? headingEl.textContent.trim() : '';\n    if (dateText || headingText) {\n      const formattedDate = dateText ? formatAccessibleDate(dateText) : '';\n      labelText = (dateText ? `Date: ${formattedDate}. ` : '') + (headingText ? `Title: ${headingText}` : '');\n      const idAttr = itemEl.getAttribute('data-node-id');\n      if (idAttr) labelText = `Node ${idAttr}: ` + labelText;\n    }\n  }\n\n  if (labelText && labelText !== '') {\n    const labelId = 'tl-label-' + Math.random().toString(36).slice(2, 9);\n    const sr = document.createElement('span');\n    sr.className = 'sr-only';\n    sr.id = labelId;\n    sr.textContent = labelText;\n    itemEl.appendChild(sr);\n    itemEl.setAttribute('aria-labelledby', labelId);\n  }\n}\n\nfunction enhanceInlineItems(timelineEl, items) {\n  if (!items || !items.length) return;\n  items.forEach(function(item){\n    if (item.getAttribute('data-modal-bound') === '1') return;\n    ensureInlineModalData(item);\n    ensureAccessibleLabelForInlineItem(item);\n    const hasModal = item.hasAttribute('data-modal-title') || item.hasAttribute('data-modal-content') || item.hasAttribute('data-modal-image') || item.hasAttribute('data-modal-html');\n    if (hasModal) {\n      item.addEventListener('click', function(e){\n        e.preventDefault();\n        openTimelineModal(item);\n      });\n      item.setAttribute('data-modal-bound', '1');\n    }\n  });\n}\n\nfunction createArrowSVG(direction, color) {\n  if (direction === 'left') {\n    return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.8 1L1 7l5.8 6\"/></svg>';\n  }\n  return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M1 1l5.8 6L1 13\"/></svg>';\n}\n\nfunction clampInt(value, min, max) {\n  const n = parseInt(value, 10);\n  if (Number.isNaN(n)) return min;\n  return Math.max(min, Math.min(max, n));\n}\n\n// Exported resolver for testing and external use\n/**\n * Resolve the effective node side for sameSideNodes feature\n *\n * This is the same logic used internally by the timeline engine but\n * exposed as a top-level export to allow unit testing.\n *\n * @param {Object} settings - Timeline settings object\n * @param {string} mode - 'horizontal' or 'vertical'\n * @param {boolean} rtl - Right-to-left mode flag\n * @returns {string|null}\n */\nexport function resolveSide(settings, mode, rtl) {\n  const hDefault = 'top';\n  const vDefault = 'left';\n\n  let s = settings && settings.sameSideNodes;\n  if (s === undefined || s === false || s === 'false') return null;\n\n  if (s === 'true' || s === true) {\n    if (mode === 'horizontal') return settings.horizontalStartPosition || hDefault;\n    return settings.verticalStartPosition || vDefault;\n  }\n\n  s = String(s).toLowerCase();\n  if (mode === 'horizontal') {\n    if (s === 'top' || s === 'bottom') return s;\n    if (s === 'left') return 'top';\n    if (s === 'right') return 'bottom';\n    return hDefault;\n  }\n\n  if (settings && settings.verticalStartPosition) return settings.verticalStartPosition;\n  if (s === 'top') {\n    return rtl ? 'right' : 'left';\n  }\n  if (s === 'bottom') {\n    return rtl ? 'left' : 'right';\n  }\n  if (s === 'left' || s === 'right') return s;\n  return vDefault;\n}\n\n/**\n * Check if URL deep-link should update this specific timeline instance\n * @param {HTMLElement} timelineEl - Timeline container element\n * @returns {boolean} - True if this timeline should respond to URL deep-link\n * @private\n */\nfunction shouldUpdateDeepLinkForTimeline(timelineEl) {\n  if (typeof window === 'undefined' || !window.location) return false;\n  const params = new URLSearchParams(window.location.search);\n  if (!params.has('id')) return false;\n  const timelineParam = params.get('timeline');\n  // If a specific timeline is deep-linked, only update URL for that one.\n  if (timelineParam && timelineEl && timelineEl.id) {\n    return timelineParam === timelineEl.id;\n  }\n  // If no timeline param provided, treat as generic deep link.\n  return true;\n}\n\n/**\n * Update browser URL with current timeline item ID for deep linking\n * @param {HTMLElement} timelineEl - Timeline container element\n * @param {string|number} nodeId - ID of the current node\n * @returns {void}\n * @private\n */\nfunction updateDeepLinkUrl(timelineEl, nodeId) {\n  if (!timelineEl || !nodeId || typeof window === 'undefined' || !window.history) return;\n  if (!shouldUpdateDeepLinkForTimeline(timelineEl)) return;\n  const url = new URL(window.location.href);\n  const params = url.searchParams;\n  if (timelineEl.id) {\n    params.set('timeline', timelineEl.id);\n  }\n  params.set('id', String(nodeId));\n  url.search = params.toString();\n  window.history.replaceState({}, '', url.toString());\n}\n\nexport function timeline(collection, options) {\n  /**\n   * Initialize and render timeline(s) for the provided element(s)\n   *\n   * Main API entry point. Accepts a DOM element or collection and initializes timeline(s)\n   * with responsive mode switching, IntersectionObserver animation, event handling, and cleanup.\n   *\n   * @param {HTMLElement|NodeList|HTMLCollection} collection - Target element(s) to initialize timeline\n   * @param {Object} [options] - Configuration options (overrides data attributes)\n   * @param {string} [options.mode='vertical'] - 'horizontal' or 'vertical' layout\n   * @param {number} [options.minWidth=600] - Width below which to switch to vertical (for horizontal)\n   * @param {number} [options.maxWidth=600] - Width above which to switch to horizontal (for vertical)\n   * @param {string} [options.horizontalStartPosition='top'] - 'top' or 'bottom' for horizontal\n   * @param {string} [options.verticalStartPosition='left'] - 'left' or 'right' for vertical\n   * @param {number} [options.startIndex=0] - Initial index to display\n   * @param {number} [options.moveItems=1] - Number of items to scroll with nav buttons\n   * @param {boolean} [options.rtlMode=false] - Right-to-left layout support\n   * @param {string} [options.verticalTrigger='15%'] - When to show items in vertical (px or %)\n   * @param {string} [options.useSwiper='false'] - 'true'|'false'|'auto' for Swiper carousel\n   * @param {string} [options.sameSideNodes='false'] - Render all nodes on same side (feature)\n   * @param {Object} [options.nodeColor] - CSS color for timeline nodes\n   * @param {Object} [options.lineColor] - CSS color for timeline line\n   * @param {Object} [options.navColor] - CSS color for navigation elements\n   * @returns {void}\n   */\n  const timelines = [];\n  const warningLabel = 'Timeline:';\n  let winWidth = window.innerWidth;\n  let resizeTimer;\n  const eventListeners = new Map(); // Track event listeners for cleanup on destroy/reset\n\n  const defaultSettings = {\n    minWidth: { type: 'integer', defaultValue: 600 },\n    maxWidth: { type: 'integer', defaultValue: 600 },\n    horizontalStartPosition: { type: 'string', acceptedValues: ['bottom', 'top'], defaultValue: 'top' },\n    mode: { type: 'string', acceptedValues: ['horizontal', 'vertical'], defaultValue: 'vertical' },\n    moveItems: { type: 'integer', defaultValue: 1 },\n    rtlMode: { type: 'boolean', acceptedValues: [true, false], defaultValue: false },\n    startIndex: { type: 'integer', defaultValue: 0 },\n    verticalStartPosition: { type: 'string', acceptedValues: ['left', 'right'], defaultValue: 'left' },\n    verticalTrigger: { type: 'string', defaultValue: '15%' },\n    useSwiper: { type: 'string', acceptedValues: ['false', 'true', 'auto'], defaultValue: 'false' },\n    sameSideNodes: { type: 'string', acceptedValues: ['top', 'bottom', 'left', 'right', 'true', 'false'], defaultValue: 'false' }\n  };\n\n  // Helper to resolve effective side based on sameSideNodes setting and orientation\n  /**\n   * Resolve the effective node side for sameSideNodes feature\n   *\n   * When sameSideNodes is enabled, determines which side (top/bottom/left/right) all timeline\n   * nodes should render on, based on configuration and orientation. Handles RTL mode and\n   * responsive orientation switching.\n   *\n   * @param {Object} settings - Timeline settings object\n   * @param {string} mode - 'horizontal' or 'vertical'\n   * @param {boolean} rtl - Right-to-left mode flag\n   * @returns {string|null} - 'top'|'bottom'|'left'|'right' or null if sameSideNodes disabled\n   * @private\n   */\n  function resolveSide(settings, mode, rtl) {\n    // mode: 'horizontal' or 'vertical'\n    const hDefault = 'top';\n    const vDefault = 'left';\n\n    let s = settings.sameSideNodes;\n    if (s === undefined || s === false || s === 'false') return null;\n\n    // Normalize string values\n    if (s === 'true' || s === true) {\n      // Boolean true: use orientation-specific start position (explicit or default)\n      if (mode === 'horizontal') return settings.horizontalStartPosition || hDefault;\n      return settings.verticalStartPosition || vDefault;\n    }\n\n    // s is an explicit string: could be 'top'|'bottom'|'left'|'right'\n    s = String(s).toLowerCase();\n    if (mode === 'horizontal') {\n      // If explicit horizontal string provided, prefer it\n      if (s === 'top' || s === 'bottom') return s;\n      // If explicit vertical string provided, map to horizontal (left->top, right->bottom)\n      if (s === 'left') return 'top';\n      if (s === 'right') return 'bottom';\n      return hDefault;\n    }\n\n    // vertical mode: prefer explicit verticalStartPosition if provided in settings\n    if (settings.verticalStartPosition) return settings.verticalStartPosition;\n    // Map explicit horizontal string to vertical side\n    if (s === 'top') {\n      return rtl ? 'right' : 'left';\n    }\n    if (s === 'bottom') {\n      return rtl ? 'left' : 'right';\n    }\n    if (s === 'left' || s === 'right') return s;\n    return vDefault;\n  }\n\n  function testValues(value, settingName) {\n    if (typeof value !== 'number' && value % 1 !== 0) {\n      console.warn(`${warningLabel} The value \"${value}\" entered for the setting \"${settingName}\" is not an integer.`);\n      return false;\n    }\n    return true;\n  }\n\n  function itemWrap(el, wrapper, classes) {\n    wrapper.classList.add(classes);\n    el.parentNode.insertBefore(wrapper, el);\n    wrapper.appendChild(el);\n  }\n\n  function wrapElements(items) {\n    items.forEach((item) => {\n      itemWrap(item.querySelector('.timeline__content'), document.createElement('div'), 'timeline__content__wrap');\n      itemWrap(item.querySelector('.timeline__content__wrap'), document.createElement('div'), 'timeline__item__inner');\n    });\n  }\n\n  function isElementInViewport(el, triggerPosition) {\n    const rect = el.getBoundingClientRect();\n    const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    let triggerUnit = triggerPosition.unit;\n    let triggerValue = triggerPosition.value;\n    let trigger = windowHeight;\n    if (triggerUnit === 'px' && triggerValue >= windowHeight) {\n      console.warn('The value entered for the setting \"verticalTrigger\" is larger than the window height. The default value will be used instead.');\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n    if (triggerUnit === 'px') {\n      trigger = parseInt(trigger - triggerValue, 10);\n    } else if (triggerUnit === '%') {\n      trigger = parseInt(trigger * ((100 - triggerValue) / 100), 10);\n    }\n    return (\n      rect.top <= trigger &&\n      rect.left <= (window.innerWidth || document.documentElement.clientWidth) &&\n      (rect.top + rect.height) >= 0 &&\n      (rect.left + rect.width) >= 0\n    );\n  }\n\n  function addTransforms(el, transform) {\n    el.style.webkitTransform = transform;\n    el.style.msTransform = transform;\n    el.style.transform = transform;\n  }\n\n  function createTimelines(timelineEl) {\n    const timelineName = timelineEl.id ? `#${timelineEl.id}` : `.${timelineEl.className}`;\n    const errorPart = 'could not be found as a direct descendant of';\n    const data = timelineEl.dataset;\n    let wrap;\n    let scroller;\n    let items;\n    const settings = {};\n\n    try {\n      wrap = timelineEl.querySelector('.timeline__wrap');\n      if (!wrap) {\n        throw new Error(`${warningLabel} .timeline__wrap ${errorPart} ${timelineName}`);\n      } else {\n        scroller = wrap.querySelector('.timeline__items');\n        if (!scroller) {\n          throw new Error(`${warningLabel} .timeline__items ${errorPart} .timeline__wrap`);\n        } else {\n          items = [].slice.call(scroller.children, 0);\n        }\n      }\n    } catch (e) {\n      console.warn(e.message);\n      showTimelineError(timelineEl, 'missing-element', e.message);\n      return false;\n    }\n\n    Object.keys(defaultSettings).forEach((key) => {\n      settings[key] = defaultSettings[key].defaultValue;\n\n      \n\n      if (key === 'minWidth') {\n        let candidate = undefined;\n        if (data.minWidth !== undefined) candidate = data.minWidth;\n        if (data.minwidth !== undefined) candidate = data.minwidth;\n        if (data.forceVerticalMode !== undefined) candidate = data.forceVerticalMode;\n        if (data.forceverticalmode !== undefined) candidate = data.forceverticalmode;\n        if (candidate === undefined && options) {\n          if (options.minWidth !== undefined) candidate = options.minWidth;\n          else if (options.forceVerticalMode !== undefined) candidate = options.forceVerticalMode;\n        }\n        if (candidate !== undefined) settings.minWidth = candidate;\n      } else if (key === 'maxWidth') {\n        let candidate = undefined;\n        if (data.maxWidth !== undefined) candidate = data.maxWidth;\n        if (data.maxwidth !== undefined) candidate = data.maxwidth;\n        if (candidate === undefined && options) {\n          if (options.maxWidth !== undefined) candidate = options.maxWidth;\n        }\n        if (candidate !== undefined) settings.maxWidth = candidate;\n      } else {\n        if (data[key]) {\n          settings[key] = data[key];\n        } else if (options && options[key] !== undefined) {\n          settings[key] = options[key];\n        }\n      }\n\n      if (defaultSettings[key].type === 'integer') {\n        if (!settings[key] || !testValues(settings[key], key)) {\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      } else if (defaultSettings[key].type === 'string') {\n        if (defaultSettings[key].acceptedValues && defaultSettings[key].acceptedValues.indexOf(settings[key]) === -1) {\n          console.warn(`${warningLabel} The value \"${settings[key]}\" entered for the setting \"${key}\" was not recognised.`);\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      }\n    });\n\n    (function applyColorParity(){\n      const data = timelineEl.dataset;\n      const getData = function(k){\n        return data[k] !== undefined ? data[k] : (data[k && k.toLowerCase()] !== undefined ? data[k.toLowerCase()] : undefined);\n      };\n      let nodeColor = getData('nodeColor');\n      let lineColor = getData('lineColor');\n      let navColor = getData('navColor');\n      if (options) {\n        if (options.nodeColor !== undefined) nodeColor = options.nodeColor;\n        if (options.lineColor !== undefined) lineColor = options.lineColor;\n        if (options.navColor !== undefined) navColor = options.navColor;\n      }\n      if (nodeColor || lineColor || navColor) {\n        applyTimelineColors(timelineEl, { nodeColor, lineColor, navColor });\n      }\n    })();\n\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    const triggerArray = settings.verticalTrigger.match(/(\\d*\\.?\\d*)(.*)/);\n    let [, triggerValue, triggerUnit] = triggerArray;\n    let triggerValid = true;\n    if (!triggerValue) {\n      console.warn(`${warningLabel} No numercial value entered for the 'verticalTrigger' setting.`);\n      triggerValid = false;\n    }\n    if (triggerUnit !== 'px' && triggerUnit !== '%') {\n      console.warn(`${warningLabel} The setting 'verticalTrigger' must be a percentage or pixel value.`);\n      triggerValid = false;\n    }\n    if (triggerUnit === '%' && (triggerValue > 100 || triggerValue < 0)) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be between 0 and 100 if using a percentage value.`);\n      triggerValid = false;\n    } else if (triggerUnit === 'px' && triggerValue < 0) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be above 0 if using a pixel value.`);\n      triggerValid = false;\n    }\n\n    if (triggerValid === false) {\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n\n    settings.verticalTrigger = {\n      unit: triggerUnit,\n      value: triggerValue\n    };\n\n    // Sanity-check moveItems: cap to total items if it's larger than available\n    if (settings.moveItems > items.length) {\n      console.warn(`${warningLabel} The value of \"moveItems\" (${settings.moveItems}) is larger than the total number of items (${items.length}). It has been reduced to ${items.length}.`);\n      settings.moveItems = items.length;\n    }\n\n    // Sanity-check startIndex: ensure it's within 0..items.length-1\n    if (settings.startIndex < 0) {\n      console.warn(`${warningLabel} The 'startIndex' setting must be >= 0. The value of 0 has been used instead.`);\n      settings.startIndex = 0;\n    } else if (settings.startIndex > Math.max(0, items.length - 1)) {\n      console.warn(`${warningLabel} The 'startIndex' setting is larger than the last index for this timeline. It has been reduced to ${Math.max(0, items.length - 1)}.`);\n      settings.startIndex = Math.max(0, items.length - 1);\n    }\n\n    // Swiper integration settings (optional)\n    // Accept via data attributes (data-use-swiper=\"true|auto\") or via options.swiperAdapter / options.useSwiper\n    if (data.useSwiper !== undefined || data.useswiper !== undefined) {\n      const val = data.useSwiper !== undefined ? data.useSwiper : data.useswiper;\n      settings.useSwiper = val === 'true' || val === 'auto' ? val : (val === 'true');\n    }\n    if (options) {\n      if (options.useSwiper !== undefined) settings.useSwiper = options.useSwiper;\n      if (options.swiperOptions !== undefined) settings.swiperOptions = options.swiperOptions;\n      if (options.swiperAdapter !== undefined) settings.swiperAdapter = options.swiperAdapter;\n    }\n\n    enhanceInlineItems(timelineEl, items);\n\n    if (!timelineEl.id) {\n      timelineEl.setAttribute('data-timeline-id', 'timeline-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9));\n    }\n\n    timelines.push({\n      timelineEl,\n      wrap,\n      scroller,\n      items,\n      settings,\n      listeners: [], // Store listeners for cleanup\n      adapter: null\n    });\n  }\n\n  if (collection.length) {\n    Array.from(collection).forEach(createTimelines);\n  }\n\n  function setHeightandWidths(tl) {\n    function setWidths() {\n      // Get the current scaled node width from CSS variable\n      const computedStyle = getComputedStyle(tl.timelineEl);\n      const nodeWidth = parseInt(computedStyle.getPropertyValue('--timeline-h-node-width')) || 200;\n      tl.itemWidth = nodeWidth;\n      tl.items.forEach((item) => {\n        item.style.width = `${tl.itemWidth}px`;\n      });\n      tl.scrollerWidth = tl.itemWidth * tl.items.length;\n      tl.scroller.style.width = `${tl.scrollerWidth}px`;\n    }\n\n    function setHeights() {\n      let oddIndexTallest = 0;\n      let evenIndexTallest = 0;\n      tl.items.forEach((item, i) => {\n        item.style.height = 'auto';\n        const height = item.offsetHeight;\n        if (i % 2 === 0) {\n          evenIndexTallest = height > evenIndexTallest ? height : evenIndexTallest;\n        } else {\n          oddIndexTallest = height > oddIndexTallest ? height : oddIndexTallest;\n        }\n      });\n\n      const transformString = `translateY(${evenIndexTallest}px)`;\n      // Determine effective horizontal start side (top/bottom) based on sameSideNodes or explicit setting\n      const effectiveHSide = resolveSide(tl.settings, 'horizontal', tl.settings.rtlMode) || tl.settings.horizontalStartPosition;\n      const isSameSide = !!resolveSide(tl.settings, 'horizontal', tl.settings.rtlMode); // True if sameSideNodes is enabled\n      if (isSameSide) {\n        tl.timelineEl.classList.add('timeline--same-side');\n      } else {\n        tl.timelineEl.classList.remove('timeline--same-side');\n      }\n      tl.items.forEach((item, i) => {\n        if (i % 2 === 0) {\n          item.style.height = `${evenIndexTallest}px`;\n          if (effectiveHSide === 'bottom') {\n            item.classList.add('timeline__item--bottom');\n            if (isSameSide) {\n              // When sameSideNodes is set, don't apply transform to maintain same-side rendering\n            } else {\n              addTransforms(item, transformString);\n            }\n          } else {\n            item.classList.add('timeline__item--top');\n          }\n        } else {\n          item.style.height = `${oddIndexTallest}px`;\n          if (isSameSide) {\n            // When sameSideNodes is enabled, apply the same side as effectiveHSide\n            if (effectiveHSide === 'bottom') {\n              item.classList.add('timeline__item--bottom');\n            } else {\n              item.classList.add('timeline__item--top');\n            }\n          } else {\n            // When sameSideNodes is disabled, alternate sides\n            if (effectiveHSide !== 'bottom') {\n              item.classList.add('timeline__item--bottom');\n              addTransforms(item, transformString);\n            } else {\n              item.classList.add('timeline__item--top');\n            }\n          }\n        }\n      });\n      // Store heights for use in divider and arrow positioning  \n      tl.evenIndexTallest = evenIndexTallest;\n      tl.oddIndexTallest = oddIndexTallest;\n      // Set scroller height\n      // When same-side mode is active, use only the tallest height (not summed)\n      // When alternating, use sum of top and bottom heights\n      // Add 10px buffer to prevent dot clipping (dots extend 10px beyond their center)\n      if (isSameSide) {\n        const tallestHeight = Math.max(evenIndexTallest, oddIndexTallest);\n        tl.scroller.style.height = `${tallestHeight + 10}px`;\n      } else {\n        tl.scroller.style.height = `${evenIndexTallest + oddIndexTallest}px`;\n      }\n      // Compute how many items fit in the viewport for this timeline\n      try {\n        tl.computedVisibleCount = Math.floor(tl.wrap.offsetWidth / tl.itemWidth) || 1;\n      } catch (e) {\n        tl.computedVisibleCount = 1;\n      }\n    }\n\n    if (window.innerWidth > tl.settings.minWidth) {\n      setWidths();\n      setHeights();\n    }\n  }\n\n  function addNavigation(tl) {\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n\n    if (tl.items.length > itemsVisible) {\n      const prevArrow = document.createElement('button');\n      const nextArrow = document.createElement('button');\n      \n      // Calculate button position based on same-side mode\n      const effectiveHSide = resolveSide(tl.settings, 'horizontal', tl.settings.rtlMode) || tl.settings.horizontalStartPosition;\n      const isSameSide = !!resolveSide(tl.settings, 'horizontal', tl.settings.rtlMode);\n      \n      let topPosition;\n      if (isSameSide) {\n        if (effectiveHSide === 'bottom') {\n          // Bottom mode: buttons centered in top padding (30px)\n          topPosition = 30;\n        } else {\n          // Top mode: buttons centered in bottom padding (item height - 30px)\n          topPosition = tl.items[0].offsetHeight - 30;\n        }\n      } else {\n        // Alternating mode: buttons centered on the divider\n        topPosition = tl.items[0].offsetHeight;\n      }\n      \n      prevArrow.className = 'timeline-nav-button timeline-nav-button--prev';\n      nextArrow.className = 'timeline-nav-button timeline-nav-button--next';\n      prevArrow.textContent = 'Previous';\n      prevArrow.title = 'Go to previous items';\n      nextArrow.textContent = 'Next';\n      nextArrow.title = 'Go to next items';\n      prevArrow.setAttribute('aria-label', 'Previous timeline items');\n      nextArrow.setAttribute('aria-label', 'Next timeline items');\n      prevArrow.style.top = `${topPosition}px`;\n      nextArrow.style.top = `${topPosition}px`;\n\n      const arrowColor = tl.timelineEl.getAttribute('data-arrow-color') || '#333';\n      prevArrow.innerHTML = createArrowSVG('left', arrowColor);\n      nextArrow.innerHTML = createArrowSVG('right', arrowColor);\n\n      const maxActiveIndex = Math.max(0, tl.items.length - 1);\n      if (tl.activeIndex <= 0) {\n        prevArrow.classList.add('timeline-nav-button--at-start');\n        prevArrow.title = 'Already at beginning of timeline';\n        prevArrow.setAttribute('aria-disabled', 'true');\n      } else {\n        prevArrow.setAttribute('aria-disabled', 'false');\n      }\n      if (tl.activeIndex >= maxActiveIndex) {\n        nextArrow.classList.add('timeline-nav-button--at-end');\n        nextArrow.title = 'Already at end of timeline';\n        nextArrow.setAttribute('aria-disabled', 'true');\n      } else {\n        nextArrow.setAttribute('aria-disabled', 'false');\n      }\n      tl.timelineEl.appendChild(prevArrow);\n      tl.timelineEl.appendChild(nextArrow);\n    }\n  }\n\n  function addHorizontalDivider(tl) {\n    const divider = tl.timelineEl.querySelector('.timeline-divider');\n    if (divider) {\n      tl.timelineEl.removeChild(divider);\n    }\n    // Determine if same-side mode is active and which side\n    const effectiveHSide = resolveSide(tl.settings, 'horizontal', tl.settings.rtlMode) || tl.settings.horizontalStartPosition;\n    const isSameSide = !!resolveSide(tl.settings, 'horizontal', tl.settings.rtlMode);\n    \n    let topPosition;\n    if (isSameSide) {\n      if (effectiveHSide === 'bottom') {\n        // Bottom mode: divider positioned in the 60px padding at the top of items\n        // Position it in the middle of the padding (30px)\n        topPosition = 30;\n      } else {\n        // Top mode: divider positioned in the 60px padding at the bottom of items\n        // First item height + middle of padding\n        topPosition = tl.items[0].offsetHeight - 30;\n      }\n    } else {\n      // Alternating mode: divider between top and bottom nodes\n      topPosition = tl.items[0].offsetHeight;\n    }\n    \n    const horizontalDivider = document.createElement('span');\n    horizontalDivider.className = 'timeline-divider';\n    horizontalDivider.style.top = `${topPosition}px`;\n    tl.timelineEl.appendChild(horizontalDivider);\n  }\n\n  function timelinePosition(tl, index) {\n    const safeIndex = clampInt(index, 0, Math.max(0, tl.items.length - 1));\n    const originalLeft = tl.items[safeIndex].offsetLeft;\n    \n    // Account for horizontal timeline padding (60px default on each side) to ensure items\n    // aren't clipped on either edge. Calculate the position that keeps the item fully visible.\n    const timelineStyle = window.getComputedStyle(tl.timelineEl);\n    const paddingLeft = parseInt(timelineStyle.paddingLeft, 10) || 0;\n    const paddingRight = parseInt(timelineStyle.paddingRight, 10) || 0;\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemWidth = tl.items[safeIndex].offsetWidth;\n    \n    // Two constraints:\n    // 1. Left edge: position <= originalLeft - paddingLeft (so item appears after left padding)\n    // 2. Right edge: position >= originalLeft + itemWidth - viewportWidth + paddingRight (so item ends before right padding)\n    let position = originalLeft - paddingLeft;\n    const minPositionForRight = Math.max(0, originalLeft + itemWidth - viewportWidth + paddingRight);\n    position = Math.max(position, minPositionForRight);\n    position = Math.max(0, position);\n    \n    const str = `translate3d(-${position}px, 0, 0)`;\n    addTransforms(tl.scroller, str);\n  }\n\n  function updateActiveItem(tl, index) {\n    // Remove active class from all items\n    tl.items.forEach(item => item.classList.remove('timeline__item--active'));\n    // Add active class to current item\n    if (tl.items[index]) {\n      tl.items[index].classList.add('timeline__item--active');\n    }\n  }\n\n  function slideTimeline(tl) {\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n    const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n    // maxScrollIndex is intentionally not used for positioning because we want to scroll to the\n    // actual active item, even if that means translating beyond the last \"full\" viewport chunk.\n\n    const moveItems = parseInt(tl.settings.moveItems, 10);\n    \n    const handleArrowClick = function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n\n      const maxActiveIndex = Math.max(0, tl.items.length - 1);\n      const direction = this.classList.contains('timeline-nav-button--next') ? 1 : -1;\n      \n      // Calculate next active index, but when going backward and at a clamped boundary,\n      // ensure we follow the \"ideal\" path by finding the nearest step-aligned index below current\n      let nextActive = tl.activeIndex + (direction * moveItems);\n      \n      // If going backward from a potentially clamped position, find the previous aligned index\n      if (direction < 0 && tl.activeIndex > 0) {\n        // Calculate what the ideal indices would be starting from 0: 0, moveItems, 2*moveItems, ...\n        // We need the nearest aligned index *below* the current activeIndex. If the current\n        // index is itself aligned (e.g. 6 with moveItems=3), step back one. If it's not\n        // aligned (e.g. 8 with moveItems=3), the nearest aligned below it is floor(activeIndex/moveItems)*moveItems.\n        const stepsFromStart = Math.floor(tl.activeIndex / moveItems);\n        let prevAlignedIndex;\n        if (tl.activeIndex % moveItems === 0) {\n          prevAlignedIndex = (stepsFromStart - 1) * moveItems;\n        } else {\n          prevAlignedIndex = stepsFromStart * moveItems;\n        }\n        nextActive = Math.max(0, prevAlignedIndex);\n      } else if (direction > 0 && tl.activeIndex < maxActiveIndex) {\n        // Calculate next aligned step forward\n        const stepsFromStart = Math.floor(tl.activeIndex / moveItems);\n        const nextAlignedIndex = (stepsFromStart + 1) * moveItems;\n        nextActive = Math.min(maxActiveIndex, nextAlignedIndex);\n      }\n      \n      nextActive = clampInt(nextActive, 0, maxActiveIndex);\n\n      // Check if navigation would be a no-op\n      if (nextActive === tl.activeIndex) {\n        return;\n      }\n\n      // Keep scroll position aligned with the active item so the active node is always centered/visible.\n      tl.currentIndex = nextActive;\n      tl.activeIndex = nextActive;\n\n      // Update arrows based on ACTIVE index (linear user expectation)\n      if (tl.activeIndex <= 0) {\n        arrowPrev.classList.add('timeline-nav-button--at-start');\n        arrowPrev.title = 'Already at beginning of timeline';\n        arrowPrev.setAttribute('aria-disabled', 'true');\n      } else {\n        arrowPrev.classList.remove('timeline-nav-button--at-start');\n        arrowPrev.title = 'Go to previous items';\n        arrowPrev.setAttribute('aria-disabled', 'false');\n      }\n      if (tl.activeIndex >= maxActiveIndex) {\n        arrowNext.classList.add('timeline-nav-button--at-end');\n        arrowNext.title = 'Already at end of timeline';\n        arrowNext.setAttribute('aria-disabled', 'true');\n      } else {\n        arrowNext.classList.remove('timeline-nav-button--at-end');\n        arrowNext.title = 'Go to next items';\n        arrowNext.setAttribute('aria-disabled', 'false');\n      }\n\n      // Position by active index so the highlighted item is fully in view (no clipping at edges).\n      timelinePosition(tl, tl.activeIndex);\n      updateActiveItem(tl, tl.activeIndex);\n\n      const activeItem = tl.items[tl.activeIndex];\n      const nodeId = activeItem && activeItem.getAttribute('data-node-id');\n      if (nodeId) updateDeepLinkUrl(tl.timelineEl, nodeId);\n      // Remove focus from button to avoid keyboard navigation side effects\n      this.blur();\n    };\n    \n    Array.from(navArrows).forEach((arrow) => {\n      arrow.addEventListener('click', handleArrowClick);\n      tl.listeners.push({ element: arrow, type: 'click', handler: handleArrowClick });\n    });\n  }\n\n  function setUpHorinzontalTimeline(tl) {\n    tl.timelineEl.classList.add('timeline--horizontal');\n    // Calculate responsive scaling before layout calculations\n    calculateHorizontalScale(tl.timelineEl);\n    setHeightandWidths(tl);\n\n    // Compute how many items fit in the viewport for this timeline\n    const itemsVisible = Math.floor(tl.wrap.offsetWidth / tl.itemWidth) || 1;\n    tl.computedVisibleCount = itemsVisible;\n\n    if (tl.settings.rtlMode) {\n      tl.currentIndex = tl.items.length > itemsVisible ? tl.items.length - itemsVisible : 0;\n    } else {\n      tl.currentIndex = tl.settings.startIndex;\n    }\n\n    // Track the \"active\" item separately from the scroll position.\n    // Usually these are the same, but they can diverge near the end (e.g. last item).\n    tl.activeIndex = tl.currentIndex;\n\n    timelinePosition(tl, tl.currentIndex);\n    updateActiveItem(tl, tl.activeIndex);\n    addNavigation(tl);\n    addHorizontalDivider(tl);\n    slideTimeline(tl);\n\n    const timelineId = tl.timelineEl.id || tl.timelineEl.getAttribute('data-timeline-id');\n    if (timelineId) {\n      timelineRegistry[timelineId] = {\n        setCurrentIndex: function(index) {\n          const viewportWidth = tl.wrap.offsetWidth;\n          const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n          const maxScrollIndex = Math.max(0, tl.items.length - itemsVisible);\n          // Scroll position clamps to maxIndex, but the active highlight can be the actual requested item.\n          tl.activeIndex = Math.max(0, Math.min(index, tl.items.length - 1));\n          tl.currentIndex = Math.max(0, Math.min(index, maxScrollIndex));\n        },\n        updatePosition: function() {\n          timelinePosition(tl, tl.currentIndex);\n          updateActiveItem(tl, tl.activeIndex);\n          const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n          const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n          if (arrowPrev && arrowNext) {\n            const maxActiveIndex = Math.max(0, tl.items.length - 1);\n            // Use classes instead of disabled attribute to avoid focus issues\n            if (tl.activeIndex <= 0) {\n              arrowPrev.classList.add('timeline-nav-button--at-start');\n              arrowPrev.title = 'Already at beginning of timeline';\n            } else {\n              arrowPrev.classList.remove('timeline-nav-button--at-start');\n              arrowPrev.title = 'Go to previous items';\n            }\n            if (tl.activeIndex >= maxActiveIndex) {\n              arrowNext.classList.add('timeline-nav-button--at-end');\n              arrowNext.title = 'Already at end of timeline';\n            } else {\n              arrowNext.classList.remove('timeline-nav-button--at-end');\n              arrowNext.title = 'Go to next items';\n            }\n          }\n\n          const activeItem = tl.items[tl.activeIndex];\n          const nodeId = activeItem && activeItem.getAttribute('data-node-id');\n          if (nodeId) updateDeepLinkUrl(tl.timelineEl, nodeId);\n        }\n      };\n\n      // Clicking an item (dot or card) should also make it the current/active node.\n      // This runs alongside modal opening.\n      const tlData = timelineRegistry[timelineId];\n      tl.items.forEach((item, idx) => {\n        const activateHandler = () => {\n          if (!tl.timelineEl.classList.contains('timeline--horizontal')) return;\n          if (tlData && tlData.setCurrentIndex && tlData.updatePosition) {\n            tlData.setCurrentIndex(idx);\n            tlData.updatePosition();\n          }\n        };\n        item.addEventListener('click', activateHandler);\n        tl.listeners.push({ element: item, type: 'click', handler: activateHandler });\n      });\n\n      // Initialize optional Swiper adapter if requested\n      (async function tryInitAdapter(){\n        try {\n          const useSwiper = tl.settings && (tl.settings.swiperAdapter || tl.settings.useSwiper);\n          if (!useSwiper) return;\n\n          // If a custom adapter instance/factory provided in settings, use it\n          if (tl.settings.swiperAdapter) {\n            const provided = tl.settings.swiperAdapter;\n            if (typeof provided === 'function') {\n              // factory - call to create instance\n              tl.adapter = provided();\n            } else {\n              tl.adapter = provided;\n            }\n          } else {\n            // Fallback to built-in adapter scaffold which will attempt to import 'swiper'\n            tl.adapter = new SwiperAdapter();\n          }\n\n          if (tl.adapter && typeof tl.adapter.init === 'function') {\n            await tl.adapter.init(tl.timelineEl, timelineRegistry[timelineId], tl.settings.swiperOptions || {});\n          }\n        } catch (e) {\n          console.warn('Timeline: Swiper adapter initialization failed', e);\n        }\n      })();\n    }\n  }\n\n  function setUpVerticalTimeline(tl) {\n    let lastVisibleIndex = 0;\n    tl.items.forEach((item, i) => {\n      item.classList.remove('animated', 'fadeIn');\n      if (!isElementInViewport(item, tl.settings.verticalTrigger) && i > 0) {\n        item.classList.add('animated');\n      } else {\n        lastVisibleIndex = i;\n      }\n      // Determine effective vertical start side (left/right) based on sameSideNodes or explicit setting\n      const effectiveVSide = resolveSide(tl.settings, 'vertical', tl.settings.rtlMode) || tl.settings.verticalStartPosition;\n      const isSameSide = !!resolveSide(tl.settings, 'vertical', tl.settings.rtlMode); // True if sameSideNodes is enabled\n\n      if (isSameSide) {\n        tl.timelineEl.classList.add('timeline--same-side');\n      } else {\n        tl.timelineEl.classList.remove('timeline--same-side');\n      }\n\n      if (isSameSide) {\n        // When sameSideNodes is enabled, apply the same side to all items\n        if (effectiveVSide === 'right') {\n          item.classList.add('timeline__item--right');\n        } else {\n          item.classList.add('timeline__item--left');\n        }\n      } else {\n        // When sameSideNodes is disabled, alternate based on index\n        const divider = effectiveVSide === 'left' ? 1 : 0;\n        if (i % 2 === divider && window.innerWidth > tl.settings.minWidth) {\n          item.classList.add('timeline__item--right');\n        } else {\n          item.classList.add('timeline__item--left');\n        }\n      }\n    });\n    for (let i = 0; i < lastVisibleIndex; i += 1) {\n      tl.items[i].classList.remove('animated', 'fadeIn');\n    }\n    \n    // Use IntersectionObserver instead of scroll listener for better performance\n    if ('IntersectionObserver' in window) {\n      const observerOptions = {\n        rootMargin: tl.settings.verticalTrigger.unit === '%' \n          ? `${tl.settings.verticalTrigger.value}%` \n          : `${tl.settings.verticalTrigger.value}px`,\n        threshold: 0.01\n      };\n      \n      const observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            entry.target.classList.add('fadeIn');\n          }\n        });\n      }, observerOptions);\n      \n      tl.items.forEach((item) => {\n        if (item.classList.contains('animated')) {\n          observer.observe(item);\n        }\n      });\n      \n      // Store observer for cleanup\n      tl.observer = observer;\n    } else {\n      // Fallback for older browsers (though we're targeting 2018+)\n      const scrollHandler = () => {\n        tl.items.forEach((item) => {\n          if (isElementInViewport(item, tl.settings.verticalTrigger)) {\n            item.classList.add('fadeIn');\n          }\n        });\n      };\n      window.addEventListener('scroll', scrollHandler);\n      tl.listeners.push({ element: window, type: 'scroll', handler: scrollHandler });\n    }\n  }\n\n  function resetTimelines(tl) {\n    // Clean up event listeners\n    if (tl.listeners && tl.listeners.length > 0) {\n      tl.listeners.forEach(({ element, type, handler }) => {\n        element.removeEventListener(type, handler);\n      });\n      tl.listeners = [];\n    }\n    \n    // Clean up IntersectionObserver\n    if (tl.observer) {\n      tl.observer.disconnect();\n      tl.observer = null;\n    }\n    // Destroy adapter if present\n    if (tl.adapter && typeof tl.adapter.destroy === 'function') {\n      try { tl.adapter.destroy(); } catch (e) { /* ignore */ }\n      tl.adapter = null;\n    }\n    \n    tl.timelineEl.classList.remove('timeline--horizontal', 'timeline--mobile');\n    tl.scroller.removeAttribute('style');\n    tl.items.forEach((item) => {\n      item.removeAttribute('style');\n      item.classList.remove('animated', 'fadeIn', 'timeline__item--left', 'timeline__item--right');\n    });\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    Array.from(navArrows).forEach((arrow) => {\n      arrow.parentNode.removeChild(arrow);\n    });\n  }\n\n  function setUpTimelines() {\n    timelines.forEach((tl) => {\n      tl.timelineEl.style.opacity = 0;\n      if (!tl.timelineEl.classList.contains('timeline--loaded')) {\n        wrapElements(tl.items);\n      }\n      resetTimelines(tl);\n      if (window.innerWidth <= tl.settings.minWidth) {\n        tl.timelineEl.classList.add('timeline--mobile');\n      }\n      \n      // Determine which mode to use based on settings and viewport width\n      let useHorizontalMode = false;\n      if (tl.settings.mode === 'horizontal' && window.innerWidth > tl.settings.minWidth) {\n        useHorizontalMode = true;\n      } else if (tl.settings.mode === 'vertical' && window.innerWidth > tl.settings.maxWidth) {\n        useHorizontalMode = true;\n      }\n      \n      if (useHorizontalMode) {\n        setUpHorinzontalTimeline(tl);\n      } else {\n        setUpVerticalTimeline(tl);\n      }\n      tl.timelineEl.classList.add('timeline--loaded');\n\n      // Apply layout fallbacks for missing images and summaries\n      initLayoutFallbacks(tl.timelineEl);\n\n      // Emit an initialization event for this timeline so other components can react\n      try {\n        const timelineId = tl.timelineEl.id || tl.timelineEl.getAttribute('data-timeline-id');\n        const detail = { id: timelineId, settings: tl.settings, api: timelineRegistry[timelineId] };\n        const ev = new CustomEvent('timeline:initialized', { detail });\n        try { tl.timelineEl.dispatchEvent(ev); } catch (e) { /* ignore */ }\n        try { document.dispatchEvent(new CustomEvent('timeline:initialized', { detail })); } catch (e) { /* ignore */ }\n      } catch (e) {\n        // Non-fatal: continue silently\n      }\n    });\n\n    setTimeout(() => {\n      timelines.forEach((tl) => {\n        tl.timelineEl.style.opacity = 1;\n      });\n    }, 500);\n  }\n\n  try {\n    setUpTimelines();\n    // Attach resize handler (stored so it can be removed in tests)\n    const resizeHandler = () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        const newWinWidth = window.innerWidth;\n        if (newWinWidth !== winWidth) {\n          setUpTimelines();\n          winWidth = newWinWidth;\n        }\n      }, 250);\n    };\n    window.addEventListener('resize', resizeHandler);\n\n    // Expose a test helper to allow tests to perform cleanup of timelines and listeners\n    // This is intentionally a non-public API for testing only.\n    timeline._test_destroyAll = function() {\n      // Clean up each timeline\n      timelines.forEach((tl) => {\n        try {\n          resetTimelines(tl);\n        } catch (e) {\n          // ignore\n        }\n      });\n      // Clear timelines array\n      timelines.length = 0;\n      // Clear any pending resize timer\n      if (resizeTimer) {\n        clearTimeout(resizeTimer);\n        resizeTimer = null;\n      }\n      // Remove resize handler\n      try { window.removeEventListener('resize', resizeHandler); } catch (e) { /* ignore */ }\n    };\n  } catch (e) {\n    console.error('Timeline initialization failed:', e);\n  }\n}","/**\n * JSON data loading and timeline rendering\n *\n * Handles JSON fetching with caching, data normalization, DOM rendering, and timeline initialization.\n * Includes Lorem Ipsum fallbacks and image error handling.\n */\n\nimport { timelineBasePath } from '../shared/config.js';\nimport { showTimelineError } from './error-ui.js';\nimport { applyTimelineColors } from './colors.js';\nimport { handleDeepLinking } from './deep-linking.js';\nimport { timeline } from '../core/timeline-engine.js';\nimport { LOREM_PARAGRAPH, LOREM_FULL } from '../shared/lipsum.js';\nimport { formatAccessibleDate } from '../shared/utils.js';\n\n/**\n * Normalize raw item data to standard timeline schema\n *\n * Converts various data formats to consistent 5-field structure.\n * Uses Lorem Ipsum placeholders for missing fields.\n *\n * @param {Object} rawData - Raw item data from JSON or user\n * @param {string} [rawData.id] - Optional unique identifier\n * @param {string} [rawData.date] - Date label (any format)\n * @param {string} [rawData.heading] - Item title\n * @param {string} [rawData.summary] - Short text (shown in node)\n * @param {string} [rawData.content] - Detailed HTML content (shown in modal)\n * @param {string} [rawData.image] - Image URL (shown in node and modal)\n * @returns {Object} Normalized item object with all 5+ fields populated\n */\nexport function normalizeItemData(rawData) {\n  const normalized = {\n    id: rawData.id || null,\n    date: rawData.date || 'DD/MM/YYYY',\n    heading: rawData.heading || 'Node Title',\n    summary: rawData.summary || LOREM_PARAGRAPH,\n    content: rawData.content || LOREM_FULL,\n    image: rawData.image || null\n  };\n  \n  return normalized;\n}\n\n/**\n * Sanitize HTML content for safe display in timeline\n *\n * Removes dangerous tags (script, form, input, h1, h2) while preserving safe markup.\n * Allowed tags: p, strong, em, u, a, ul, ol, li, br, blockquote, h3-h6\n *\n * @param {string} html - Raw HTML string\n * @returns {string} Sanitized HTML safe for DOM injection\n */\nexport function sanitizeContent(html) {\n  if (!html) return '';\n  \n  let clean = html;\n  \n  // Remove script tags and content\n  clean = clean.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '');\n  \n  // Remove form tags and content\n  clean = clean.replace(/<form[^>]*>[\\s\\S]*?<\\/form>/gi, '');\n  \n  // Remove input tags\n  clean = clean.replace(/<input[^>]*>/gi, '');\n  \n  // Remove h1 tags (replace with h3)\n  clean = clean.replace(/<h1/gi, '<h3');\n  clean = clean.replace(/<\\/h1>/gi, '</h3>');\n  \n  // Remove h2 tags (replace with h3)\n  clean = clean.replace(/<h2/gi, '<h3');\n  clean = clean.replace(/<\\/h2>/gi, '</h3>');\n  \n  return clean.trim();\n}\n\n/**\n * Create a DOM element for a timeline item\n *\n * Builds the DOM structure for a single timeline node from normalized item data.\n * Creates:\n * - Date label\n * - Optional image (with fallback to missing-image.svg on error)\n * - Heading\n * - Summary (body text, truncated by CSS)\n * - Optional inline modal content (for detailed view)\n *\n * @param {Object} item - Normalized item data (from normalizeItemData)\n * @returns {HTMLElement} Complete DOM element ready to insert into timeline\n */\nexport function createItemNode(item) {\n  const normalized = normalizeItemData(item);\n  \n  const itemEl = document.createElement('div');\n  itemEl.className = 'timeline__item';\n  itemEl.setAttribute('role', 'listitem');\n  itemEl.setAttribute('tabindex', '0');\n  \n  if (normalized.id) {\n    itemEl.setAttribute('data-node-id', normalized.id);\n  }\n\n  // Timeline content (visible in node)\n  const content = document.createElement('div');\n  content.className = 'timeline__content';\n\n  // Date\n  const dateEl = document.createElement('div');\n  dateEl.className = 'timeline__date';\n  dateEl.textContent = normalized.date;\n  content.appendChild(dateEl);\n\n  // Image (optional)\n  if (normalized.image) {\n    const img = document.createElement('img');\n    img.src = normalized.image;\n    img.className = 'timeline__image';\n    img.alt = normalized.heading || 'Timeline image';\n    img.loading = 'lazy';\n    img.onerror = function() {\n      console.error('Timeline: Image failed to load:', normalized.image);\n      this.src = timelineBasePath + '/missing-image.svg';\n      this.alt = 'Image not found';\n    };\n    content.appendChild(img);\n  }\n\n  // Heading\n  const headingEl = document.createElement('h3');\n  headingEl.className = 'timeline__heading';\n  headingEl.textContent = normalized.heading;\n  content.appendChild(headingEl);\n\n  // Summary (truncated by CSS)\n  const summaryEl = document.createElement('div');\n  summaryEl.className = 'timeline__summary';\n  summaryEl.textContent = normalized.summary;\n  content.appendChild(summaryEl);\n\n  itemEl.appendChild(content);\n\n  // Accessibility: create a visually-hidden label and reference it via aria-labelledby\n  // Priority: explicit ariaLabel in item data (ariaLabel or \"aria-label\"), then generate from date+heading\n  const explicitLabel = item && (item.ariaLabel || item['aria-label'] || item.aria_label);\n  let labelText = '';\n  if (explicitLabel && String(explicitLabel).trim() !== '') {\n    labelText = String(explicitLabel).trim();\n  } else {\n    const formattedDate = formatAccessibleDate(normalized.date);\n    labelText = `Date: ${formattedDate}. Title: ${normalized.heading}`;\n    if (normalized.id) labelText = `Node ${normalized.id}: ` + labelText;\n  }\n  if (labelText) {\n    const labelId = 'tl-label-' + Math.random().toString(36).slice(2, 9);\n    const sr = document.createElement('span');\n    sr.className = 'sr-only';\n    sr.id = labelId;\n    sr.textContent = labelText;\n    itemEl.appendChild(sr);\n    itemEl.setAttribute('aria-labelledby', labelId);\n  }\n\n  // Modal content (hidden by default, shown in popup)\n  const modalContent = document.createElement('div');\n  modalContent.className = 'timeline__modal-content';\n  modalContent.innerHTML = sanitizeContent(normalized.content);\n  itemEl.appendChild(modalContent);\n\n  // Click handler to open modal\n  itemEl.addEventListener('click', function(e) {\n    e.preventDefault();\n    if (typeof window.openTimelineModal === 'function') {\n      window.openTimelineModal(itemEl);\n    }\n  });\n\n  itemEl.addEventListener('keydown', function(e) {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      if (typeof window.openTimelineModal === 'function') {\n        window.openTimelineModal(itemEl);\n      }\n    }\n  });\n\n  return itemEl;\n}\n\n/**\n * Apply configuration as data attributes\n */\nfunction applyDataAttributes(container, config) {\n  if (config.layoutMode) {\n    container.setAttribute('data-mode', config.layoutMode);\n  }\n  if (config.moveItems !== undefined) {\n    container.setAttribute('data-move-items', config.moveItems);\n  }\n  if (config.minWidth !== undefined) {\n    container.setAttribute('data-min-width', config.minWidth);\n  }\n  if (config.maxWidth !== undefined) {\n    container.setAttribute('data-max-width', config.maxWidth);\n  }\n  /* Additional mappings so JSON config becomes authoritative (JSON > JS > HTML)\n     These attributes are the keys the timeline engine reads from dataset. */\n  if (config.startIndex !== undefined) {\n    container.setAttribute('data-start-index', config.startIndex);\n  }\n  if (config.horizontalStartPosition !== undefined) {\n    container.setAttribute('data-horizontal-start-position', config.horizontalStartPosition);\n  }\n  if (config.verticalStartPosition !== undefined) {\n    container.setAttribute('data-vertical-start-position', config.verticalStartPosition);\n  }\n  if (config.verticalTrigger !== undefined) {\n    container.setAttribute('data-vertical-trigger', config.verticalTrigger);\n  }\n  if (config.rtlMode !== undefined) {\n    container.setAttribute('data-rtl-mode', String(config.rtlMode));\n  }\n  if (config.nodeColor !== undefined) {\n    container.setAttribute('data-node-color', config.nodeColor);\n  }\n  if (config.lineColor !== undefined) {\n    container.setAttribute('data-line-color', config.lineColor);\n  }\n  if (config.navColor !== undefined) {\n    container.setAttribute('data-nav-color', config.navColor);\n  }\n}\n\n/**\n * Render timeline from data array\n *\n * Constructs the complete timeline DOM structure from an array of item data.\n * Creates .timeline__wrap and .timeline__items containers if missing.\n * Applies configuration (colors, options, heading) to the container.\n * Initializes timeline after rendering.\n *\n * @param {string} containerSelector - CSS selector for timeline container element\n * @param {Array<Object>} data - Array of item objects (raw or normalized)\n * @param {Object} [config] - Configuration object\n * @param {string} [config.timelineName] - Heading to display above timeline\n * @param {string} [config.mode] - 'horizontal' or 'vertical'\n * @param {string} [config.nodeColor] - CSS color for nodes\n * @param {string} [config.lineColor] - CSS color for line\n * @param {string} [config.navColor] - CSS color for nav\n * @param {Record<string, any>} [config.otherSettings] - Any other timeline options (see timeline-engine.js)\n * @returns {HTMLElement|null} - Timeline container element, or null if container not found\n */\nexport function renderTimelineFromData(containerSelector, data, config) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    return null;\n  }\n\n  // Remove any previous error state\n  container.classList.remove('timeline--error');\n\n  // Get or create timeline structure\n  let itemsWrap = container.querySelector('.timeline__items');\n  if (!itemsWrap) {\n    const wrap = document.createElement('div');\n    wrap.className = 'timeline__wrap';\n    itemsWrap = document.createElement('div');\n    itemsWrap.className = 'timeline__items';\n    itemsWrap.setAttribute('role', 'list');\n    wrap.appendChild(itemsWrap);\n    container.appendChild(wrap);\n  } else {\n    itemsWrap.innerHTML = '';\n    itemsWrap.setAttribute('role', 'list');\n  }\n\n  // Apply configuration\n  if (config) {\n    applyDataAttributes(container, config);\n    applyTimelineColors(container, config);\n\n    // Add timeline heading if provided\n    if (config.timelineName && config.timelineName.trim() !== '') {\n      const existingHeading = container.previousElementSibling;\n      if (existingHeading && existingHeading.classList.contains('timeline__title')) {\n        existingHeading.textContent = config.timelineName;\n      } else {\n        const heading = document.createElement('h1');\n        heading.className = 'timeline__title';\n        heading.textContent = config.timelineName;\n        container.parentNode.insertBefore(heading, container);\n      }\n      container.setAttribute('data-timeline-name', config.timelineName);\n    }\n  }\n\n  // Create timeline items from data\n  if (!Array.isArray(data) || data.length === 0) {\n    showTimelineError(container, 'no-data', 'No timeline items provided');\n    return null;\n  }\n\n  data.forEach(function(item) {\n    itemsWrap.appendChild(createItemNode(item));\n  });\n\n  return container;\n}\n\n/**\n * Initialize timeline from provided data\n */\n/**\n * Create and initialize timeline from data array\n *\n * Convenience function that combines renderTimelineFromData + timeline initialization.\n * Waits for lazy-loaded images before calculating layout to avoid dimension errors.\n *\n * @param {string} containerSelector - CSS selector for timeline container\n * @param {Array<Object>} data - Array of item objects\n * @param {Object} [options] - Timeline configuration (same as renderTimelineFromData)\n * @returns {void}\n */\nexport function timelineFromData(containerSelector, data, options) {\n  const container = renderTimelineFromData(containerSelector, data, options);\n  if (!container) return;\n  // Wait for images to settle before running layout to avoid height miscalculations\n  waitForImages(container).then(() => {\n    timeline([container], options || {});\n  });\n}\n\n/**\n * Fetch JSON data from URL, cache it, and initialize timeline\n *\n * Fetches timeline data from a JSON file with localStorage caching.\n * Shows loading spinner during fetch. Auto-initializes timeline after data loads.\n * Handles errors gracefully with error UI display.\n *\n * Cache validation: Stored with timestamp, expires after 1 hour.\n *\n * @param {string} url - URL to JSON file containing timeline data array\n * @param {string} containerSelector - CSS selector for timeline container\n * @returns {void}\n */\nexport function loadDataFromJson(url, containerSelector) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    showTimelineError(null, 'missing-element', 'Timeline container not found: ' + containerSelector);\n    return;\n  }\n\n  // Check cache first\n  const cacheKey = 'timeline_cache_' + url;\n  let cachedData = null;\n  let cachedTime = null;\n\n  if (typeof(Storage) !== 'undefined') {\n    try {\n      const cached = localStorage.getItem(cacheKey);\n      if (cached) {\n        const parsedCache = JSON.parse(cached);\n        cachedData = parsedCache.data;\n        cachedTime = parsedCache.timestamp;\n      }\n    } catch (e) {\n      console.warn('Timeline: Failed to parse cached data');\n    }\n  }\n\n  // Fetch JSON\n  fetch(url)\n    .then(response => {\n      if (!response.ok) throw new Error('Failed to load: ' + response.statusText);\n      return response.json();\n    })\n    .then(jsonData => {\n      // Check if we need to update cache\n      const needsUpdate = !cachedData || \n        !jsonData.lastupdated || \n        new Date(jsonData.lastupdated) > new Date(cachedTime);\n\n      if (needsUpdate && jsonData.nodes && typeof(Storage) !== 'undefined') {\n        try {\n          localStorage.setItem(cacheKey, JSON.stringify({\n            data: jsonData.nodes,\n            timestamp: jsonData.lastupdated || new Date().toISOString()\n          }));\n        } catch (e) {\n          console.warn('Timeline: Unable to cache data', e);\n        }\n      }\n\n      const dataToUse = jsonData.nodes || jsonData;\n      const config = Object.assign({}, jsonData);\n      delete config.nodes;\n\n      renderTimelineFromData(containerSelector, dataToUse, config);\n      // Ensure images finish loading before calling the layout engine so heights are correct\n      waitForImages(container).then(() => {\n        timeline([container], {});\n        showTimelineTitle(container);\n        handleDeepLinking();\n      });\n    })\n    .catch(error => {\n      console.error('Timeline: Error loading JSON:', error);\n      \n      // Try to use cached data as fallback\n      if (cachedData && cachedData.length > 0) {\n        console.log('Timeline: Using cached data as fallback');\n        renderTimelineFromData(containerSelector, cachedData, {});\n        waitForImages(container).then(() => {\n          timeline([container], {});\n          showTimelineTitle(container);\n        });\n      } else {\n        showTimelineError(container, 'load-failed', 'Failed to load timeline data: ' + error.message);\n      }\n    });\n}\n\n/**\n * Wait for all images inside a container to either load or error.\n * Resolves immediately if there are no images.\n */\nfunction waitForImages(container) {\n  if (!container) return Promise.resolve();\n  const imgs = Array.from(container.querySelectorAll('img'));\n  if (imgs.length === 0) return Promise.resolve();\n\n  return new Promise((resolve) => {\n    let remaining = imgs.length;\n\n    const checkDone = () => {\n      remaining -= 1;\n      if (remaining <= 0) resolve();\n    };\n\n    imgs.forEach((img) => {\n      if (img.complete) {\n        checkDone();\n      } else {\n        const onSettled = () => {\n          img.removeEventListener('load', onSettled);\n          img.removeEventListener('error', onSettled);\n          checkDone();\n        };\n        img.addEventListener('load', onSettled);\n        img.addEventListener('error', onSettled);\n      }\n    });\n\n    // Fallback safety: resolve after 1s even if some images hang\n    setTimeout(() => resolve(), 1000);\n  });\n}\n\n/**\n * Show the timeline title (previous sibling with .timeline__title class)\n * This is called after the timeline layout is complete to fade it in.\n */\nfunction showTimelineTitle(container) {\n  if (!container) return;\n  const title = container.previousElementSibling;\n  if (title && title.classList.contains('timeline__title')) {\n    // Trigger reflow to ensure transition works\n    title.offsetHeight;\n    title.classList.add('timeline__title--visible');\n  }\n}\n\n/**\n * Clear cached JSON data for a specific URL or all timeline caches\n *\n * Removes cached data from localStorage. If URL provided, clears only that URL's cache.\n * If no URL provided, clears all timeline caches (keys starting with 'timeline_cache_').\n *\n * @param {string} [url] - URL key to clear, or omit to clear all timeline caches\n * @returns {void}\n */\nexport function clearTimelineCache(url) {\n  if (typeof(Storage) === 'undefined') {\n    console.warn('Timeline: localStorage not supported');\n    return;\n  }\n\n  if (url) {\n    const cacheKey = 'timeline_cache_' + url;\n    localStorage.removeItem(cacheKey);\n    console.log('Timeline: Cleared cache for', url);\n  } else {\n    // Clear all timeline caches\n    const keys = Object.keys(localStorage);\n    let cleared = 0;\n    keys.forEach(key => {\n      if (key.startsWith('timeline_cache_')) {\n        localStorage.removeItem(key);\n        cleared++;\n      }\n    });\n    console.log('Timeline: Cleared', cleared, 'cache(s)');\n  }\n}\n\n/**\n * Process and render timeline data (alias for renderTimelineFromData)\n *\n * Alternative API for rendering timeline. Equivalent to renderTimelineFromData.\n *\n * @param {string} containerSelector - CSS selector for timeline container\n * @param {Array<Object>} data - Array of item objects\n * @param {Object} [config] - Timeline configuration\n * @returns {HTMLElement|null} - Timeline container element, or null if container not found\n */\nexport function processTimelineData(containerSelector, data, config) {\n  return renderTimelineFromData(containerSelector, data, config);\n}\n","/**\n * Lorem Ipsum placeholder text utility\n * Provides reusable placeholder content for timeline nodes\n */\n\n// Full paragraph of Lorem Ipsum\nconst LOREM_PARAGRAPH = 'Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident.';\n\n// Short sentence\nconst LOREM_SHORT = 'Lorem ipsum dolor sit amet, qui minim labore adipisicing minim sint cillum sint consectetur cupidatat.';\n\n// Multiple paragraphs\nconst LOREM_FULL = `<p>Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate.</p><p>Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.</p>`;\n\nexport { LOREM_PARAGRAPH, LOREM_SHORT, LOREM_FULL };\n","/**\n * Keyboard navigation feature for timelines\n *\n * Responsibilities:\n * - Assign sequential tabindex to nav buttons and items\n * - Support ENTER/SPACE to activate nav buttons\n * - Provide Shift+ArrowLeft/Right hotkeys to focus nav buttons\n * - Support Up/Down (vertical) and Left/Right (horizontal) item navigation\n * - Announce active node changes via aria-live for screen readers\n * - Cleanly rebind on re-initialization\n */\n\nfunction createAriaLiveRegion(timelineEl) {\n  if (!timelineEl) return;\n  // Check if already exists\n  let region = timelineEl.querySelector('.timeline__live-region');\n  if (!region) {\n    region = document.createElement('div');\n    region.className = 'timeline__live-region sr-only';\n    region.setAttribute('aria-live', 'polite');\n    region.setAttribute('aria-atomic', 'true');\n    timelineEl.appendChild(region);\n  }\n  return region;\n}\n\nfunction announceActiveNode(timelineEl, itemEl) {\n  if (!timelineEl || !itemEl) return;\n  const region = timelineEl.querySelector('.timeline__live-region');\n  if (!region) return;\n  \n  // Extract announcement text from aria-labelledby or construct from content\n  const labelId = itemEl.getAttribute('aria-labelledby');\n  let announcement = '';\n  if (labelId) {\n    const labelEl = document.getElementById(labelId);\n    announcement = labelEl ? labelEl.textContent : '';\n  }\n  if (!announcement) {\n    const date = itemEl.querySelector('.timeline__date');\n    const heading = itemEl.querySelector('.timeline__heading');\n    announcement = (date ? date.textContent : '') + '. ' + (heading ? heading.textContent : '');\n  }\n  \n  // Update region text (screen readers will announce)\n  region.textContent = announcement;\n}\n\nfunction setSequentialTabOrder(timelineEl) {\n  if (!timelineEl) return;\n\n  const prev = timelineEl.querySelector('.timeline-nav-button--prev');\n  const next = timelineEl.querySelector('.timeline-nav-button--next');\n  const items = Array.from(timelineEl.querySelectorAll('.timeline__item'));\n\n  let tab = 1;\n  if (prev) prev.tabIndex = tab++;\n  items.forEach((item) => {\n    // Ensure items are focusable and assign order\n    if (!item.hasAttribute('tabindex')) item.setAttribute('tabindex', '0');\n    item.tabIndex = tab++;\n  });\n  if (next) next.tabIndex = tab++;\n}\n\nfunction bindHotkeys(timelineEl, api) {\n  if (!timelineEl) return;\n  const prev = timelineEl.querySelector('.timeline-nav-button--prev');\n  const next = timelineEl.querySelector('.timeline-nav-button--next');\n\n  // Remove existing handlers if re-initialized\n  const existing = timelineEl.__keyboardHandlers;\n  if (existing) {\n    try { timelineEl.removeEventListener('keydown', existing.keydown); } catch (_) {}\n    if (prev && existing.prevKey) try { prev.removeEventListener('keydown', existing.prevKey); } catch (_) {}\n    if (next && existing.nextKey) try { next.removeEventListener('keydown', existing.nextKey); } catch (_) {}\n  }\n\n  const keydownHandler = function(e) {\n    // If Enter/Space pressed while a nav button is focused, trigger its click\n    const active = document.activeElement;\n    if ((e.key === 'Enter' || e.key === ' ') && (active === prev || active === next)) {\n      e.preventDefault();\n      try { active.click(); } catch (_) { /* ignore */ }\n      return;\n    }\n\n    // Shift+Arrow hotkeys to focus nav buttons\n    if (!e.shiftKey) return;\n    if (e.key === 'ArrowLeft' && prev) {\n      e.preventDefault();\n      prev.focus();\n    } else if (e.key === 'ArrowRight' && next) {\n      e.preventDefault();\n      next.focus();\n    }\n  };\n\n  const prevKeyHandler = function(e) {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      // Trigger click handler\n      this.click();\n    }\n  };\n\n  const nextKeyHandler = function(e) {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      this.click();\n    }\n  };\n\n  timelineEl.addEventListener('keydown', keydownHandler);\n  // Also listen at document level so global hotkeys (e.g., Shift+Arrow)\n  // work even if focus is not inside the timeline element (useful for tests).\n  const globalKeyHandler = function(e) {\n    // Ignore if focused in form controls\n    const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';\n    if (tag === 'input' || tag === 'textarea' || e.target.isContentEditable) return;\n    if (!e.shiftKey) return;\n    if (e.key === 'ArrowLeft' && prev) {\n      e.preventDefault();\n      prev.focus();\n    } else if (e.key === 'ArrowRight' && next) {\n      e.preventDefault();\n      next.focus();\n    }\n  };\n  document.addEventListener('keydown', globalKeyHandler);\n  if (prev) prev.addEventListener('keydown', prevKeyHandler);\n  if (next) next.addEventListener('keydown', nextKeyHandler);\n\n  timelineEl.__keyboardHandlers = {\n    keydown: keydownHandler,\n    prevKey: prevKeyHandler,\n    nextKey: nextKeyHandler\n  };\n  timelineEl.__keyboardHandlers.globalKey = globalKeyHandler;\n\n  // Arrow navigation while focused on a node (horizontal or vertical mode)\n  const items = Array.from(timelineEl.querySelectorAll('.timeline__item'));\n  const itemKeyHandler = function(e) {\n    const horizontal = timelineEl.classList.contains('timeline--horizontal');\n    const validKeys = horizontal \n      ? ['ArrowLeft', 'ArrowRight', 'Home', 'End']\n      : ['ArrowUp', 'ArrowDown', 'Home', 'End'];\n    if (!validKeys.includes(e.key)) return;\n    e.preventDefault();\n    let delta = 0;\n    if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') delta = -1;\n    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') delta = 1;\n    const all = items;\n    const currentIndex = all.indexOf(e.currentTarget);\n    let targetIndex = currentIndex;\n    if (e.key === 'Home') targetIndex = 0;\n    else if (e.key === 'End') targetIndex = all.length - 1;\n    else targetIndex = Math.max(0, Math.min(all.length - 1, currentIndex + delta));\n\n    const target = all[targetIndex];\n    if (api && typeof api.setCurrentIndex === 'function' && typeof api.updatePosition === 'function') {\n      api.setCurrentIndex(targetIndex);\n      api.updatePosition();\n    }\n    if (target) {\n      target.focus();\n      announceActiveNode(timelineEl, target);\n    }\n  };\n\n  items.forEach((item) => {\n    item.addEventListener('keydown', itemKeyHandler);\n  });\n  timelineEl.__keyboardHandlers.itemKey = itemKeyHandler;\n}\n\nfunction initializeKeyboardForTimeline(timelineEl, api) {\n  setSequentialTabOrder(timelineEl);\n  bindHotkeys(timelineEl, api);\n  createAriaLiveRegion(timelineEl);\n}\n\n// Listen for timeline initialization events and apply keyboard behavior\ndocument.addEventListener('timeline:initialized', function(ev) {\n  try {\n    // Prefer the target element of the event; fallback to detail.id\n    const tlEl = ev.target && ev.target.classList && ev.target.classList.contains('timeline')\n      ? ev.target\n      : (ev.detail && ev.detail.id ? document.getElementById(ev.detail.id) : null);\n    const api = ev.detail && ev.detail.api ? ev.detail.api : undefined;\n    if (tlEl) initializeKeyboardForTimeline(tlEl, api);\n  } catch (_) { /* noop */ }\n});\n\nexport { initializeKeyboardForTimeline, setSequentialTabOrder };\n","/**\r\n * timeline.js - Vanilla JavaScript timeline library\r\n *\r\n * A responsive timeline component for displaying chronological events with support\r\n * for horizontal/vertical layouts, JSON data loading, color theming, modals, and deep linking.\r\n *\r\n * Original author: Mike Collins (https://github.com/squarechip/timeline) - 2018\r\n * Maintained by: Ken Dawson (https://github.com/kendawson-online) - 2026\r\n *\r\n * Features:\r\n * - Responsive horizontal/vertical layouts with breakpoint switching\r\n * - JSON data loading with caching\r\n * - Modal popups for detailed item viewing\r\n * - Color customization and accessibility\r\n * - Deep linking (URL-based navigation to specific timeline items)\r\n * - Optional Swiper carousel integration\r\n * - jQuery plugin support (if jQuery available)\r\n */\r\n\r\nimport { createTimelineModal, openTimelineModal, closeTimelineModal } from './features/modals.js';\r\nimport { handleDeepLinking, navigateToNodeIndex } from './features/deep-linking.js';\r\nimport { renderTimelineFromData, timelineFromData, loadDataFromJson, processTimelineData, clearTimelineCache } from './features/data-loader.js';\r\nimport './features/keyboard.js';\r\nimport { timeline } from './core/timeline-engine.js';\r\nimport '../css/timeline.css';\r\n\r\n/**\r\n * Auto-initialize timelines that have [data-json-config] attribute\r\n * Queries DOM for elements with data-json-config and loads JSON data for each\r\n * @private\r\n */\r\nfunction autoInitJsonTimelines() {\r\n  const timelinesWithJson = document.querySelectorAll('[data-json-config]');\r\n  timelinesWithJson.forEach(function(timelineEl) {\r\n    const jsonUrl = timelineEl.getAttribute('data-json-config');\r\n    if (!jsonUrl) return;\r\n    const className = (timelineEl.className || '').split(' ')[0];\r\n    const selector = timelineEl.id ? '#' + timelineEl.id : (className ? '.' + className : null);\r\n    if (selector) {\r\n      loadDataFromJson(jsonUrl, selector);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Expose all timeline functions to global scope (window object)\r\n * Allows users to access timeline API from console and global code\r\n * @private\r\n */\r\nfunction exposeGlobals() {\r\n  if (typeof window === 'undefined') return;\r\n  window.timeline = timeline;\r\n  window.timelineFromData = timelineFromData;\r\n  window.renderTimelineFromData = renderTimelineFromData;\r\n  window.processTimelineData = processTimelineData;\r\n  window.loadDataFromJson = loadDataFromJson;\r\n  window.clearTimelineCache = clearTimelineCache;\r\n  window.createTimelineModal = createTimelineModal;\r\n  window.openTimelineModal = openTimelineModal;\r\n  window.closeTimelineModal = closeTimelineModal;\r\n  window.handleTimelineDeepLinking = handleDeepLinking;\r\n  window.navigateTimelineToNodeIndex = navigateToNodeIndex;\r\n}\r\n\r\nexposeGlobals();\r\n\r\n/**\r\n * Auto-initialize JSON-configured timelines when DOM is ready\r\n */\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  autoInitJsonTimelines();\r\n});\r\n\r\n/**\r\n * Register jQuery plugin if jQuery is available\r\n * Allows usage: $('#timeline').timeline({ options });\r\n */\r\nif (typeof window !== 'undefined' && window.jQuery) {\r\n  (($) => {\r\n    /**\r\n     * jQuery plugin for timeline initialization\r\n     * @param {Object} opts - Timeline configuration options\r\n     * @returns {jQuery} - Returns jQuery collection for chaining\r\n     */\r\n    $.fn.timeline = function(opts) {\r\n      timeline(this, opts);\r\n      return this;\r\n    };\r\n  })(window.jQuery);\r\n}\r\n\r\nexport {\r\n  timeline,\r\n  timelineFromData,\r\n  renderTimelineFromData,\r\n  loadDataFromJson,\r\n  processTimelineData,\r\n  clearTimelineCache,\r\n  createTimelineModal,\r\n  openTimelineModal,\r\n  closeTimelineModal,\r\n  handleDeepLinking,\r\n  navigateToNodeIndex\r\n};"],"names":["modalState","modal","overlay","timelineRegistry","lastFocusedElement","getFocusableElements","container","focusable","querySelectorAll","Array","from","filter","el","hasAttribute","trapFocus","e","key","length","first","last","active","document","activeElement","shiftKey","contains","preventDefault","focus","createTimelineModal","createElement","className","addEventListener","closeTimelineModal","setAttribute","titleId","innerHTML","closeBtn","querySelector","closeBottomBtn","stopPropagation","body","appendChild","classList","openTimelineModal","itemEl","title","getAttribute","content","image","html","modalTitle","modalText","modalImage","textContent","src","alt","style","display","domModal","trim","replace","setTimeout","add","overflow","firstFocusable","remove","handleDeepLinking","containerSelector","urlParams","URLSearchParams","window","location","search","timelineId","get","nodeId","targetContainer","getElementById","console","warn","scrollIntoView","behavior","block","targetNode","forEach","n","itemIndex","parentNode","children","indexOf","navigateToNodeIndex","index","id","tlData","setCurrentIndex","updatePosition","timelineBasePath","TimelineConfig","basePath","scripts","getElementsByTagName","i","dir","substring","lastIndexOf","showTimelineError","errorType","details","errorInfo","message","solution","errorDiv","errorIcon","width","height","errorTitle","errorMessage","errorSolution","errorDetails","error","evt","CustomEvent","detail","type","containerId","dispatchEvent","getColorBrightness","color","rgb","startsWith","hex","parseInt","matches","match","map","Number","formatAccessibleDate","dateString","locale","navigator","language","String","parsed","Date","parse","isNaN","parts","split","p","mm","dd","yy","d","getTime","formatDateWithOrdinal","dateObj","fmt","Intl","DateTimeFormat","month","day","year","prototype","formatToParts","value","dayNum","getDate","s","v","ordinalSuffix","format","toDateString","applyTimelineColors","config","nodeColor","lineColor","navColor","setProperty","arrowColor","SwiperAdapter","constructor","this","swiper","_container","_original","init","timelineEl","timelineApi","options","SwiperLib","swiperCdn","mod","import","default","Swiper","seen","Storage","localStorage","getItem","log","setItem","items","itemsClass","itemClasses","child","push","defaultOpts","Object","assign","slidesPerView","freeMode","spaceBetween","direction","_","slideTo","opts","speed","slideBy","delta","activeIndex","update","destroy","undefined","applyNoImageFallback","root","c","img","complete","naturalWidth","once","applyNoSummaryFallback","summary","initLayoutFallbacks","MutationObserver","observe","childList","subtree","enhanceInlineItems","item","heading","firstP","ensureInlineModalData","dataLabel","dataset","ariaLabel","labelText","dateEl","headingEl","dateText","headingText","formattedDate","idAttr","labelId","Math","random","toString","slice","sr","ensureAccessibleLabelForInlineItem","createArrowSVG","clampInt","min","max","updateDeepLinkUrl","history","params","has","timelineParam","shouldUpdateDeepLinkForTimeline","url","URL","href","searchParams","set","replaceState","timeline","collection","timelines","warningLabel","resizeTimer","winWidth","innerWidth","defaultSettings","minWidth","defaultValue","maxWidth","horizontalStartPosition","acceptedValues","mode","moveItems","rtlMode","startIndex","verticalStartPosition","verticalTrigger","useSwiper","sameSideNodes","resolveSide","settings","rtl","vDefault","toLowerCase","itemWrap","wrapper","classes","insertBefore","isElementInViewport","triggerPosition","rect","getBoundingClientRect","windowHeight","innerHeight","documentElement","clientHeight","defaultTrigger","triggerUnit","unit","triggerValue","trigger","top","left","clientWidth","addTransforms","transform","webkitTransform","msTransform","timelinePosition","tl","safeIndex","originalLeft","offsetLeft","timelineStyle","getComputedStyle","paddingLeft","paddingRight","viewportWidth","wrap","offsetWidth","itemWidth","position","minPositionForRight","str","scroller","updateActiveItem","setUpHorinzontalTimeline","constraints","availableHeight","requiredHeight","scaleFactor","scaleValue","scaled","round","calculateHorizontalScale","computedStyle","nodeWidth","getPropertyValue","scrollerWidth","setWidths","oddIndexTallest","evenIndexTallest","offsetHeight","transformString","effectiveHSide","isSameSide","tallestHeight","computedVisibleCount","floor","setHeights","setHeightandWidths","itemsVisible","currentIndex","prevArrow","nextArrow","topPosition","maxActiveIndex","addNavigation","divider","removeChild","horizontalDivider","addHorizontalDivider","navArrows","arrowPrev","arrowNext","handleArrowClick","stopImmediatePropagation","nextActive","stepsFromStart","prevAlignedIndex","nextAlignedIndex","activeItem","blur","arrow","listeners","element","handler","slideTimeline","maxScrollIndex","idx","activateHandler","swiperAdapter","provided","adapter","swiperOptions","resetTimelines","removeEventListener","observer","disconnect","removeAttribute","setUpTimelines","opacity","useHorizontalMode","lastVisibleIndex","effectiveVSide","observerOptions","rootMargin","threshold","IntersectionObserver","entries","entry","isIntersecting","target","scrollHandler","setUpVerticalTimeline","api","ev","timelineName","errorPart","data","Error","call","keys","candidate","minwidth","forceVerticalMode","forceverticalmode","maxwidth","settingName","getData","k","triggerArray","triggerValid","useswiper","val","now","substr","resizeHandler","clearTimeout","newWinWidth","_test_destroyAll","renderTimelineFromData","itemsWrap","layoutMode","applyDataAttributes","existingHeading","previousElementSibling","isArray","normalized","rawData","date","loading","onerror","summaryEl","explicitLabel","aria_label","modalContent","clean","sanitizeContent","createItemNode","timelineFromData","waitForImages","then","loadDataFromJson","cacheKey","cachedData","cachedTime","cached","parsedCache","JSON","timestamp","fetch","response","ok","statusText","json","jsonData","lastupdated","nodes","stringify","toISOString","dataToUse","showTimelineTitle","catch","Promise","resolve","imgs","remaining","checkDone","onSettled","clearTimelineCache","removeItem","cleared","processTimelineData","bindHotkeys","prev","next","existing","__keyboardHandlers","keydown","prevKey","nextKey","keydownHandler","click","prevKeyHandler","nextKeyHandler","globalKeyHandler","tag","tagName","isContentEditable","globalKey","itemKeyHandler","includes","all","currentTarget","targetIndex","region","announcement","labelEl","announceActiveNode","itemKey","initializeKeyboardForTimeline","tab","tabIndex","setSequentialTabOrder","createAriaLiveRegion","tlEl","handleTimelineDeepLinking","navigateTimelineToNodeIndex","jsonUrl","selector","jQuery","fn"],"mappings":"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"}