{"version":3,"file":"timeline.min.js","sources":["../src/js/shared/state.js","../src/js/features/modals.js","../src/js/features/deep-linking.js","../src/js/shared/config.js","../src/js/features/loader-ui.js","../src/js/features/error-ui.js","../src/js/shared/utils.js","../src/js/features/colors.js","../src/js/core/timeline-engine.js","../src/js/features/data-loader.js","../src/js/timeline.js"],"sourcesContent":["// Shared state containers\nexport const loaderState = {\n  count: 0,\n  startTime: 0,\n  removeTimer: null,\n  overlayEl: null\n};\n\nexport const modalState = {\n  modal: null,\n  overlay: null\n};\n\n// Global registry to store timeline instances for programmatic navigation\nexport const timelineRegistry = {};\n","import { modalState } from '../shared/state.js';\n\nexport function createTimelineModal() {\n  if (modalState.modal) return;\n\n  modalState.overlay = document.createElement('div');\n  modalState.overlay.className = 'timeline-modal-overlay';\n  modalState.overlay.addEventListener('click', closeTimelineModal);\n\n  modalState.modal = document.createElement('div');\n  modalState.modal.className = 'timeline-modal';\n  modalState.modal.innerHTML = `\n    <button class=\"timeline-modal__close\" aria-label=\"Close modal\"></button>\n    <div class=\"timeline-modal__content\">\n      <img class=\"timeline-modal__image\" src=\"\" alt=\"\" loading=\"lazy\" style=\"display: none;\">\n      <h2 class=\"timeline-modal__title\"></h2>\n      <div class=\"timeline-modal__text\"></div>\n    </div>\n    <div class=\"timeline-modal__footer\">\n      <button class=\"timeline-modal__close-bottom\">Close</button>\n    </div>\n  `;\n\n  const closeBtn = modalState.modal.querySelector('.timeline-modal__close');\n  const closeBottomBtn = modalState.modal.querySelector('.timeline-modal__close-bottom');\n  closeBtn.addEventListener('click', closeTimelineModal);\n  closeBottomBtn.addEventListener('click', closeTimelineModal);\n\n  modalState.modal.addEventListener('click', function(e) {\n    e.stopPropagation();\n  });\n\n  document.body.appendChild(modalState.overlay);\n  document.body.appendChild(modalState.modal);\n\n  document.addEventListener('keydown', function(e) {\n    if (e.key === 'Escape' && modalState.modal.classList.contains('timeline-modal-show')) {\n      closeTimelineModal();\n    }\n  });\n}\n\nexport function openTimelineModal(itemEl) {\n  if (!modalState.modal) {\n    createTimelineModal();\n  }\n\n  const title = itemEl.getAttribute('data-modal-title');\n  const content = itemEl.getAttribute('data-modal-content');\n  const image = itemEl.getAttribute('data-modal-image');\n  const html = itemEl.getAttribute('data-modal-html');\n\n  const modalTitle = modalState.modal.querySelector('.timeline-modal__title');\n  const modalText = modalState.modal.querySelector('.timeline-modal__text');\n  const modalImage = modalState.modal.querySelector('.timeline-modal__image');\n\n  modalTitle.textContent = title || '';\n\n  if (image) {\n    modalImage.src = image;\n    modalImage.alt = title || '';\n    modalImage.style.display = 'block';\n  } else {\n    modalImage.style.display = 'none';\n  }\n\n  if (html) {\n    modalText.innerHTML = html;\n  } else if (content) {\n    modalText.innerHTML = '<p>' + content.replace(/\\n/g, '</p><p>') + '</p>';\n  } else {\n    modalText.innerHTML = '';\n  }\n\n  setTimeout(function() {\n    modalState.modal.classList.add('timeline-modal-show');\n    modalState.overlay.classList.add('timeline-modal-show');\n    document.body.style.overflow = 'hidden';\n  }, 10);\n}\n\nexport function closeTimelineModal() {\n  if (modalState.modal) {\n    modalState.modal.classList.remove('timeline-modal-show');\n    modalState.overlay.classList.remove('timeline-modal-show');\n    document.body.style.overflow = '';\n  }\n}\n","import { timelineRegistry } from '../shared/state.js';\n\nexport function handleDeepLinking(containerSelector) {\n  const urlParams = new URLSearchParams(window.location.search);\n  const timelineId = urlParams.get('timeline');\n  const nodeId = urlParams.get('id');\n  if (!nodeId) return;\n\n  let targetContainer;\n  if (timelineId) {\n    targetContainer = document.getElementById(timelineId);\n  } else {\n    targetContainer = document.querySelector(containerSelector);\n  }\n\n  if (!targetContainer) {\n    console.warn('Timeline not found for deep linking:', timelineId || containerSelector);\n    return;\n  }\n\n  targetContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\n  const targetNode = targetContainer.querySelector('[data-node-id=\"' + nodeId + '\"]');\n  if (targetNode) {\n    setTimeout(function() {\n      // Ensure only one active item is highlighted in this timeline\n      targetContainer.querySelectorAll('.timeline__item--active').forEach((n) => n.classList.remove('timeline__item--active'));\n      targetNode.classList.add('timeline__item--active');\n      const itemIndex = Array.from(targetNode.parentNode.children).indexOf(targetNode);\n      navigateToNodeIndex(targetContainer, itemIndex);\n    }, 500);\n  }\n}\n\nexport function navigateToNodeIndex(container, index) {\n  if (!container) return;\n  const timelineId = container.id || container.getAttribute('data-timeline-id');\n  if (!timelineId) {\n    console.warn('Cannot navigate: timeline container has no ID');\n    return;\n  }\n\n  const tlData = timelineRegistry[timelineId];\n  if (!tlData) {\n    console.warn('Timeline not found in registry:', timelineId);\n    return;\n  }\n\n  if (!container.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  if (tlData.setCurrentIndex && tlData.updatePosition) {\n    tlData.setCurrentIndex(index);\n    tlData.updatePosition();\n  }\n}\n","// Shared configuration values\n// Auto-detect the timeline.js script location to build correct image paths\nexport const timelineBasePath = (function() {\n  // Check for user override\n  if (typeof window !== 'undefined' && \n      window.TimelineConfig && \n      window.TimelineConfig.basePath) {\n    return window.TimelineConfig.basePath;\n  }\n  \n  const scripts = document.getElementsByTagName('script');\n  for (let i = 0; i < scripts.length; i++) {\n    const src = scripts[i].src || '';\n    if (!src) continue;\n    const dir = src.substring(0, src.lastIndexOf('/'));\n    if (src.indexOf('timeline.min.js') !== -1) {\n      // When loading from dist, map to src/images\n      return dir.replace('/dist', '/src/images');\n    }\n    if (src.indexOf('timeline.js') !== -1) {\n      // When loading from src/js, map to src/images\n      return dir.replace('/js', '/images');\n    }\n  }\n  // Fallback relative to demo pages; most demos live under demo/**\n  return '../src/images';\n})();\n\n// Minimum time (ms) to keep the loading spinner visible\nlet timelineLoaderMinMs = 1300;\nexport function getTimelineLoaderMinMs() {\n  return timelineLoaderMinMs;\n}\nexport function setTimelineLoaderMinMs(value) {\n  if (typeof value === 'number' && value >= 0) {\n    timelineLoaderMinMs = value;\n  }\n}\n","import { loaderState } from '../shared/state.js';\nimport { getTimelineLoaderMinMs, timelineBasePath } from '../shared/config.js';\n\nexport function showTimelineLoader() {\n  loaderState.count += 1;\n  if (loaderState.count !== 1) return;\n\n  loaderState.startTime = Date.now();\n\n  if (loaderState.removeTimer) {\n    clearTimeout(loaderState.removeTimer);\n    loaderState.removeTimer = null;\n  }\n\n  const overlay = document.createElement('div');\n  overlay.className = 'timeline__loader-overlay';\n\n  const loader = document.createElement('div');\n  loader.className = 'timeline__loader';\n\n  const spinner = document.createElement('img');\n  spinner.src = timelineBasePath + '/spinner.gif';\n  spinner.alt = 'Loading...';\n  spinner.title = 'Loading...';\n  spinner.className = 'timeline__loader-spinner';\n  // Default to a compact spinner if page CSS is missing\n  spinner.width = 120;\n  spinner.style.height = 'auto';\n\n  loader.appendChild(spinner);\n  overlay.appendChild(loader);\n\n  document.body.appendChild(overlay);\n  loaderState.overlayEl = overlay;\n}\n\nexport function hideTimelineLoader() {\n  if (loaderState.count <= 0) return;\n  loaderState.count -= 1;\n  if (loaderState.count > 0) return;\n\n  const removeOverlay = function() {\n    if (loaderState.overlayEl) {\n      loaderState.overlayEl.remove();\n      loaderState.overlayEl = null;\n    }\n    loaderState.removeTimer = null;\n  };\n\n  if (loaderState.removeTimer) {\n    clearTimeout(loaderState.removeTimer);\n    loaderState.removeTimer = null;\n  }\n\n  // Respect minimum display time where possible\n  const elapsed = Date.now() - loaderState.startTime;\n  const minMs = getTimelineLoaderMinMs();\n  const remaining = Math.max(0, minMs - elapsed);\n\n  if (remaining > 0) {\n    loaderState.removeTimer = setTimeout(removeOverlay, remaining);\n  } else {\n    removeOverlay();\n  }\n}\n","import { timelineBasePath } from '../shared/config.js';\nimport { hideTimelineLoader } from './loader-ui.js';\n\nexport function showTimelineError(container, errorType, details) {\n  if (!container) return;\n\n  const errorMessages = {\n    'json-load': {\n      title: 'Timeline Data Could Not Be Loaded',\n      message: 'The timeline data failed to load. This could be due to a network error or an incorrect file path.',\n      solution: 'Please check that the data-json-config path is correct and the file is accessible.'\n    },\n    'json-parse': {\n      title: 'Invalid Timeline Data',\n      message: 'The timeline data file exists but contains invalid JSON.',\n      solution: 'Please validate your JSON using a tool like jsonlint.com and ensure it follows the correct schema.'\n    },\n    'missing-element': {\n      title: 'Timeline Element Not Found',\n      message: 'The required timeline container element could not be found on the page.',\n      solution: 'Ensure your HTML includes a container with the class \"timeline\" and the correct selector.'\n    },\n    'invalid-config': {\n      title: 'Invalid Configuration',\n      message: 'One or more timeline configuration options are invalid.',\n      solution: 'Check your data attributes or JavaScript options and ensure they match the expected format.'\n    }\n  };\n\n  const errorInfo = errorMessages[errorType] || {\n    title: 'Timeline Error',\n    message: 'An unexpected error occurred while initializing the timeline.',\n    solution: 'Please check the browser console for more details.'\n  };\n\n  hideTimelineLoader();\n  // mark container as error state so timeline visuals (lines, nav buttons) can be hidden via CSS\n  container.classList.add('timeline--error');\n  container.innerHTML = '';\n\n  const errorDiv = document.createElement('div');\n  errorDiv.className = 'timeline__error';\n\n  const errorIcon = document.createElement('img');\n  errorIcon.src = timelineBasePath + '/alert.svg';\n  errorIcon.alt = 'Error';\n  errorIcon.className = 'timeline__error-icon';\n  // Ensure a reasonable default size even if CSS isn't loaded\n  // This makes the error icon usable when a consumer forgets to include CSS.\n  errorIcon.width = 200;\n  errorIcon.style.height = 'auto';\n\n  const errorTitle = document.createElement('h2');\n  errorTitle.className = 'timeline__error-title';\n  errorTitle.textContent = errorInfo.title;\n\n  const errorMessage = document.createElement('p');\n  errorMessage.className = 'timeline__error-message';\n  errorMessage.textContent = errorInfo.message;\n\n  const errorSolution = document.createElement('p');\n  errorSolution.className = 'timeline__error-solution';\n  errorSolution.innerHTML = '<strong>Solution:</strong> ' + errorInfo.solution;\n\n  if (details) {\n    const errorDetails = document.createElement('p');\n    errorDetails.className = 'timeline__error-details';\n    errorDetails.innerHTML = '<strong>Details:</strong> ' + details;\n    errorDiv.appendChild(errorDetails);\n  }\n\n  errorDiv.appendChild(errorIcon);\n  errorDiv.appendChild(errorTitle);\n  errorDiv.appendChild(errorMessage);\n  errorDiv.appendChild(errorSolution);\n\n  container.appendChild(errorDiv);\n\n  console.error('Timeline Error [' + errorType + ']:', errorInfo.message, details || '');\n\n  // Emit a global event so host pages can react (e.g., cancel instructions UI)\n  try {\n    const evt = new CustomEvent('timeline:error', {\n      detail: {\n        type: errorType,\n        message: errorInfo.message,\n        details: details || null,\n        containerId: container.id || null\n      }\n    });\n    window.dispatchEvent(evt);\n  } catch (e) {\n    // ignore event errors in very old browsers\n  }\n}\n","// Utility helpers shared across modules\nexport function getContrastColor(bgColor) {\n  const brightness = getColorBrightness(bgColor);\n  return brightness > 128 ? 'rgba(0, 0, 0, 0.2)' : 'rgba(255, 255, 255, 0.3)';\n}\n\nexport function getColorBrightness(color) {\n  let rgb;\n  if (!color || typeof color !== 'string') return 128;\n\n  if (color.startsWith('#')) {\n    let hex = color.substring(1);\n    if (hex.length === 3) {\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n    }\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    rgb = [r, g, b];\n  } else if (color.startsWith('rgb')) {\n    const matches = color.match(/\\d+/g);\n    rgb = matches ? matches.map(Number) : [128, 128, 128];\n  } else {\n    return 128;\n  }\n\n  return (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;\n}\n","import { getContrastColor, getColorBrightness } from '../shared/utils.js';\n\nexport function applyTimelineColors(container, config) {\n  let nodeColor = config.nodeColor || null;\n  let lineColor = config.lineColor || null;\n  const navColor = config.navColor || null;\n\n  if (nodeColor && !lineColor) lineColor = nodeColor;\n  if (lineColor && !nodeColor) nodeColor = lineColor;\n\n  if (nodeColor) {\n    container.style.setProperty('--timeline-node-color', nodeColor);\n    // Use configured nodeColor for the active/current item outline\n    container.style.setProperty('--timeline-active-outline-color', nodeColor);\n  }\n  if (lineColor) {\n    container.style.setProperty('--timeline-line-color', lineColor);\n  }\n  if (navColor) {\n    container.style.setProperty('--timeline-nav-color', navColor);\n    container.style.setProperty('--timeline-nav-border', getContrastColor(navColor));\n    const brightness = getColorBrightness(navColor);\n    const arrowColor = brightness > 128 ? '#333' : '#fff';\n    container.style.setProperty('--timeline-arrow-color', arrowColor);\n    container.setAttribute('data-arrow-color', arrowColor);\n  }\n}\n","import { showTimelineLoader, hideTimelineLoader } from '../features/loader-ui.js';\nimport { showTimelineError } from '../features/error-ui.js';\nimport { applyTimelineColors } from '../features/colors.js';\nimport { openTimelineModal } from '../features/modals.js';\nimport { timelineRegistry } from '../shared/state.js';\n\n/**\n * Calculate and apply responsive scaling for horizontal timeline based on viewport height\n * @param {HTMLElement} timelineEl - The timeline container element\n */\nfunction calculateHorizontalScale(timelineEl) {\n  if (!timelineEl || !timelineEl.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  // Define constraints\n  const constraints = {\n    nodeWidth: { min: 150, max: 200, default: 200 },\n    nodeMinHeight: { min: 135, max: 180, default: 180 },\n    imageSize: { min: 80, max: 100, default: 100 },\n    titleFontSize: { min: 14, max: 18, default: 18 },\n    textFontSize: { min: 11, max: 13, default: 11 }\n  };\n\n  // Get available viewport height (minus padding/margins)\n  const viewportHeight = window.innerHeight;\n  const timelinePadding = 180; // Account for heading, margins, bottom item padding (40px), and buffer\n  const availableHeight = viewportHeight - timelinePadding;\n\n  // Calculate required height for default (max) dimensions\n  // Two rows of nodes + divider line + spacing + bottom padding\n  const maxNodeHeight = constraints.nodeMinHeight.max;\n  const requiredHeight = (maxNodeHeight * 2) + 90; // 90px for divider, spacing, and bottom item padding\n\n  // Calculate scale factor\n  let scaleFactor = 1.0;\n  if (availableHeight < requiredHeight) {\n    scaleFactor = Math.max(0.75, availableHeight / requiredHeight); // Don't scale below 75%\n  }\n\n  // Apply scaling with constraints\n  function scaleValue(config) {\n    const scaled = Math.round(config.default * scaleFactor);\n    return Math.max(config.min, Math.min(config.max, scaled));\n  }\n\n  // Set CSS custom properties\n  timelineEl.style.setProperty('--timeline-h-node-width', scaleValue(constraints.nodeWidth) + 'px');\n  timelineEl.style.setProperty('--timeline-h-node-min-height', scaleValue(constraints.nodeMinHeight) + 'px');\n  timelineEl.style.setProperty('--timeline-h-image-size', scaleValue(constraints.imageSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-title-font-size', scaleValue(constraints.titleFontSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-text-font-size', scaleValue(constraints.textFontSize) + 'px');\n}\n\nfunction ensureInlineModalData(itemEl) {\n  if (!itemEl) return;\n  const content = itemEl.querySelector('.timeline__content') || itemEl;\n  if (!itemEl.hasAttribute('data-modal-title')) {\n    const heading = content.querySelector('h1,h2,h3,h4,h5,h6');\n    if (heading && heading.textContent) {\n      itemEl.setAttribute('data-modal-title', heading.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-content')) {\n    const firstP = content.querySelector('p');\n    if (firstP && firstP.textContent) {\n      itemEl.setAttribute('data-modal-content', firstP.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-image')) {\n    const img = content.querySelector('img');\n    if (img && img.getAttribute('src')) {\n      itemEl.setAttribute('data-modal-image', img.getAttribute('src'));\n    }\n  }\n}\n\nfunction enhanceInlineItems(timelineEl, items) {\n  if (!items || !items.length) return;\n  items.forEach(function(item){\n    if (item.getAttribute('data-modal-bound') === '1') return;\n    ensureInlineModalData(item);\n    const hasModal = item.hasAttribute('data-modal-title') || item.hasAttribute('data-modal-content') || item.hasAttribute('data-modal-image') || item.hasAttribute('data-modal-html');\n    if (hasModal) {\n      item.addEventListener('click', function(e){\n        e.preventDefault();\n        openTimelineModal(item);\n      });\n      item.setAttribute('data-modal-bound', '1');\n    }\n  });\n}\n\nfunction createArrowSVG(direction, color) {\n  if (direction === 'left') {\n    return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.8 1L1 7l5.8 6\"/></svg>';\n  }\n  return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M1 1l5.8 6L1 13\"/></svg>';\n}\n\nexport function timeline(collection, options) {\n  const timelines = [];\n  const warningLabel = 'Timeline:';\n  let winWidth = window.innerWidth;\n  let resizeTimer;\n  let currentIndex = 0;\n  const eventListeners = new Map(); // Track listeners for cleanup\n\n  const skipLoader = options && options.skipLoader === true;\n  if (!skipLoader) {\n    showTimelineLoader();\n  }\n  let shouldHideLoader = !skipLoader;\n\n  const defaultSettings = {\n    minWidth: { type: 'integer', defaultValue: 600 },\n    maxWidth: { type: 'integer', defaultValue: 600 },\n    horizontalStartPosition: { type: 'string', acceptedValues: ['bottom', 'top'], defaultValue: 'top' },\n    mode: { type: 'string', acceptedValues: ['horizontal', 'vertical'], defaultValue: 'vertical' },\n    moveItems: { type: 'integer', defaultValue: 1 },\n    rtlMode: { type: 'boolean', acceptedValues: [true, false], defaultValue: false },\n    startIndex: { type: 'integer', defaultValue: 0 },\n    verticalStartPosition: { type: 'string', acceptedValues: ['left', 'right'], defaultValue: 'left' },\n    verticalTrigger: { type: 'string', defaultValue: '15%' },\n    visibleItems: { type: 'integer', defaultValue: 3 }\n  };\n\n  function testValues(value, settingName) {\n    if (typeof value !== 'number' && value % 1 !== 0) {\n      console.warn(`${warningLabel} The value \"${value}\" entered for the setting \"${settingName}\" is not an integer.`);\n      return false;\n    }\n    return true;\n  }\n\n  function itemWrap(el, wrapper, classes) {\n    wrapper.classList.add(classes);\n    el.parentNode.insertBefore(wrapper, el);\n    wrapper.appendChild(el);\n  }\n\n  function wrapElements(items) {\n    items.forEach((item) => {\n      itemWrap(item.querySelector('.timeline__content'), document.createElement('div'), 'timeline__content__wrap');\n      itemWrap(item.querySelector('.timeline__content__wrap'), document.createElement('div'), 'timeline__item__inner');\n    });\n  }\n\n  function isElementInViewport(el, triggerPosition) {\n    const rect = el.getBoundingClientRect();\n    const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    let triggerUnit = triggerPosition.unit;\n    let triggerValue = triggerPosition.value;\n    let trigger = windowHeight;\n    if (triggerUnit === 'px' && triggerValue >= windowHeight) {\n      console.warn('The value entered for the setting \"verticalTrigger\" is larger than the window height. The default value will be used instead.');\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n    if (triggerUnit === 'px') {\n      trigger = parseInt(trigger - triggerValue, 10);\n    } else if (triggerUnit === '%') {\n      trigger = parseInt(trigger * ((100 - triggerValue) / 100), 10);\n    }\n    return (\n      rect.top <= trigger &&\n      rect.left <= (window.innerWidth || document.documentElement.clientWidth) &&\n      (rect.top + rect.height) >= 0 &&\n      (rect.left + rect.width) >= 0\n    );\n  }\n\n  function addTransforms(el, transform) {\n    el.style.webkitTransform = transform;\n    el.style.msTransform = transform;\n    el.style.transform = transform;\n  }\n\n  function createTimelines(timelineEl) {\n    const timelineName = timelineEl.id ? `#${timelineEl.id}` : `.${timelineEl.className}`;\n    const errorPart = 'could not be found as a direct descendant of';\n    const data = timelineEl.dataset;\n    let wrap;\n    let scroller;\n    let items;\n    const settings = {};\n\n    try {\n      wrap = timelineEl.querySelector('.timeline__wrap');\n      if (!wrap) {\n        throw new Error(`${warningLabel} .timeline__wrap ${errorPart} ${timelineName}`);\n      } else {\n        scroller = wrap.querySelector('.timeline__items');\n        if (!scroller) {\n          throw new Error(`${warningLabel} .timeline__items ${errorPart} .timeline__wrap`);\n        } else {\n          items = [].slice.call(scroller.children, 0);\n        }\n      }\n    } catch (e) {\n      console.warn(e.message);\n      showTimelineError(timelineEl, 'missing-element', e.message);\n      return false;\n    }\n\n    Object.keys(defaultSettings).forEach((key) => {\n      settings[key] = defaultSettings[key].defaultValue;\n\n      if (key === 'minWidth') {\n        let candidate = undefined;\n        if (data.minWidth !== undefined) candidate = data.minWidth;\n        if (data.minwidth !== undefined) candidate = data.minwidth;\n        if (data.forceVerticalMode !== undefined) candidate = data.forceVerticalMode;\n        if (data.forceverticalmode !== undefined) candidate = data.forceverticalmode;\n        if (candidate === undefined && options) {\n          if (options.minWidth !== undefined) candidate = options.minWidth;\n          else if (options.forceVerticalMode !== undefined) candidate = options.forceVerticalMode;\n        }\n        if (candidate !== undefined) settings.minWidth = candidate;\n      } else if (key === 'maxWidth') {\n        let candidate = undefined;\n        if (data.maxWidth !== undefined) candidate = data.maxWidth;\n        if (data.maxwidth !== undefined) candidate = data.maxwidth;\n        if (candidate === undefined && options) {\n          if (options.maxWidth !== undefined) candidate = options.maxWidth;\n        }\n        if (candidate !== undefined) settings.maxWidth = candidate;\n      } else {\n        if (data[key]) {\n          settings[key] = data[key];\n        } else if (options && options[key] !== undefined) {\n          settings[key] = options[key];\n        }\n      }\n\n      if (defaultSettings[key].type === 'integer') {\n        if (!settings[key] || !testValues(settings[key], key)) {\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      } else if (defaultSettings[key].type === 'string') {\n        if (defaultSettings[key].acceptedValues && defaultSettings[key].acceptedValues.indexOf(settings[key]) === -1) {\n          console.warn(`${warningLabel} The value \"${settings[key]}\" entered for the setting \"${key}\" was not recognised.`);\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      }\n    });\n\n    (function applyColorParity(){\n      const data = timelineEl.dataset;\n      const getData = function(k){\n        return data[k] !== undefined ? data[k] : (data[k && k.toLowerCase()] !== undefined ? data[k.toLowerCase()] : undefined);\n      };\n      let nodeColor = getData('nodeColor');\n      let lineColor = getData('lineColor');\n      let navColor = getData('navColor');\n      if (options) {\n        if (options.nodeColor !== undefined) nodeColor = options.nodeColor;\n        if (options.lineColor !== undefined) lineColor = options.lineColor;\n        if (options.navColor !== undefined) navColor = options.navColor;\n      }\n      if (nodeColor || lineColor || navColor) {\n        applyTimelineColors(timelineEl, { nodeColor, lineColor, navColor });\n      }\n    })();\n\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    const triggerArray = settings.verticalTrigger.match(/(\\d*\\.?\\d*)(.*)/);\n    let [, triggerValue, triggerUnit] = triggerArray;\n    let triggerValid = true;\n    if (!triggerValue) {\n      console.warn(`${warningLabel} No numercial value entered for the 'verticalTrigger' setting.`);\n      triggerValid = false;\n    }\n    if (triggerUnit !== 'px' && triggerUnit !== '%') {\n      console.warn(`${warningLabel} The setting 'verticalTrigger' must be a percentage or pixel value.`);\n      triggerValid = false;\n    }\n    if (triggerUnit === '%' && (triggerValue > 100 || triggerValue < 0)) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be between 0 and 100 if using a percentage value.`);\n      triggerValid = false;\n    } else if (triggerUnit === 'px' && triggerValue < 0) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be above 0 if using a pixel value.`);\n      triggerValid = false;\n    }\n\n    if (triggerValid === false) {\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n\n    settings.verticalTrigger = {\n      unit: triggerUnit,\n      value: triggerValue\n    };\n\n    if (settings.moveItems > settings.visibleItems) {\n      console.warn(`${warningLabel} The value of \"moveItems\" (${settings.moveItems}) is larger than the number of \"visibleItems\" (${settings.visibleItems}). The value of \"visibleItems\" has been used instead.`);\n      settings.moveItems = settings.visibleItems;\n    }\n\n    if (settings.startIndex > (items.length - settings.visibleItems) && items.length > settings.visibleItems) {\n      console.warn(`${warningLabel} The 'startIndex' setting must be between 0 and ${items.length - settings.visibleItems} for this timeline. The value of ${items.length - settings.visibleItems} has been used instead.`);\n      settings.startIndex = items.length - settings.visibleItems;\n    } else if (items.length <= settings.visibleItems) {\n      console.warn(`${warningLabel} The number of items in the timeline must exceed the number of visible items to use the 'startIndex' option.`);\n      settings.startIndex = 0;\n    } else if (settings.startIndex < 0) {\n      console.warn(`${warningLabel} The 'startIndex' setting must be between 0 and ${items.length - settings.visibleItems} for this timeline. The value of 0 has been used instead.`);\n      settings.startIndex = 0;\n    }\n\n    enhanceInlineItems(timelineEl, items);\n\n    if (!timelineEl.id) {\n      timelineEl.setAttribute('data-timeline-id', 'timeline-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9));\n    }\n\n    timelines.push({\n      timelineEl,\n      wrap,\n      scroller,\n      items,\n      settings,\n      listeners: [] // Store listeners for cleanup\n    });\n  }\n\n  if (collection.length) {\n    Array.from(collection).forEach(createTimelines);\n  }\n\n  function setHeightandWidths(tl) {\n    function setWidths() {\n      // Get the current scaled node width from CSS variable\n      const computedStyle = getComputedStyle(tl.timelineEl);\n      const nodeWidth = parseInt(computedStyle.getPropertyValue('--timeline-h-node-width')) || 200;\n      tl.itemWidth = nodeWidth;\n      tl.items.forEach((item) => {\n        item.style.width = `${tl.itemWidth}px`;\n      });\n      tl.scrollerWidth = tl.itemWidth * tl.items.length;\n      tl.scroller.style.width = `${tl.scrollerWidth}px`;\n    }\n\n    function setHeights() {\n      let oddIndexTallest = 0;\n      let evenIndexTallest = 0;\n      tl.items.forEach((item, i) => {\n        item.style.height = 'auto';\n        const height = item.offsetHeight;\n        if (i % 2 === 0) {\n          evenIndexTallest = height > evenIndexTallest ? height : evenIndexTallest;\n        } else {\n          oddIndexTallest = height > oddIndexTallest ? height : oddIndexTallest;\n        }\n      });\n\n      const transformString = `translateY(${evenIndexTallest}px)`;\n      tl.items.forEach((item, i) => {\n        if (i % 2 === 0) {\n          item.style.height = `${evenIndexTallest}px`;\n          if (tl.settings.horizontalStartPosition === 'bottom') {\n            item.classList.add('timeline__item--bottom');\n            addTransforms(item, transformString);\n          } else {\n            item.classList.add('timeline__item--top');\n          }\n        } else {\n          item.style.height = `${oddIndexTallest}px`;\n          if (tl.settings.horizontalStartPosition !== 'bottom') {\n            item.classList.add('timeline__item--bottom');\n            addTransforms(item, transformString);\n          } else {\n            item.classList.add('timeline__item--top');\n          }\n        }\n      });\n      // Add 40px to account for bottom padding on items to prevent clipping\n      tl.scroller.style.height = `${evenIndexTallest + oddIndexTallest + 40}px`;\n    }\n\n    if (window.innerWidth > tl.settings.minWidth) {\n      setWidths();\n      setHeights();\n    }\n  }\n\n  function addNavigation(tl) {\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n\n    if (tl.items.length > itemsVisible) {\n      const prevArrow = document.createElement('button');\n      const nextArrow = document.createElement('button');\n      const topPosition = tl.items[0].offsetHeight;\n      prevArrow.className = 'timeline-nav-button timeline-nav-button--prev';\n      nextArrow.className = 'timeline-nav-button timeline-nav-button--next';\n      prevArrow.textContent = 'Previous';\n      prevArrow.title = 'Go to previous items';\n      nextArrow.textContent = 'Next';\n      nextArrow.title = 'Go to next items';\n      prevArrow.style.top = `${topPosition}px`;\n      nextArrow.style.top = `${topPosition}px`;\n\n      const arrowColor = tl.timelineEl.getAttribute('data-arrow-color') || '#333';\n      prevArrow.innerHTML = createArrowSVG('left', arrowColor);\n      nextArrow.innerHTML = createArrowSVG('right', arrowColor);\n\n      const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n      if (currentIndex === 0) {\n        prevArrow.classList.add('timeline-nav-button--at-start');\n        prevArrow.title = 'Already at beginning of timeline';\n      }\n      if (currentIndex >= maxIndex) {\n        nextArrow.classList.add('timeline-nav-button--at-end');\n        nextArrow.title = 'Already at end of timeline';\n      }\n      tl.timelineEl.appendChild(prevArrow);\n      tl.timelineEl.appendChild(nextArrow);\n    }\n  }\n\n  function addHorizontalDivider(tl) {\n    const divider = tl.timelineEl.querySelector('.timeline-divider');\n    if (divider) {\n      tl.timelineEl.removeChild(divider);\n    }\n    const topPosition = tl.items[0].offsetHeight;\n    const horizontalDivider = document.createElement('span');\n    horizontalDivider.className = 'timeline-divider';\n    horizontalDivider.style.top = `${topPosition}px`;\n    tl.timelineEl.appendChild(horizontalDivider);\n  }\n\n  function timelinePosition(tl) {\n    const position = tl.items[currentIndex].offsetLeft;\n    const str = `translate3d(-${position}px, 0, 0)`;\n    addTransforms(tl.scroller, str);\n  }\n\n  function updateActiveItem(tl, index) {\n    // Remove active class from all items\n    tl.items.forEach(item => item.classList.remove('timeline__item--active'));\n    // Add active class to current item\n    if (tl.items[index]) {\n      tl.items[index].classList.add('timeline__item--active');\n    }\n  }\n\n  function slideTimeline(tl) {\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n    const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n    const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n\n    const moveItems = parseInt(tl.settings.moveItems, 10);\n    \n    const handleArrowClick = function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n\n      // If at bounds, show tooltip message and return (no-op)\n      if (this.classList.contains('timeline-nav-button--at-start') || this.classList.contains('timeline-nav-button--at-end')) {\n        return;\n      }\n\n      currentIndex = this.classList.contains('timeline-nav-button--next') ? (currentIndex += moveItems) : (currentIndex -= moveItems);\n      if (currentIndex === 0 || currentIndex < 0) {\n        currentIndex = 0;\n        arrowPrev.classList.add('timeline-nav-button--at-start');\n        arrowPrev.title = 'Already at beginning of timeline';\n        arrowNext.classList.remove('timeline-nav-button--at-end');\n        arrowNext.title = 'Go to next items';\n      } else if (currentIndex === maxIndex || currentIndex > maxIndex) {\n        currentIndex = maxIndex;\n        arrowPrev.classList.remove('timeline-nav-button--at-start');\n        arrowPrev.title = 'Go to previous items';\n        arrowNext.classList.add('timeline-nav-button--at-end');\n        arrowNext.title = 'Already at end of timeline';\n      } else {\n        arrowPrev.classList.remove('timeline-nav-button--at-start');\n        arrowPrev.title = 'Go to previous items';\n        arrowNext.classList.remove('timeline-nav-button--at-end');\n        arrowNext.title = 'Go to next items';\n      }\n      timelinePosition(tl);\n      tl.activeIndex = currentIndex;\n      updateActiveItem(tl, tl.activeIndex);\n      // Remove focus from button to avoid keyboard navigation side effects\n      this.blur();\n    };\n    \n    Array.from(navArrows).forEach((arrow) => {\n      arrow.addEventListener('click', handleArrowClick);\n      tl.listeners.push({ element: arrow, type: 'click', handler: handleArrowClick });\n    });\n  }\n\n  function setUpHorinzontalTimeline(tl) {\n    if (tl.settings.rtlMode) {\n      currentIndex = tl.items.length > tl.settings.visibleItems ? tl.items.length - tl.settings.visibleItems : 0;\n    } else {\n      currentIndex = tl.settings.startIndex;\n    }\n    // Track the \"active\" item separately from the scroll position.\n    // Usually these are the same, but they can diverge near the end (e.g. last item).\n    tl.activeIndex = currentIndex;\n    tl.timelineEl.classList.add('timeline--horizontal');\n    // Calculate responsive scaling before layout calculations\n    calculateHorizontalScale(tl.timelineEl);\n    setHeightandWidths(tl);\n    timelinePosition(tl);\n    updateActiveItem(tl, tl.activeIndex);\n    addNavigation(tl);\n    addHorizontalDivider(tl);\n    slideTimeline(tl);\n\n    const timelineId = tl.timelineEl.id || tl.timelineEl.getAttribute('data-timeline-id');\n    if (timelineId) {\n      timelineRegistry[timelineId] = {\n        setCurrentIndex: function(index) {\n          const viewportWidth = tl.wrap.offsetWidth;\n          const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n          const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n          // Scroll position clamps to maxIndex, but the active highlight can be the actual requested item.\n          tl.activeIndex = Math.max(0, Math.min(index, tl.items.length - 1));\n          currentIndex = Math.max(0, Math.min(index, maxIndex));\n        },\n        updatePosition: function() {\n          timelinePosition(tl);\n          updateActiveItem(tl, tl.activeIndex);\n          const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n          const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n          if (arrowPrev && arrowNext) {\n            const viewportWidth = tl.wrap.offsetWidth;\n            const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n            const maxIndex = Math.max(0, tl.items.length - itemsVisible);\n            // Use classes instead of disabled attribute to avoid focus issues\n            if (currentIndex === 0) {\n              arrowPrev.classList.add('timeline-nav-button--at-start');\n              arrowPrev.title = 'Already at beginning of timeline';\n            } else {\n              arrowPrev.classList.remove('timeline-nav-button--at-start');\n              arrowPrev.title = 'Go to previous items';\n            }\n            if (currentIndex >= maxIndex) {\n              arrowNext.classList.add('timeline-nav-button--at-end');\n              arrowNext.title = 'Already at end of timeline';\n            } else {\n              arrowNext.classList.remove('timeline-nav-button--at-end');\n              arrowNext.title = 'Go to next items';\n            }\n          }\n        }\n      };\n\n      // Clicking an item (dot or card) should also make it the current/active node.\n      // This runs alongside modal opening.\n      const tlData = timelineRegistry[timelineId];\n      tl.items.forEach((item, idx) => {\n        const activateHandler = () => {\n          if (!tl.timelineEl.classList.contains('timeline--horizontal')) return;\n          if (tlData && tlData.setCurrentIndex && tlData.updatePosition) {\n            tlData.setCurrentIndex(idx);\n            tlData.updatePosition();\n          }\n        };\n        item.addEventListener('click', activateHandler);\n        tl.listeners.push({ element: item, type: 'click', handler: activateHandler });\n      });\n    }\n  }\n\n  function setUpVerticalTimeline(tl) {\n    let lastVisibleIndex = 0;\n    tl.items.forEach((item, i) => {\n      item.classList.remove('animated', 'fadeIn');\n      if (!isElementInViewport(item, tl.settings.verticalTrigger) && i > 0) {\n        item.classList.add('animated');\n      } else {\n        lastVisibleIndex = i;\n      }\n      const divider = tl.settings.verticalStartPosition === 'left' ? 1 : 0;\n      if (i % 2 === divider && window.innerWidth > tl.settings.minWidth) {\n        item.classList.add('timeline__item--right');\n      } else {\n        item.classList.add('timeline__item--left');\n      }\n    });\n    for (let i = 0; i < lastVisibleIndex; i += 1) {\n      tl.items[i].classList.remove('animated', 'fadeIn');\n    }\n    \n    // Use IntersectionObserver instead of scroll listener for better performance\n    if ('IntersectionObserver' in window) {\n      const observerOptions = {\n        rootMargin: tl.settings.verticalTrigger.unit === '%' \n          ? `${tl.settings.verticalTrigger.value}%` \n          : `${tl.settings.verticalTrigger.value}px`,\n        threshold: 0.01\n      };\n      \n      const observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            entry.target.classList.add('fadeIn');\n          }\n        });\n      }, observerOptions);\n      \n      tl.items.forEach((item) => {\n        if (item.classList.contains('animated')) {\n          observer.observe(item);\n        }\n      });\n      \n      // Store observer for cleanup\n      tl.observer = observer;\n    } else {\n      // Fallback for older browsers (though we're targeting 2018+)\n      const scrollHandler = () => {\n        tl.items.forEach((item) => {\n          if (isElementInViewport(item, tl.settings.verticalTrigger)) {\n            item.classList.add('fadeIn');\n          }\n        });\n      };\n      window.addEventListener('scroll', scrollHandler);\n      tl.listeners.push({ element: window, type: 'scroll', handler: scrollHandler });\n    }\n  }\n\n  function resetTimelines(tl) {\n    // Clean up event listeners\n    if (tl.listeners && tl.listeners.length > 0) {\n      tl.listeners.forEach(({ element, type, handler }) => {\n        element.removeEventListener(type, handler);\n      });\n      tl.listeners = [];\n    }\n    \n    // Clean up IntersectionObserver\n    if (tl.observer) {\n      tl.observer.disconnect();\n      tl.observer = null;\n    }\n    \n    tl.timelineEl.classList.remove('timeline--horizontal', 'timeline--mobile');\n    tl.scroller.removeAttribute('style');\n    tl.items.forEach((item) => {\n      item.removeAttribute('style');\n      item.classList.remove('animated', 'fadeIn', 'timeline__item--left', 'timeline__item--right');\n    });\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    Array.from(navArrows).forEach((arrow) => {\n      arrow.parentNode.removeChild(arrow);\n    });\n  }\n\n  function setUpTimelines() {\n    timelines.forEach((tl) => {\n      tl.timelineEl.style.opacity = 0;\n      if (!tl.timelineEl.classList.contains('timeline--loaded')) {\n        wrapElements(tl.items);\n      }\n      resetTimelines(tl);\n      if (window.innerWidth <= tl.settings.minWidth) {\n        tl.timelineEl.classList.add('timeline--mobile');\n      }\n      \n      // Determine which mode to use based on settings and viewport width\n      let useHorizontalMode = false;\n      if (tl.settings.mode === 'horizontal' && window.innerWidth > tl.settings.minWidth) {\n        useHorizontalMode = true;\n      } else if (tl.settings.mode === 'vertical' && window.innerWidth > tl.settings.maxWidth) {\n        useHorizontalMode = true;\n      }\n      \n      if (useHorizontalMode) {\n        setUpHorinzontalTimeline(tl);\n      } else {\n        setUpVerticalTimeline(tl);\n      }\n      tl.timelineEl.classList.add('timeline--loaded');\n    });\n\n    setTimeout(() => {\n      timelines.forEach((tl) => {\n        tl.timelineEl.style.opacity = 1;\n      });\n    }, 500);\n\n    if (shouldHideLoader) {\n      hideTimelineLoader();\n      shouldHideLoader = false;\n    }\n  }\n\n  try {\n    setUpTimelines();\n\n    window.addEventListener('resize', () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        const newWinWidth = window.innerWidth;\n        if (newWinWidth !== winWidth) {\n          setUpTimelines();\n          winWidth = newWinWidth;\n        }\n      }, 250);\n    });\n  } catch (e) {\n    console.error('Timeline initialization failed:', e);\n  } finally {\n    if (shouldHideLoader) {\n      hideTimelineLoader();\n      shouldHideLoader = false;\n    }\n  }\n}","import { timelineBasePath } from '../shared/config.js';\nimport { showTimelineLoader, hideTimelineLoader } from './loader-ui.js';\nimport { showTimelineError } from './error-ui.js';\nimport { applyTimelineColors } from './colors.js';\nimport { handleDeepLinking } from './deep-linking.js';\nimport { timeline } from '../core/timeline-engine.js';\n\nfunction createItemNode(item) {\n  const itemEl = document.createElement('div');\n  itemEl.className = 'timeline__item';\n\n  if (item.id) {\n    itemEl.setAttribute('data-node-id', item.id);\n  }\n\n  itemEl.setAttribute('data-modal-title', item.title || '');\n  itemEl.setAttribute('data-modal-content', item.content || '');\n  itemEl.setAttribute('data-modal-image', item.image || '');\n  if (item.html) {\n    itemEl.setAttribute('data-modal-html', item.html);\n  }\n\n  const content = document.createElement('div');\n  content.className = 'timeline__content';\n\n  if (item.image) {\n    const img = document.createElement('img');\n    img.src = item.image;\n    img.className = 'timeline__image';\n    img.alt = item.title || '';\n    img.loading = 'lazy';\n    img.onerror = function() {\n      console.error('Timeline: The image \"' + item.image + '\" could not be loaded. Please check the path.');\n      this.src = timelineBasePath + '/missing-image.svg';\n      this.alt = 'Image not found';\n      this.title = 'Original image: ' + item.image;\n    };\n    content.appendChild(img);\n  }\n\n  const textWrapper = document.createElement('div');\n  if (item.title) {\n    const title = document.createElement('h3');\n    title.textContent = item.title;\n    textWrapper.appendChild(title);\n  }\n\n  if (item.content) {\n    const para = document.createElement('p');\n    let displayText = item.content;\n    if (displayText.length > 105) {\n      displayText = displayText.substring(0, 105) + '...';\n    }\n    para.innerHTML = displayText;\n    textWrapper.appendChild(para);\n  }\n\n  if (item.html) {\n    const wrapper = document.createElement('div');\n    wrapper.innerHTML = item.html;\n    textWrapper.appendChild(wrapper);\n  }\n\n  content.appendChild(textWrapper);\n  itemEl.appendChild(content);\n\n  itemEl.addEventListener('click', function(e) {\n    e.preventDefault();\n    if (typeof window.openTimelineModal === 'function') {\n      window.openTimelineModal(itemEl);\n    }\n  });\n  itemEl.setAttribute('data-modal-bound', '1');\n\n  return itemEl;\n}\n\nfunction applyDataAttributes(container, config) {\n  if (config.layoutMode) {\n    container.setAttribute('data-mode', config.layoutMode);\n  }\n  if (config.visibleItems !== undefined) {\n    container.setAttribute('data-visible-items', config.visibleItems);\n  }\n  if (config.minWidth !== undefined) {\n    container.setAttribute('data-min-width', config.minWidth);\n    container.setAttribute('data-force-vertical-mode', config.minWidth);\n  }\n  if (config.maxWidth !== undefined) {\n    container.setAttribute('data-max-width', config.maxWidth);\n  }\n}\n\nexport function renderTimelineFromData(containerSelector, data, config) {\n  const container = document.querySelector(containerSelector);\n  if (!container) return;\n\n  // remove any previous error state\n  container.classList.remove('timeline--error');\n\n  let itemsWrap = container.querySelector('.timeline__items');\n  if (!itemsWrap) {\n    const wrap = document.createElement('div');\n    wrap.className = 'timeline__wrap';\n    itemsWrap = document.createElement('div');\n    itemsWrap.className = 'timeline__items';\n    wrap.appendChild(itemsWrap);\n    container.appendChild(wrap);\n  } else {\n    itemsWrap.innerHTML = '';\n  }\n\n  if (config) {\n    applyDataAttributes(container, config);\n    applyTimelineColors(container, config);\n\n    if (config.timelineName && config.timelineName.trim() !== '') {\n      const existingHeading = container.previousElementSibling;\n      if (existingHeading && existingHeading.classList.contains('timeline__heading')) {\n        existingHeading.textContent = config.timelineName;\n      } else {\n        const heading = document.createElement('h1');\n        heading.className = 'timeline__heading';\n        heading.textContent = config.timelineName;\n        container.parentNode.insertBefore(heading, container);\n      }\n      container.setAttribute('data-timeline-name', config.timelineName);\n    }\n  }\n\n  data.forEach(function (it) {\n    itemsWrap.appendChild(createItemNode(it));\n  });\n\n  return container;\n}\n\nexport function timelineFromData(containerSelector, data, options) {\n  const container = renderTimelineFromData(containerSelector, data, options);\n  if (!container) return;\n  // Skip loader for programmatic timelines (data already in memory)\n  const mergedOptions = Object.assign({}, options, { skipLoader: true });\n  timeline([container], mergedOptions);\n}\n\nexport function loadDataFromJson(url, containerSelector) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    return;\n  }\n\n  showTimelineLoader();\n\n  const timelineId = container ? container.id : null;\n  const cacheKey = timelineId ? 'vjs_' + timelineId : null;\n\n  if (cacheKey && typeof(Storage) !== 'undefined') {\n    try {\n      const cached = localStorage.getItem(cacheKey);\n      if (cached) {\n        const cachedData = JSON.parse(cached);\n        fetch(url).then(function(res) {\n          if (!res.ok) throw new Error('Failed to load ' + url + ' (' + res.status + ')');\n          return res.json();\n        }).then(function(json) {\n          if (json.lastupdated && cachedData.lastupdated && json.lastupdated === cachedData.lastupdated) {\n            console.log('Using cached timeline data for', timelineId);\n            processTimelineData(cachedData, containerSelector);\n          } else {\n            console.log('Updating cached timeline data for', timelineId);\n            localStorage.setItem(cacheKey, JSON.stringify(json));\n            processTimelineData(json, containerSelector);\n          }\n        }).catch(function(err) {\n          console.warn('Failed to fetch fresh data, using cache:', err);\n          processTimelineData(cachedData, containerSelector);\n        });\n        return;\n      }\n    } catch (e) {\n      console.warn('Error reading from localStorage:', e);\n    }\n  }\n\n  fetch(url).then(function (res) {\n    if (!res.ok) throw new Error('Failed to load ' + url + ' (' + res.status + ')');\n    return res.json();\n  }).then(function (json) {\n    if (cacheKey && typeof(Storage) !== 'undefined') {\n      try {\n        localStorage.setItem(cacheKey, JSON.stringify(json));\n        console.log('Cached timeline data for', timelineId);\n      } catch (e) {\n        console.warn('Failed to cache timeline data:', e);\n      }\n    }\n    processTimelineData(json, containerSelector);\n  }).catch(function (err) {\n    console.error('Error loading timeline JSON:', err);\n    showTimelineError(container, 'json-load', err.message);\n  });\n}\n\nexport function processTimelineData(json, containerSelector) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    return;\n  }\n\n  let config = null;\n  let nodes = [];\n\n  try {\n    if (json.nodes && Array.isArray(json.nodes)) {\n      nodes = json.nodes;\n      config = {\n        timelineName: json.timelineName,\n        layoutMode: json.layoutMode,\n        visibleItems: json.visibleItems,\n        minWidth: json.minWidth,\n        maxWidth: json.maxWidth,\n        nodeColor: json.nodeColor,\n        lineColor: json.lineColor,\n        navColor: json.navColor,\n        lastupdated: json.lastupdated\n      };\n    } else if (Array.isArray(json)) {\n      nodes = json;\n    } else {\n      throw new Error('Invalid JSON format. Expected object with \"nodes\" array or simple array.');\n    }\n\n    if (nodes.length === 0) {\n      throw new Error('No timeline items found in data.');\n    }\n\n    renderTimelineFromData(containerSelector, nodes, config);\n\n    try {\n      timeline(document.querySelectorAll(containerSelector));\n      handleDeepLinking(containerSelector);\n      hideTimelineLoader();\n    } catch (e) {\n      console.error('Error initializing timeline:', e);\n      const container = document.querySelector(containerSelector);\n      if (container) {\n        showTimelineError(container, 'invalid-config', e.message);\n      }\n      hideTimelineLoader();\n    }\n\n  } catch (e) {\n    console.error('Error processing timeline data:', e);\n    showTimelineError(container, 'json-parse', e.message);\n    hideTimelineLoader();\n  }\n}\n\nexport function clearTimelineCache(timelineId) {\n  if (typeof(Storage) === 'undefined') {\n    console.warn('localStorage not supported');\n    return;\n  }\n\n  if (timelineId) {\n    const key = 'vjs_' + timelineId;\n    localStorage.removeItem(key);\n    console.log('Cleared cache for timeline:', timelineId);\n  } else {\n    const keys = Object.keys(localStorage);\n    let cleared = 0;\n    keys.forEach(function(key) {\n      if (key.startsWith('vjs_')) {\n        localStorage.removeItem(key);\n        cleared++;\n      }\n    });\n    console.log('Cleared', cleared, 'timeline cache(s)');\n  }\n}\n","// --------------------------------------------------------------------------\r\n// timeline.js - a vanilla JS app to display timelines\r\n// \r\n// Created in 2018 by Mike Collins (https://github.com/squarechip/timeline)\r\n// Modified in 2026 by Ken Dawson (https://github.com/kendawson-online)\r\n// Last updated: 01/08/26\r\n//\r\n// --------------------------------------------------------------------------\r\n\r\nimport { createTimelineModal, openTimelineModal, closeTimelineModal } from './features/modals.js';\r\nimport { handleDeepLinking, navigateToNodeIndex } from './features/deep-linking.js';\r\nimport { renderTimelineFromData, timelineFromData, loadDataFromJson, processTimelineData, clearTimelineCache } from './features/data-loader.js';\r\nimport { timeline } from './core/timeline-engine.js';\r\nimport '../css/timeline.css';\r\n\r\nfunction autoInitJsonTimelines() {\r\n  const timelinesWithJson = document.querySelectorAll('[data-json-config]');\r\n  timelinesWithJson.forEach(function(timelineEl) {\r\n    const jsonUrl = timelineEl.getAttribute('data-json-config');\r\n    if (!jsonUrl) return;\r\n    const className = (timelineEl.className || '').split(' ')[0];\r\n    const selector = timelineEl.id ? '#' + timelineEl.id : (className ? '.' + className : null);\r\n    if (selector) {\r\n      loadDataFromJson(jsonUrl, selector);\r\n    }\r\n  });\r\n}\r\n\r\nfunction exposeGlobals() {\r\n  if (typeof window === 'undefined') return;\r\n  window.timeline = timeline;\r\n  window.timelineFromData = timelineFromData;\r\n  window.renderTimelineFromData = renderTimelineFromData;\r\n  window.processTimelineData = processTimelineData;\r\n  window.loadDataFromJson = loadDataFromJson;\r\n  window.clearTimelineCache = clearTimelineCache;\r\n  window.createTimelineModal = createTimelineModal;\r\n  window.openTimelineModal = openTimelineModal;\r\n  window.closeTimelineModal = closeTimelineModal;\r\n  window.handleTimelineDeepLinking = handleDeepLinking;\r\n  window.navigateTimelineToNodeIndex = navigateToNodeIndex;\r\n}\r\n\r\nexposeGlobals();\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  autoInitJsonTimelines();\r\n});\r\n\r\nif (typeof window !== 'undefined' && window.jQuery) {\r\n  (( $) => {\r\n    $.fn.timeline = function(opts) {\r\n      timeline(this, opts);\r\n      return this;\r\n    };\r\n  })(window.jQuery);\r\n}\r\n\r\nexport {\r\n  timeline,\r\n  timelineFromData,\r\n  renderTimelineFromData,\r\n  loadDataFromJson,\r\n  processTimelineData,\r\n  clearTimelineCache,\r\n  createTimelineModal,\r\n  openTimelineModal,\r\n  closeTimelineModal,\r\n  handleDeepLinking,\r\n  navigateToNodeIndex\r\n};"],"names":["loaderState","count","startTime","removeTimer","overlayEl","modalState","modal","overlay","timelineRegistry","createTimelineModal","document","createElement","className","addEventListener","closeTimelineModal","innerHTML","closeBtn","querySelector","closeBottomBtn","e","stopPropagation","body","appendChild","key","classList","contains","openTimelineModal","itemEl","title","getAttribute","content","image","html","modalTitle","modalText","modalImage","textContent","src","alt","style","display","replace","setTimeout","add","overflow","remove","handleDeepLinking","containerSelector","urlParams","URLSearchParams","window","location","search","timelineId","get","nodeId","targetContainer","getElementById","console","warn","scrollIntoView","behavior","block","targetNode","querySelectorAll","forEach","n","itemIndex","Array","from","parentNode","children","indexOf","navigateToNodeIndex","container","index","id","tlData","setCurrentIndex","updatePosition","timelineBasePath","TimelineConfig","basePath","scripts","getElementsByTagName","i","length","dir","substring","lastIndexOf","showTimelineLoader","Date","now","clearTimeout","loader","spinner","width","height","hideTimelineLoader","removeOverlay","elapsed","remaining","Math","max","showTimelineError","errorType","details","errorInfo","message","solution","errorDiv","errorIcon","errorTitle","errorMessage","errorSolution","errorDetails","error","evt","CustomEvent","detail","type","containerId","dispatchEvent","getColorBrightness","color","rgb","startsWith","hex","parseInt","matches","match","map","Number","applyTimelineColors","config","nodeColor","lineColor","navColor","setProperty","arrowColor","setAttribute","createArrowSVG","direction","timeline","collection","options","timelines","warningLabel","resizeTimer","winWidth","innerWidth","currentIndex","skipLoader","shouldHideLoader","defaultSettings","minWidth","defaultValue","maxWidth","horizontalStartPosition","acceptedValues","mode","moveItems","rtlMode","startIndex","verticalStartPosition","verticalTrigger","visibleItems","itemWrap","el","wrapper","classes","insertBefore","isElementInViewport","triggerPosition","rect","getBoundingClientRect","windowHeight","innerHeight","documentElement","clientHeight","defaultTrigger","triggerUnit","unit","triggerValue","value","trigger","top","left","clientWidth","addTransforms","transform","webkitTransform","msTransform","timelinePosition","tl","str","items","offsetLeft","scroller","updateActiveItem","item","setUpHorinzontalTimeline","settings","activeIndex","timelineEl","constraints","min","default","availableHeight","requiredHeight","scaleFactor","scaleValue","scaled","round","calculateHorizontalScale","computedStyle","getComputedStyle","nodeWidth","getPropertyValue","itemWidth","scrollerWidth","setWidths","oddIndexTallest","evenIndexTallest","offsetHeight","transformString","setHeights","setHeightandWidths","viewportWidth","wrap","offsetWidth","itemsVisible","floor","prevArrow","nextArrow","topPosition","maxIndex","addNavigation","divider","removeChild","horizontalDivider","addHorizontalDivider","navArrows","arrowPrev","arrowNext","handleArrowClick","preventDefault","stopImmediatePropagation","this","blur","arrow","listeners","push","element","handler","slideTimeline","idx","activateHandler","setUpTimelines","opacity","removeEventListener","observer","disconnect","removeAttribute","resetTimelines","useHorizontalMode","lastVisibleIndex","observerOptions","rootMargin","threshold","IntersectionObserver","entries","entry","isIntersecting","target","observe","scrollHandler","setUpVerticalTimeline","timelineName","errorPart","data","dataset","Error","slice","call","Object","keys","candidate","undefined","minwidth","forceVerticalMode","forceverticalmode","maxwidth","settingName","getData","k","toLowerCase","triggerArray","triggerValid","hasAttribute","heading","trim","firstP","img","ensureInlineModalData","enhanceInlineItems","random","toString","substr","newWinWidth","renderTimelineFromData","itemsWrap","layoutMode","applyDataAttributes","existingHeading","previousElementSibling","it","loading","onerror","textWrapper","para","displayText","createItemNode","timelineFromData","assign","loadDataFromJson","url","cacheKey","cached","localStorage","getItem","cachedData","JSON","parse","fetch","then","res","ok","status","json","lastupdated","log","processTimelineData","setItem","stringify","catch","err","nodes","isArray","clearTimelineCache","removeItem","cleared","handleTimelineDeepLinking","navigateTimelineToNodeIndex","jsonUrl","split","selector","jQuery","fn","opts"],"mappings":"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"}