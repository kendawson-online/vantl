{"version":3,"file":"timeline.min.js","sources":["../src/js/shared/state.js","../src/js/features/modals.js","../src/js/features/deep-linking.js","../src/js/shared/config.js","../src/js/features/error-ui.js","../src/js/shared/utils.js","../src/js/features/colors.js","../src/js/core/timeline-engine.js","../src/js/features/data-loader.js","../src/js/shared/lipsum.js","../src/js/timeline.js"],"sourcesContent":["export const modalState = {\n  modal: null,\n  overlay: null\n};\n\n// Global registry to store timeline instances for programmatic navigation\nexport const timelineRegistry = {};\n","import { modalState } from '../shared/state.js';\n\nexport function createTimelineModal() {\n  if (modalState.modal) return;\n\n  modalState.overlay = document.createElement('div');\n  modalState.overlay.className = 'timeline-modal-overlay';\n  modalState.overlay.addEventListener('click', closeTimelineModal);\n\n  modalState.modal = document.createElement('div');\n  modalState.modal.className = 'timeline-modal';\n  modalState.modal.innerHTML = `\n    <button class=\"timeline-modal__close\" aria-label=\"Close modal\"></button>\n    <div class=\"timeline-modal__content\">\n      <img class=\"timeline-modal__image\" src=\"\" alt=\"\" loading=\"lazy\" style=\"display: none;\">\n      <h2 class=\"timeline-modal__title\"></h2>\n      <div class=\"timeline-modal__text\"></div>\n    </div>\n    <div class=\"timeline-modal__footer\">\n      <button class=\"timeline-modal__close-bottom\">Close</button>\n    </div>\n  `;\n\n  const closeBtn = modalState.modal.querySelector('.timeline-modal__close');\n  const closeBottomBtn = modalState.modal.querySelector('.timeline-modal__close-bottom');\n  closeBtn.addEventListener('click', closeTimelineModal);\n  closeBottomBtn.addEventListener('click', closeTimelineModal);\n\n  modalState.modal.addEventListener('click', function(e) {\n    e.stopPropagation();\n  });\n\n  document.body.appendChild(modalState.overlay);\n  document.body.appendChild(modalState.modal);\n\n  document.addEventListener('keydown', function(e) {\n    if (e.key === 'Escape' && modalState.modal.classList.contains('timeline-modal-show')) {\n      closeTimelineModal();\n    }\n  });\n}\n\nexport function openTimelineModal(itemEl) {\n  if (!modalState.modal) {\n    createTimelineModal();\n  }\n\n  const title = itemEl.getAttribute('data-modal-title');\n  const content = itemEl.getAttribute('data-modal-content');\n  const image = itemEl.getAttribute('data-modal-image');\n  const html = itemEl.getAttribute('data-modal-html');\n\n  const modalTitle = modalState.modal.querySelector('.timeline-modal__title');\n  const modalText = modalState.modal.querySelector('.timeline-modal__text');\n  const modalImage = modalState.modal.querySelector('.timeline-modal__image');\n\n  modalTitle.textContent = title || '';\n\n  if (image) {\n    modalImage.src = image;\n    modalImage.alt = title || '';\n    modalImage.style.display = 'block';\n  } else {\n    modalImage.style.display = 'none';\n  }\n\n  if (html) {\n    modalText.innerHTML = html;\n  } else if (content) {\n    modalText.innerHTML = '<p>' + content.replace(/\\n/g, '</p><p>') + '</p>';\n  } else {\n    modalText.innerHTML = '';\n  }\n\n  setTimeout(function() {\n    modalState.modal.classList.add('timeline-modal-show');\n    modalState.overlay.classList.add('timeline-modal-show');\n    document.body.style.overflow = 'hidden';\n  }, 10);\n}\n\nexport function closeTimelineModal() {\n  if (modalState.modal) {\n    modalState.modal.classList.remove('timeline-modal-show');\n    modalState.overlay.classList.remove('timeline-modal-show');\n    document.body.style.overflow = '';\n  }\n}\n","import { timelineRegistry } from '../shared/state.js';\n\nexport function handleDeepLinking(containerSelector) {\n  const urlParams = new URLSearchParams(window.location.search);\n  const timelineId = urlParams.get('timeline');\n  const nodeId = urlParams.get('id');\n  if (!nodeId) return;\n\n  let targetContainer;\n  if (timelineId) {\n    targetContainer = document.getElementById(timelineId);\n  } else {\n    targetContainer = document.querySelector(containerSelector);\n  }\n\n  if (!targetContainer) {\n    console.warn('Timeline not found for deep linking:', timelineId || containerSelector);\n    return;\n  }\n\n  targetContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\n  const targetNode = targetContainer.querySelector('[data-node-id=\"' + nodeId + '\"]');\n  if (targetNode) {\n    setTimeout(function() {\n      // Ensure only one active item is highlighted in this timeline\n      targetContainer.querySelectorAll('.timeline__item--active').forEach((n) => n.classList.remove('timeline__item--active'));\n      targetNode.classList.add('timeline__item--active');\n      const itemIndex = Array.from(targetNode.parentNode.children).indexOf(targetNode);\n      navigateToNodeIndex(targetContainer, itemIndex);\n    }, 500);\n  }\n}\n\nexport function navigateToNodeIndex(container, index) {\n  if (!container) return;\n  const timelineId = container.id || container.getAttribute('data-timeline-id');\n  if (!timelineId) {\n    console.warn('Cannot navigate: timeline container has no ID');\n    return;\n  }\n\n  const tlData = timelineRegistry[timelineId];\n  if (!tlData) {\n    console.warn('Timeline not found in registry:', timelineId);\n    return;\n  }\n\n  if (!container.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  if (tlData.setCurrentIndex && tlData.updatePosition) {\n    tlData.setCurrentIndex(index);\n    tlData.updatePosition();\n  }\n}\n","// Shared configuration values\n// Auto-detect the timeline.js script location to build correct image paths\nexport const timelineBasePath = (function() {\n  // Check for user override\n  if (typeof window !== 'undefined' && \n      window.TimelineConfig && \n      window.TimelineConfig.basePath) {\n    return window.TimelineConfig.basePath;\n  }\n  \n  const scripts = document.getElementsByTagName('script');\n  for (let i = 0; i < scripts.length; i++) {\n    const src = scripts[i].src || '';\n    if (!src) continue;\n    const dir = src.substring(0, src.lastIndexOf('/'));\n    if (src.indexOf('timeline.min.js') !== -1) {\n      // When loading from dist, map to src/images\n      return dir.replace('/dist', '/src/images');\n    }\n    if (src.indexOf('timeline.js') !== -1) {\n      // When loading from src/js, map to src/images\n      return dir.replace('/js', '/images');\n    }\n  }\n  // Fallback relative to demo pages; most demos live under demo/**\n  return '../src/images';\n})();\n\n// Minimum time (ms) to keep the loading spinner visible\n","import { timelineBasePath } from '../shared/config.js';\n\nexport function showTimelineError(container, errorType, details) {\n  if (!container) return;\n\n  const errorMessages = {\n    'json-load': {\n      title: 'Timeline Data Could Not Be Loaded',\n      message: 'The timeline data failed to load. This could be due to a network error or an incorrect file path.',\n      solution: 'Please check that the data-json-config path is correct and the file is accessible.'\n    },\n    'json-parse': {\n      title: 'Invalid Timeline Data',\n      message: 'The timeline data file exists but contains invalid JSON.',\n      solution: 'Please validate your JSON using a tool like jsonlint.com and ensure it follows the correct schema.'\n    },\n    'missing-element': {\n      title: 'Timeline Element Not Found',\n      message: 'The required timeline container element could not be found on the page.',\n      solution: 'Ensure your HTML includes a container with the class \"timeline\" and the correct selector.'\n    },\n    'invalid-config': {\n      title: 'Invalid Configuration',\n      message: 'One or more timeline configuration options are invalid.',\n      solution: 'Check your data attributes or JavaScript options and ensure they match the expected format.'\n    }\n  };\n\n  const errorInfo = errorMessages[errorType] || {\n    title: 'Timeline Error',\n    message: 'An unexpected error occurred while initializing the timeline.',\n    solution: 'Please check the browser console for more details.'\n  };\n\n  // mark container as error state so timeline visuals (lines, nav buttons) can be hidden via CSS\n  container.classList.add('timeline--error');\n  container.innerHTML = '';\n\n  const errorDiv = document.createElement('div');\n  errorDiv.className = 'timeline__error';\n\n  const errorIcon = document.createElement('img');\n  errorIcon.src = timelineBasePath + '/alert.svg';\n  errorIcon.alt = 'Error';\n  errorIcon.className = 'timeline__error-icon';\n  // Ensure a reasonable default size even if CSS isn't loaded\n  // This makes the error icon usable when a consumer forgets to include CSS.\n  errorIcon.width = 200;\n  errorIcon.style.height = 'auto';\n\n  const errorTitle = document.createElement('h2');\n  errorTitle.className = 'timeline__error-title';\n  errorTitle.textContent = errorInfo.title;\n\n  const errorMessage = document.createElement('p');\n  errorMessage.className = 'timeline__error-message';\n  errorMessage.textContent = errorInfo.message;\n\n  const errorSolution = document.createElement('p');\n  errorSolution.className = 'timeline__error-solution';\n  errorSolution.innerHTML = '<strong>Solution:</strong> ' + errorInfo.solution;\n\n  if (details) {\n    const errorDetails = document.createElement('p');\n    errorDetails.className = 'timeline__error-details';\n    errorDetails.innerHTML = '<strong>Details:</strong> ' + details;\n    errorDiv.appendChild(errorDetails);\n  }\n\n  errorDiv.appendChild(errorIcon);\n  errorDiv.appendChild(errorTitle);\n  errorDiv.appendChild(errorMessage);\n  errorDiv.appendChild(errorSolution);\n\n  container.appendChild(errorDiv);\n\n  console.error('Timeline Error [' + errorType + ']:', errorInfo.message, details || '');\n\n  // Emit a global event so host pages can react (e.g., cancel instructions UI)\n  try {\n    const evt = new CustomEvent('timeline:error', {\n      detail: {\n        type: errorType,\n        message: errorInfo.message,\n        details: details || null,\n        containerId: container.id || null\n      }\n    });\n    window.dispatchEvent(evt);\n  } catch (e) {\n    // ignore event errors in very old browsers\n  }\n}\n","// Utility helpers shared across modules\nexport function getContrastColor(bgColor) {\n  const brightness = getColorBrightness(bgColor);\n  return brightness > 128 ? 'rgba(0, 0, 0, 0.2)' : 'rgba(255, 255, 255, 0.3)';\n}\n\nexport function getColorBrightness(color) {\n  let rgb;\n  if (!color || typeof color !== 'string') return 128;\n\n  if (color.startsWith('#')) {\n    let hex = color.substring(1);\n    if (hex.length === 3) {\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n    }\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    rgb = [r, g, b];\n  } else if (color.startsWith('rgb')) {\n    const matches = color.match(/\\d+/g);\n    rgb = matches ? matches.map(Number) : [128, 128, 128];\n  } else {\n    return 128;\n  }\n\n  return (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;\n}\n","import { getContrastColor, getColorBrightness } from '../shared/utils.js';\n\nexport function applyTimelineColors(container, config) {\n  let nodeColor = config.nodeColor || null;\n  let lineColor = config.lineColor || null;\n  const navColor = config.navColor || null;\n\n  if (nodeColor && !lineColor) lineColor = nodeColor;\n  if (lineColor && !nodeColor) nodeColor = lineColor;\n\n  if (nodeColor) {\n    container.style.setProperty('--timeline-node-color', nodeColor);\n    // Use configured nodeColor for the active/current item outline\n    container.style.setProperty('--timeline-active-outline-color', nodeColor);\n  }\n  if (lineColor) {\n    container.style.setProperty('--timeline-line-color', lineColor);\n  }\n  if (navColor) {\n    container.style.setProperty('--timeline-nav-color', navColor);\n    container.style.setProperty('--timeline-nav-border', getContrastColor(navColor));\n    const brightness = getColorBrightness(navColor);\n    const arrowColor = brightness > 128 ? '#333' : '#fff';\n    container.style.setProperty('--timeline-arrow-color', arrowColor);\n    container.setAttribute('data-arrow-color', arrowColor);\n  }\n}\n","import { showTimelineError } from '../features/error-ui.js';\nimport { applyTimelineColors } from '../features/colors.js';\nimport { openTimelineModal } from '../features/modals.js';\nimport { timelineRegistry } from '../shared/state.js';\n\n/**\n * Calculate and apply responsive scaling for horizontal timeline based on viewport height\n * @param {HTMLElement} timelineEl - The timeline container element\n */\nfunction calculateHorizontalScale(timelineEl) {\n  if (!timelineEl || !timelineEl.classList.contains('timeline--horizontal')) {\n    return;\n  }\n\n  // Define constraints\n  const constraints = {\n    nodeWidth: { min: 150, max: 200, default: 200 },\n    nodeMinHeight: { min: 135, max: 180, default: 180 },\n    imageSize: { min: 80, max: 100, default: 100 },\n    titleFontSize: { min: 14, max: 18, default: 18 },\n    textFontSize: { min: 11, max: 13, default: 11 }\n  };\n\n  // Get available viewport height (minus padding/margins)\n  const viewportHeight = window.innerHeight;\n  const timelinePadding = 180; // Account for heading, margins, bottom item padding (40px), and buffer\n  const availableHeight = viewportHeight - timelinePadding;\n\n  // Calculate required height for default (max) dimensions\n  // Two rows of nodes + divider line + spacing + bottom padding\n  const maxNodeHeight = constraints.nodeMinHeight.max;\n  const requiredHeight = (maxNodeHeight * 2) + 90; // 90px for divider, spacing, and bottom item padding\n\n  // Calculate scale factor\n  let scaleFactor = 1.0;\n  if (availableHeight < requiredHeight) {\n    scaleFactor = Math.max(0.75, availableHeight / requiredHeight); // Don't scale below 75%\n  }\n\n  // Apply scaling with constraints\n  function scaleValue(config) {\n    const scaled = Math.round(config.default * scaleFactor);\n    return Math.max(config.min, Math.min(config.max, scaled));\n  }\n\n  // Set CSS custom properties\n  timelineEl.style.setProperty('--timeline-h-node-width', scaleValue(constraints.nodeWidth) + 'px');\n  timelineEl.style.setProperty('--timeline-h-node-min-height', scaleValue(constraints.nodeMinHeight) + 'px');\n  timelineEl.style.setProperty('--timeline-h-image-size', scaleValue(constraints.imageSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-title-font-size', scaleValue(constraints.titleFontSize) + 'px');\n  timelineEl.style.setProperty('--timeline-h-text-font-size', scaleValue(constraints.textFontSize) + 'px');\n}\n\nfunction ensureInlineModalData(itemEl) {\n  if (!itemEl) return;\n  const content = itemEl.querySelector('.timeline__content') || itemEl;\n  if (!itemEl.hasAttribute('data-modal-title')) {\n    const heading = content.querySelector('h1,h2,h3,h4,h5,h6');\n    if (heading && heading.textContent) {\n      itemEl.setAttribute('data-modal-title', heading.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-content')) {\n    const firstP = content.querySelector('p');\n    if (firstP && firstP.textContent) {\n      itemEl.setAttribute('data-modal-content', firstP.textContent.trim());\n    }\n  }\n  if (!itemEl.hasAttribute('data-modal-image')) {\n    const img = content.querySelector('img');\n    if (img && img.getAttribute('src')) {\n      itemEl.setAttribute('data-modal-image', img.getAttribute('src'));\n    }\n  }\n}\n\nfunction enhanceInlineItems(timelineEl, items) {\n  if (!items || !items.length) return;\n  items.forEach(function(item){\n    if (item.getAttribute('data-modal-bound') === '1') return;\n    ensureInlineModalData(item);\n    const hasModal = item.hasAttribute('data-modal-title') || item.hasAttribute('data-modal-content') || item.hasAttribute('data-modal-image') || item.hasAttribute('data-modal-html');\n    if (hasModal) {\n      item.addEventListener('click', function(e){\n        e.preventDefault();\n        openTimelineModal(item);\n      });\n      item.setAttribute('data-modal-bound', '1');\n    }\n  });\n}\n\nfunction createArrowSVG(direction, color) {\n  if (direction === 'left') {\n    return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6.8 1L1 7l5.8 6\"/></svg>';\n  }\n  return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"7.8\" height=\"14\" style=\"display:block;margin:auto;\"><path fill=\"none\" stroke=\"' + color + '\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M1 1l5.8 6L1 13\"/></svg>';\n}\n\nfunction clampInt(value, min, max) {\n  const n = parseInt(value, 10);\n  if (Number.isNaN(n)) return min;\n  return Math.max(min, Math.min(max, n));\n}\n\nfunction shouldUpdateDeepLinkForTimeline(timelineEl) {\n  if (typeof window === 'undefined' || !window.location) return false;\n  const params = new URLSearchParams(window.location.search);\n  if (!params.has('id')) return false;\n  const timelineParam = params.get('timeline');\n  // If a specific timeline is deep-linked, only update URL for that one.\n  if (timelineParam && timelineEl && timelineEl.id) {\n    return timelineParam === timelineEl.id;\n  }\n  // If no timeline param provided, treat as generic deep link.\n  return true;\n}\n\nfunction updateDeepLinkUrl(timelineEl, nodeId) {\n  if (!timelineEl || !nodeId || typeof window === 'undefined' || !window.history) return;\n  if (!shouldUpdateDeepLinkForTimeline(timelineEl)) return;\n  const url = new URL(window.location.href);\n  const params = url.searchParams;\n  if (timelineEl.id) {\n    params.set('timeline', timelineEl.id);\n  }\n  params.set('id', String(nodeId));\n  url.search = params.toString();\n  window.history.replaceState({}, '', url.toString());\n}\n\nexport function timeline(collection, options) {\n  const timelines = [];\n  const warningLabel = 'Timeline:';\n  let winWidth = window.innerWidth;\n  let resizeTimer;\n  let currentIndex = 0;\n  const eventListeners = new Map(); // Track listeners for cleanup\n\n  const defaultSettings = {\n    minWidth: { type: 'integer', defaultValue: 600 },\n    maxWidth: { type: 'integer', defaultValue: 600 },\n    horizontalStartPosition: { type: 'string', acceptedValues: ['bottom', 'top'], defaultValue: 'top' },\n    mode: { type: 'string', acceptedValues: ['horizontal', 'vertical'], defaultValue: 'vertical' },\n    moveItems: { type: 'integer', defaultValue: 1 },\n    rtlMode: { type: 'boolean', acceptedValues: [true, false], defaultValue: false },\n    startIndex: { type: 'integer', defaultValue: 0 },\n    verticalStartPosition: { type: 'string', acceptedValues: ['left', 'right'], defaultValue: 'left' },\n    verticalTrigger: { type: 'string', defaultValue: '15%' },\n    /* visibleItems is deprecated and ignored; visible count is computed at runtime */\n  };\n\n  function testValues(value, settingName) {\n    if (typeof value !== 'number' && value % 1 !== 0) {\n      console.warn(`${warningLabel} The value \"${value}\" entered for the setting \"${settingName}\" is not an integer.`);\n      return false;\n    }\n    return true;\n  }\n\n  function itemWrap(el, wrapper, classes) {\n    wrapper.classList.add(classes);\n    el.parentNode.insertBefore(wrapper, el);\n    wrapper.appendChild(el);\n  }\n\n  function wrapElements(items) {\n    items.forEach((item) => {\n      itemWrap(item.querySelector('.timeline__content'), document.createElement('div'), 'timeline__content__wrap');\n      itemWrap(item.querySelector('.timeline__content__wrap'), document.createElement('div'), 'timeline__item__inner');\n    });\n  }\n\n  function isElementInViewport(el, triggerPosition) {\n    const rect = el.getBoundingClientRect();\n    const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    let triggerUnit = triggerPosition.unit;\n    let triggerValue = triggerPosition.value;\n    let trigger = windowHeight;\n    if (triggerUnit === 'px' && triggerValue >= windowHeight) {\n      console.warn('The value entered for the setting \"verticalTrigger\" is larger than the window height. The default value will be used instead.');\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n    if (triggerUnit === 'px') {\n      trigger = parseInt(trigger - triggerValue, 10);\n    } else if (triggerUnit === '%') {\n      trigger = parseInt(trigger * ((100 - triggerValue) / 100), 10);\n    }\n    return (\n      rect.top <= trigger &&\n      rect.left <= (window.innerWidth || document.documentElement.clientWidth) &&\n      (rect.top + rect.height) >= 0 &&\n      (rect.left + rect.width) >= 0\n    );\n  }\n\n  function addTransforms(el, transform) {\n    el.style.webkitTransform = transform;\n    el.style.msTransform = transform;\n    el.style.transform = transform;\n  }\n\n  function createTimelines(timelineEl) {\n    const timelineName = timelineEl.id ? `#${timelineEl.id}` : `.${timelineEl.className}`;\n    const errorPart = 'could not be found as a direct descendant of';\n    const data = timelineEl.dataset;\n    let wrap;\n    let scroller;\n    let items;\n    const settings = {};\n\n    try {\n      wrap = timelineEl.querySelector('.timeline__wrap');\n      if (!wrap) {\n        throw new Error(`${warningLabel} .timeline__wrap ${errorPart} ${timelineName}`);\n      } else {\n        scroller = wrap.querySelector('.timeline__items');\n        if (!scroller) {\n          throw new Error(`${warningLabel} .timeline__items ${errorPart} .timeline__wrap`);\n        } else {\n          items = [].slice.call(scroller.children, 0);\n        }\n      }\n    } catch (e) {\n      console.warn(e.message);\n      showTimelineError(timelineEl, 'missing-element', e.message);\n      return false;\n    }\n\n    Object.keys(defaultSettings).forEach((key) => {\n      settings[key] = defaultSettings[key].defaultValue;\n\n      \n\n      if (key === 'minWidth') {\n        let candidate = undefined;\n        if (data.minWidth !== undefined) candidate = data.minWidth;\n        if (data.minwidth !== undefined) candidate = data.minwidth;\n        if (data.forceVerticalMode !== undefined) candidate = data.forceVerticalMode;\n        if (data.forceverticalmode !== undefined) candidate = data.forceverticalmode;\n        if (candidate === undefined && options) {\n          if (options.minWidth !== undefined) candidate = options.minWidth;\n          else if (options.forceVerticalMode !== undefined) candidate = options.forceVerticalMode;\n        }\n        if (candidate !== undefined) settings.minWidth = candidate;\n      } else if (key === 'maxWidth') {\n        let candidate = undefined;\n        if (data.maxWidth !== undefined) candidate = data.maxWidth;\n        if (data.maxwidth !== undefined) candidate = data.maxwidth;\n        if (candidate === undefined && options) {\n          if (options.maxWidth !== undefined) candidate = options.maxWidth;\n        }\n        if (candidate !== undefined) settings.maxWidth = candidate;\n      } else {\n        if (data[key]) {\n          settings[key] = data[key];\n        } else if (options && options[key] !== undefined) {\n          settings[key] = options[key];\n        }\n      }\n\n      if (defaultSettings[key].type === 'integer') {\n        if (!settings[key] || !testValues(settings[key], key)) {\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      } else if (defaultSettings[key].type === 'string') {\n        if (defaultSettings[key].acceptedValues && defaultSettings[key].acceptedValues.indexOf(settings[key]) === -1) {\n          console.warn(`${warningLabel} The value \"${settings[key]}\" entered for the setting \"${key}\" was not recognised.`);\n          settings[key] = defaultSettings[key].defaultValue;\n        }\n      }\n    });\n\n    (function applyColorParity(){\n      const data = timelineEl.dataset;\n      const getData = function(k){\n        return data[k] !== undefined ? data[k] : (data[k && k.toLowerCase()] !== undefined ? data[k.toLowerCase()] : undefined);\n      };\n      let nodeColor = getData('nodeColor');\n      let lineColor = getData('lineColor');\n      let navColor = getData('navColor');\n      if (options) {\n        if (options.nodeColor !== undefined) nodeColor = options.nodeColor;\n        if (options.lineColor !== undefined) lineColor = options.lineColor;\n        if (options.navColor !== undefined) navColor = options.navColor;\n      }\n      if (nodeColor || lineColor || navColor) {\n        applyTimelineColors(timelineEl, { nodeColor, lineColor, navColor });\n      }\n    })();\n\n    const defaultTrigger = defaultSettings.verticalTrigger.defaultValue.match(/(\\d*\\.?\\d*)(.*)/);\n    const triggerArray = settings.verticalTrigger.match(/(\\d*\\.?\\d*)(.*)/);\n    let [, triggerValue, triggerUnit] = triggerArray;\n    let triggerValid = true;\n    if (!triggerValue) {\n      console.warn(`${warningLabel} No numercial value entered for the 'verticalTrigger' setting.`);\n      triggerValid = false;\n    }\n    if (triggerUnit !== 'px' && triggerUnit !== '%') {\n      console.warn(`${warningLabel} The setting 'verticalTrigger' must be a percentage or pixel value.`);\n      triggerValid = false;\n    }\n    if (triggerUnit === '%' && (triggerValue > 100 || triggerValue < 0)) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be between 0 and 100 if using a percentage value.`);\n      triggerValid = false;\n    } else if (triggerUnit === 'px' && triggerValue < 0) {\n      console.warn(`${warningLabel} The 'verticalTrigger' setting value must be above 0 if using a pixel value.`);\n      triggerValid = false;\n    }\n\n    if (triggerValid === false) {\n      [, triggerValue, triggerUnit] = defaultTrigger;\n    }\n\n    settings.verticalTrigger = {\n      unit: triggerUnit,\n      value: triggerValue\n    };\n\n    // Sanity-check moveItems: cap to total items if it's larger than available\n    if (settings.moveItems > items.length) {\n      console.warn(`${warningLabel} The value of \"moveItems\" (${settings.moveItems}) is larger than the total number of items (${items.length}). It has been reduced to ${items.length}.`);\n      settings.moveItems = items.length;\n    }\n\n    // Sanity-check startIndex: ensure it's within 0..items.length-1\n    if (settings.startIndex < 0) {\n      console.warn(`${warningLabel} The 'startIndex' setting must be >= 0. The value of 0 has been used instead.`);\n      settings.startIndex = 0;\n    } else if (settings.startIndex > Math.max(0, items.length - 1)) {\n      console.warn(`${warningLabel} The 'startIndex' setting is larger than the last index for this timeline. It has been reduced to ${Math.max(0, items.length - 1)}.`);\n      settings.startIndex = Math.max(0, items.length - 1);\n    }\n\n    enhanceInlineItems(timelineEl, items);\n\n    if (!timelineEl.id) {\n      timelineEl.setAttribute('data-timeline-id', 'timeline-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9));\n    }\n\n    timelines.push({\n      timelineEl,\n      wrap,\n      scroller,\n      items,\n      settings,\n      listeners: [] // Store listeners for cleanup\n    });\n  }\n\n  if (collection.length) {\n    Array.from(collection).forEach(createTimelines);\n  }\n\n  function setHeightandWidths(tl) {\n    function setWidths() {\n      // Get the current scaled node width from CSS variable\n      const computedStyle = getComputedStyle(tl.timelineEl);\n      const nodeWidth = parseInt(computedStyle.getPropertyValue('--timeline-h-node-width')) || 200;\n      tl.itemWidth = nodeWidth;\n      tl.items.forEach((item) => {\n        item.style.width = `${tl.itemWidth}px`;\n      });\n      tl.scrollerWidth = tl.itemWidth * tl.items.length;\n      tl.scroller.style.width = `${tl.scrollerWidth}px`;\n    }\n\n    function setHeights() {\n      let oddIndexTallest = 0;\n      let evenIndexTallest = 0;\n      tl.items.forEach((item, i) => {\n        item.style.height = 'auto';\n        const height = item.offsetHeight;\n        if (i % 2 === 0) {\n          evenIndexTallest = height > evenIndexTallest ? height : evenIndexTallest;\n        } else {\n          oddIndexTallest = height > oddIndexTallest ? height : oddIndexTallest;\n        }\n      });\n\n      const transformString = `translateY(${evenIndexTallest}px)`;\n      tl.items.forEach((item, i) => {\n        if (i % 2 === 0) {\n          item.style.height = `${evenIndexTallest}px`;\n          if (tl.settings.horizontalStartPosition === 'bottom') {\n            item.classList.add('timeline__item--bottom');\n            addTransforms(item, transformString);\n          } else {\n            item.classList.add('timeline__item--top');\n          }\n        } else {\n          item.style.height = `${oddIndexTallest}px`;\n          if (tl.settings.horizontalStartPosition !== 'bottom') {\n            item.classList.add('timeline__item--bottom');\n            addTransforms(item, transformString);\n          } else {\n            item.classList.add('timeline__item--top');\n          }\n        }\n      });\n      // Store heights for use in divider and arrow positioning  \n      tl.evenIndexTallest = evenIndexTallest;\n      tl.oddIndexTallest = oddIndexTallest;\n      // Set scroller height (no extra padding - use original calculation)\n      tl.scroller.style.height = `${evenIndexTallest + oddIndexTallest}px`;\n      // Compute how many items fit in the viewport for this timeline\n      try {\n        tl.computedVisibleCount = Math.floor(tl.wrap.offsetWidth / tl.itemWidth) || 1;\n      } catch (e) {\n        tl.computedVisibleCount = 1;\n      }\n    }\n\n    if (window.innerWidth > tl.settings.minWidth) {\n      setWidths();\n      setHeights();\n    }\n  }\n\n  function addNavigation(tl) {\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n\n    if (tl.items.length > itemsVisible) {\n      const prevArrow = document.createElement('button');\n      const nextArrow = document.createElement('button');\n      // Use the same calculation as the original: first item's offsetHeight\n      const topPosition = tl.items[0].offsetHeight;\n      prevArrow.className = 'timeline-nav-button timeline-nav-button--prev';\n      nextArrow.className = 'timeline-nav-button timeline-nav-button--next';\n      prevArrow.textContent = 'Previous';\n      prevArrow.title = 'Go to previous items';\n      nextArrow.textContent = 'Next';\n      nextArrow.title = 'Go to next items';\n      prevArrow.style.top = `${topPosition}px`;\n      nextArrow.style.top = `${topPosition}px`;\n\n      const arrowColor = tl.timelineEl.getAttribute('data-arrow-color') || '#333';\n      prevArrow.innerHTML = createArrowSVG('left', arrowColor);\n      nextArrow.innerHTML = createArrowSVG('right', arrowColor);\n\n      const maxActiveIndex = Math.max(0, tl.items.length - 1);\n      if (tl.activeIndex <= 0) {\n        prevArrow.classList.add('timeline-nav-button--at-start');\n        prevArrow.title = 'Already at beginning of timeline';\n      }\n      if (tl.activeIndex >= maxActiveIndex) {\n        nextArrow.classList.add('timeline-nav-button--at-end');\n        nextArrow.title = 'Already at end of timeline';\n      }\n      tl.timelineEl.appendChild(prevArrow);\n      tl.timelineEl.appendChild(nextArrow);\n    }\n  }\n\n  function addHorizontalDivider(tl) {\n    const divider = tl.timelineEl.querySelector('.timeline-divider');\n    if (divider) {\n      tl.timelineEl.removeChild(divider);\n    }\n    // Use the same calculation as the original: first item's offsetHeight\n    const topPosition = tl.items[0].offsetHeight;\n    const horizontalDivider = document.createElement('span');\n    horizontalDivider.className = 'timeline-divider';\n    horizontalDivider.style.top = `${topPosition}px`;\n    tl.timelineEl.appendChild(horizontalDivider);\n  }\n\n  function timelinePosition(tl, index) {\n    const safeIndex = clampInt(index, 0, Math.max(0, tl.items.length - 1));\n    const position = tl.items[safeIndex].offsetLeft;\n    const str = `translate3d(-${position}px, 0, 0)`;\n    addTransforms(tl.scroller, str);\n  }\n\n  function updateActiveItem(tl, index) {\n    // Remove active class from all items\n    tl.items.forEach(item => item.classList.remove('timeline__item--active'));\n    // Add active class to current item\n    if (tl.items[index]) {\n      tl.items[index].classList.add('timeline__item--active');\n    }\n  }\n\n  function slideTimeline(tl) {\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n    const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n\n    const viewportWidth = tl.wrap.offsetWidth;\n    const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n    const maxScrollIndex = Math.max(0, tl.items.length - itemsVisible);\n\n    const moveItems = parseInt(tl.settings.moveItems, 10);\n    \n    const handleArrowClick = function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n\n      // If at bounds, show tooltip message and return (no-op)\n      if (this.classList.contains('timeline-nav-button--at-start') || this.classList.contains('timeline-nav-button--at-end')) {\n        return;\n      }\n\n      const direction = this.classList.contains('timeline-nav-button--next') ? 1 : -1;\n      const maxActiveIndex = Math.max(0, tl.items.length - 1);\n      const nextActive = clampInt(tl.activeIndex + (direction * moveItems), 0, maxActiveIndex);\n\n      // Scroll position clamps to the last scrollable index, but active highlight can continue.\n      currentIndex = clampInt(nextActive, 0, maxScrollIndex);\n      tl.activeIndex = nextActive;\n\n      // Update arrows based on ACTIVE index (linear user expectation)\n      if (tl.activeIndex <= 0) {\n        arrowPrev.classList.add('timeline-nav-button--at-start');\n        arrowPrev.title = 'Already at beginning of timeline';\n      } else {\n        arrowPrev.classList.remove('timeline-nav-button--at-start');\n        arrowPrev.title = 'Go to previous items';\n      }\n      if (tl.activeIndex >= maxActiveIndex) {\n        arrowNext.classList.add('timeline-nav-button--at-end');\n        arrowNext.title = 'Already at end of timeline';\n      } else {\n        arrowNext.classList.remove('timeline-nav-button--at-end');\n        arrowNext.title = 'Go to next items';\n      }\n\n      timelinePosition(tl, currentIndex);\n      updateActiveItem(tl, tl.activeIndex);\n\n      const activeItem = tl.items[tl.activeIndex];\n      const nodeId = activeItem && activeItem.getAttribute('data-node-id');\n      if (nodeId) updateDeepLinkUrl(tl.timelineEl, nodeId);\n      // Remove focus from button to avoid keyboard navigation side effects\n      this.blur();\n    };\n    \n    Array.from(navArrows).forEach((arrow) => {\n      arrow.addEventListener('click', handleArrowClick);\n      tl.listeners.push({ element: arrow, type: 'click', handler: handleArrowClick });\n    });\n  }\n\n  function setUpHorinzontalTimeline(tl) {\n    tl.timelineEl.classList.add('timeline--horizontal');\n    // Calculate responsive scaling before layout calculations\n    calculateHorizontalScale(tl.timelineEl);\n    setHeightandWidths(tl);\n\n    // Compute how many items fit in the viewport for this timeline\n    const itemsVisible = Math.floor(tl.wrap.offsetWidth / tl.itemWidth) || 1;\n    tl.computedVisibleCount = itemsVisible;\n\n    if (tl.settings.rtlMode) {\n      currentIndex = tl.items.length > itemsVisible ? tl.items.length - itemsVisible : 0;\n    } else {\n      currentIndex = tl.settings.startIndex;\n    }\n\n    // Track the \"active\" item separately from the scroll position.\n    // Usually these are the same, but they can diverge near the end (e.g. last item).\n    tl.activeIndex = currentIndex;\n\n    timelinePosition(tl, currentIndex);\n    updateActiveItem(tl, tl.activeIndex);\n    addNavigation(tl);\n    addHorizontalDivider(tl);\n    slideTimeline(tl);\n\n    const timelineId = tl.timelineEl.id || tl.timelineEl.getAttribute('data-timeline-id');\n    if (timelineId) {\n      timelineRegistry[timelineId] = {\n        setCurrentIndex: function(index) {\n          const viewportWidth = tl.wrap.offsetWidth;\n          const itemsVisible = Math.floor(viewportWidth / tl.itemWidth);\n          const maxScrollIndex = Math.max(0, tl.items.length - itemsVisible);\n          // Scroll position clamps to maxIndex, but the active highlight can be the actual requested item.\n          tl.activeIndex = Math.max(0, Math.min(index, tl.items.length - 1));\n          currentIndex = Math.max(0, Math.min(index, maxScrollIndex));\n        },\n        updatePosition: function() {\n          timelinePosition(tl, currentIndex);\n          updateActiveItem(tl, tl.activeIndex);\n          const arrowPrev = tl.timelineEl.querySelector('.timeline-nav-button--prev');\n          const arrowNext = tl.timelineEl.querySelector('.timeline-nav-button--next');\n          if (arrowPrev && arrowNext) {\n            const maxActiveIndex = Math.max(0, tl.items.length - 1);\n            // Use classes instead of disabled attribute to avoid focus issues\n            if (tl.activeIndex <= 0) {\n              arrowPrev.classList.add('timeline-nav-button--at-start');\n              arrowPrev.title = 'Already at beginning of timeline';\n            } else {\n              arrowPrev.classList.remove('timeline-nav-button--at-start');\n              arrowPrev.title = 'Go to previous items';\n            }\n            if (tl.activeIndex >= maxActiveIndex) {\n              arrowNext.classList.add('timeline-nav-button--at-end');\n              arrowNext.title = 'Already at end of timeline';\n            } else {\n              arrowNext.classList.remove('timeline-nav-button--at-end');\n              arrowNext.title = 'Go to next items';\n            }\n          }\n\n          const activeItem = tl.items[tl.activeIndex];\n          const nodeId = activeItem && activeItem.getAttribute('data-node-id');\n          if (nodeId) updateDeepLinkUrl(tl.timelineEl, nodeId);\n        }\n      };\n\n      // Clicking an item (dot or card) should also make it the current/active node.\n      // This runs alongside modal opening.\n      const tlData = timelineRegistry[timelineId];\n      tl.items.forEach((item, idx) => {\n        const activateHandler = () => {\n          if (!tl.timelineEl.classList.contains('timeline--horizontal')) return;\n          if (tlData && tlData.setCurrentIndex && tlData.updatePosition) {\n            tlData.setCurrentIndex(idx);\n            tlData.updatePosition();\n          }\n        };\n        item.addEventListener('click', activateHandler);\n        tl.listeners.push({ element: item, type: 'click', handler: activateHandler });\n      });\n    }\n  }\n\n  function setUpVerticalTimeline(tl) {\n    let lastVisibleIndex = 0;\n    tl.items.forEach((item, i) => {\n      item.classList.remove('animated', 'fadeIn');\n      if (!isElementInViewport(item, tl.settings.verticalTrigger) && i > 0) {\n        item.classList.add('animated');\n      } else {\n        lastVisibleIndex = i;\n      }\n      const divider = tl.settings.verticalStartPosition === 'left' ? 1 : 0;\n      if (i % 2 === divider && window.innerWidth > tl.settings.minWidth) {\n        item.classList.add('timeline__item--right');\n      } else {\n        item.classList.add('timeline__item--left');\n      }\n    });\n    for (let i = 0; i < lastVisibleIndex; i += 1) {\n      tl.items[i].classList.remove('animated', 'fadeIn');\n    }\n    \n    // Use IntersectionObserver instead of scroll listener for better performance\n    if ('IntersectionObserver' in window) {\n      const observerOptions = {\n        rootMargin: tl.settings.verticalTrigger.unit === '%' \n          ? `${tl.settings.verticalTrigger.value}%` \n          : `${tl.settings.verticalTrigger.value}px`,\n        threshold: 0.01\n      };\n      \n      const observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            entry.target.classList.add('fadeIn');\n          }\n        });\n      }, observerOptions);\n      \n      tl.items.forEach((item) => {\n        if (item.classList.contains('animated')) {\n          observer.observe(item);\n        }\n      });\n      \n      // Store observer for cleanup\n      tl.observer = observer;\n    } else {\n      // Fallback for older browsers (though we're targeting 2018+)\n      const scrollHandler = () => {\n        tl.items.forEach((item) => {\n          if (isElementInViewport(item, tl.settings.verticalTrigger)) {\n            item.classList.add('fadeIn');\n          }\n        });\n      };\n      window.addEventListener('scroll', scrollHandler);\n      tl.listeners.push({ element: window, type: 'scroll', handler: scrollHandler });\n    }\n  }\n\n  function resetTimelines(tl) {\n    // Clean up event listeners\n    if (tl.listeners && tl.listeners.length > 0) {\n      tl.listeners.forEach(({ element, type, handler }) => {\n        element.removeEventListener(type, handler);\n      });\n      tl.listeners = [];\n    }\n    \n    // Clean up IntersectionObserver\n    if (tl.observer) {\n      tl.observer.disconnect();\n      tl.observer = null;\n    }\n    \n    tl.timelineEl.classList.remove('timeline--horizontal', 'timeline--mobile');\n    tl.scroller.removeAttribute('style');\n    tl.items.forEach((item) => {\n      item.removeAttribute('style');\n      item.classList.remove('animated', 'fadeIn', 'timeline__item--left', 'timeline__item--right');\n    });\n    const navArrows = tl.timelineEl.querySelectorAll('.timeline-nav-button');\n    Array.from(navArrows).forEach((arrow) => {\n      arrow.parentNode.removeChild(arrow);\n    });\n  }\n\n  function setUpTimelines() {\n    timelines.forEach((tl) => {\n      tl.timelineEl.style.opacity = 0;\n      if (!tl.timelineEl.classList.contains('timeline--loaded')) {\n        wrapElements(tl.items);\n      }\n      resetTimelines(tl);\n      if (window.innerWidth <= tl.settings.minWidth) {\n        tl.timelineEl.classList.add('timeline--mobile');\n      }\n      \n      // Determine which mode to use based on settings and viewport width\n      let useHorizontalMode = false;\n      if (tl.settings.mode === 'horizontal' && window.innerWidth > tl.settings.minWidth) {\n        useHorizontalMode = true;\n      } else if (tl.settings.mode === 'vertical' && window.innerWidth > tl.settings.maxWidth) {\n        useHorizontalMode = true;\n      }\n      \n      if (useHorizontalMode) {\n        setUpHorinzontalTimeline(tl);\n      } else {\n        setUpVerticalTimeline(tl);\n      }\n      tl.timelineEl.classList.add('timeline--loaded');\n    });\n\n    setTimeout(() => {\n      timelines.forEach((tl) => {\n        tl.timelineEl.style.opacity = 1;\n      });\n    }, 500);\n  }\n\n  try {\n    setUpTimelines();\n\n    window.addEventListener('resize', () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        const newWinWidth = window.innerWidth;\n        if (newWinWidth !== winWidth) {\n          setUpTimelines();\n          winWidth = newWinWidth;\n        }\n      }, 250);\n    });\n  } catch (e) {\n    console.error('Timeline initialization failed:', e);\n  }\n}","import { timelineBasePath } from '../shared/config.js';\nimport { showTimelineError } from './error-ui.js';\nimport { applyTimelineColors } from './colors.js';\nimport { handleDeepLinking } from './deep-linking.js';\nimport { timeline } from '../core/timeline-engine.js';\nimport { LOREM_PARAGRAPH, LOREM_FULL } from '../shared/lipsum.js';\n\n/**\n * Normalize item data to standard 5-field schema\n * Fields: date, heading, summary, content (HTML), image\n */\nfunction normalizeItemData(rawData) {\n  const normalized = {\n    id: rawData.id || null,\n    date: rawData.date || 'DD/MM/YYYY',\n    heading: rawData.heading || 'Node Title',\n    summary: rawData.summary || LOREM_PARAGRAPH,\n    content: rawData.content || LOREM_FULL,\n    image: rawData.image || null\n  };\n  \n  return normalized;\n}\n\n/**\n * Sanitize HTML content - remove potentially problematic tags\n * Allow: p, strong, em, u, a, ul, ol, li, br, blockquote\n * Strip: script, iframe, form, input, h1, h2\n */\nfunction sanitizeContent(html) {\n  if (!html) return '';\n  \n  let clean = html;\n  \n  // Remove script tags and content\n  clean = clean.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '');\n  \n  // Remove form tags and content\n  clean = clean.replace(/<form[^>]*>[\\s\\S]*?<\\/form>/gi, '');\n  \n  // Remove input tags\n  clean = clean.replace(/<input[^>]*>/gi, '');\n  \n  // Remove h1 tags (replace with h3)\n  clean = clean.replace(/<h1/gi, '<h3');\n  clean = clean.replace(/<\\/h1>/gi, '</h3>');\n  \n  // Remove h2 tags (replace with h3)\n  clean = clean.replace(/<h2/gi, '<h3');\n  clean = clean.replace(/<\\/h2>/gi, '</h3>');\n  \n  return clean.trim();\n}\n\n/**\n * Create DOM node from normalized item data\n */\nfunction createItemNode(item) {\n  const normalized = normalizeItemData(item);\n  \n  const itemEl = document.createElement('div');\n  itemEl.className = 'timeline__item';\n  \n  if (normalized.id) {\n    itemEl.setAttribute('data-node-id', normalized.id);\n  }\n\n  // Timeline content (visible in node)\n  const content = document.createElement('div');\n  content.className = 'timeline__content';\n\n  // Date\n  const dateEl = document.createElement('div');\n  dateEl.className = 'timeline__date';\n  dateEl.textContent = normalized.date;\n  content.appendChild(dateEl);\n\n  // Image (optional)\n  if (normalized.image) {\n    const img = document.createElement('img');\n    img.src = normalized.image;\n    img.className = 'timeline__image';\n    img.alt = normalized.heading || 'Timeline image';\n    img.loading = 'lazy';\n    img.onerror = function() {\n      console.error('Timeline: Image failed to load:', normalized.image);\n      this.src = timelineBasePath + '/missing-image.svg';\n      this.alt = 'Image not found';\n    };\n    content.appendChild(img);\n  }\n\n  // Heading\n  const headingEl = document.createElement('h3');\n  headingEl.className = 'timeline__heading';\n  headingEl.textContent = normalized.heading;\n  content.appendChild(headingEl);\n\n  // Summary (truncated by CSS)\n  const summaryEl = document.createElement('div');\n  summaryEl.className = 'timeline__summary';\n  summaryEl.textContent = normalized.summary;\n  content.appendChild(summaryEl);\n\n  itemEl.appendChild(content);\n\n  // Modal content (hidden by default, shown in popup)\n  const modalContent = document.createElement('div');\n  modalContent.className = 'timeline__modal-content';\n  const contentFull = document.createElement('div');\n  contentFull.className = 'timeline__content-full';\n  contentFull.innerHTML = sanitizeContent(normalized.content);\n  modalContent.appendChild(contentFull);\n  itemEl.appendChild(modalContent);\n\n  // Click handler to open modal\n  itemEl.addEventListener('click', function(e) {\n    e.preventDefault();\n    if (typeof window.openTimelineModal === 'function') {\n      window.openTimelineModal(itemEl);\n    }\n  });\n\n  return itemEl;\n}\n\n/**\n * Apply configuration as data attributes\n */\nfunction applyDataAttributes(container, config) {\n  if (config.layoutMode) {\n    container.setAttribute('data-mode', config.layoutMode);\n  }\n  if (config.moveItems !== undefined) {\n    container.setAttribute('data-move-items', config.moveItems);\n  }\n  if (config.minWidth !== undefined) {\n    container.setAttribute('data-min-width', config.minWidth);\n  }\n  if (config.maxWidth !== undefined) {\n    container.setAttribute('data-max-width', config.maxWidth);\n  }\n  /* Additional mappings so JSON config becomes authoritative (JSON > JS > HTML)\n     These attributes are the keys the timeline engine reads from dataset. */\n  if (config.startIndex !== undefined) {\n    container.setAttribute('data-start-index', config.startIndex);\n  }\n  if (config.horizontalStartPosition !== undefined) {\n    container.setAttribute('data-horizontal-start-position', config.horizontalStartPosition);\n  }\n  if (config.verticalStartPosition !== undefined) {\n    container.setAttribute('data-vertical-start-position', config.verticalStartPosition);\n  }\n  if (config.verticalTrigger !== undefined) {\n    container.setAttribute('data-vertical-trigger', config.verticalTrigger);\n  }\n  if (config.rtlMode !== undefined) {\n    container.setAttribute('data-rtl-mode', String(config.rtlMode));\n  }\n  if (config.nodeColor !== undefined) {\n    container.setAttribute('data-node-color', config.nodeColor);\n  }\n  if (config.lineColor !== undefined) {\n    container.setAttribute('data-line-color', config.lineColor);\n  }\n  if (config.navColor !== undefined) {\n    container.setAttribute('data-nav-color', config.navColor);\n  }\n}\n\n/**\n * Render timeline from data array\n */\nexport function renderTimelineFromData(containerSelector, data, config) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    return null;\n  }\n\n  // Remove any previous error state\n  container.classList.remove('timeline--error');\n\n  // Get or create timeline structure\n  let itemsWrap = container.querySelector('.timeline__items');\n  if (!itemsWrap) {\n    const wrap = document.createElement('div');\n    wrap.className = 'timeline__wrap';\n    itemsWrap = document.createElement('div');\n    itemsWrap.className = 'timeline__items';\n    wrap.appendChild(itemsWrap);\n    container.appendChild(wrap);\n  } else {\n    itemsWrap.innerHTML = '';\n  }\n\n  // Apply configuration\n  if (config) {\n    applyDataAttributes(container, config);\n    applyTimelineColors(container, config);\n\n    // Add timeline heading if provided\n    if (config.timelineName && config.timelineName.trim() !== '') {\n      const existingHeading = container.previousElementSibling;\n      if (existingHeading && existingHeading.classList.contains('timeline__title')) {\n        existingHeading.textContent = config.timelineName;\n      } else {\n        const heading = document.createElement('h1');\n        heading.className = 'timeline__title';\n        heading.textContent = config.timelineName;\n        container.parentNode.insertBefore(heading, container);\n      }\n      container.setAttribute('data-timeline-name', config.timelineName);\n    }\n  }\n\n  // Create timeline items from data\n  if (!Array.isArray(data) || data.length === 0) {\n    showTimelineError(container, 'no-data', 'No timeline items provided');\n    return null;\n  }\n\n  data.forEach(function(item) {\n    itemsWrap.appendChild(createItemNode(item));\n  });\n\n  return container;\n}\n\n/**\n * Initialize timeline from provided data\n */\nexport function timelineFromData(containerSelector, data, options) {\n  const container = renderTimelineFromData(containerSelector, data, options);\n  if (!container) return;\n  // Wait for images to settle before running layout to avoid height miscalculations\n  waitForImages(container).then(() => {\n    timeline([container], options || {});\n  });\n}\n\n/**\n * Load timeline data from JSON file and initialize\n */\nexport function loadDataFromJson(url, containerSelector) {\n  const container = document.querySelector(containerSelector);\n  if (!container) {\n    console.error('Timeline: Container not found:', containerSelector);\n    showTimelineError(null, 'missing-element', 'Timeline container not found: ' + containerSelector);\n    return;\n  }\n\n  // Check cache first\n  const cacheKey = 'timeline_cache_' + url;\n  let cachedData = null;\n  let cachedTime = null;\n\n  if (typeof(Storage) !== 'undefined') {\n    try {\n      const cached = localStorage.getItem(cacheKey);\n      if (cached) {\n        const parsedCache = JSON.parse(cached);\n        cachedData = parsedCache.data;\n        cachedTime = parsedCache.timestamp;\n      }\n    } catch (e) {\n      console.warn('Timeline: Failed to parse cached data');\n    }\n  }\n\n  // Fetch JSON\n  fetch(url)\n    .then(response => {\n      if (!response.ok) throw new Error('Failed to load: ' + response.statusText);\n      return response.json();\n    })\n    .then(jsonData => {\n      // Check if we need to update cache\n      const needsUpdate = !cachedData || \n        !jsonData.lastupdated || \n        new Date(jsonData.lastupdated) > new Date(cachedTime);\n\n      if (needsUpdate && jsonData.nodes && typeof(Storage) !== 'undefined') {\n        try {\n          localStorage.setItem(cacheKey, JSON.stringify({\n            data: jsonData.nodes,\n            timestamp: jsonData.lastupdated || new Date().toISOString()\n          }));\n        } catch (e) {\n          console.warn('Timeline: Unable to cache data', e);\n        }\n      }\n\n      const dataToUse = jsonData.nodes || jsonData;\n      const config = Object.assign({}, jsonData);\n      delete config.nodes;\n\n      renderTimelineFromData(containerSelector, dataToUse, config);\n      // Ensure images finish loading before calling the layout engine so heights are correct\n      waitForImages(container).then(() => {\n        timeline([container], {});\n        showTimelineTitle(container);\n        handleDeepLinking();\n      });\n    })\n    .catch(error => {\n      console.error('Timeline: Error loading JSON:', error);\n      \n      // Try to use cached data as fallback\n      if (cachedData && cachedData.length > 0) {\n        console.log('Timeline: Using cached data as fallback');\n        renderTimelineFromData(containerSelector, cachedData, {});\n        waitForImages(container).then(() => {\n          timeline([container], {});\n          showTimelineTitle(container);\n        });\n      } else {\n        showTimelineError(container, 'load-failed', 'Failed to load timeline data: ' + error.message);\n      }\n    });\n}\n\n/**\n * Wait for all images inside a container to either load or error.\n * Resolves immediately if there are no images.\n */\nfunction waitForImages(container) {\n  if (!container) return Promise.resolve();\n  const imgs = Array.from(container.querySelectorAll('img'));\n  if (imgs.length === 0) return Promise.resolve();\n\n  return new Promise((resolve) => {\n    let remaining = imgs.length;\n\n    const checkDone = () => {\n      remaining -= 1;\n      if (remaining <= 0) resolve();\n    };\n\n    imgs.forEach((img) => {\n      if (img.complete) {\n        checkDone();\n      } else {\n        const onSettled = () => {\n          img.removeEventListener('load', onSettled);\n          img.removeEventListener('error', onSettled);\n          checkDone();\n        };\n        img.addEventListener('load', onSettled);\n        img.addEventListener('error', onSettled);\n      }\n    });\n\n    // Fallback safety: resolve after 1s even if some images hang\n    setTimeout(() => resolve(), 1000);\n  });\n}\n\n/**\n * Show the timeline title (previous sibling with .timeline__title class)\n * This is called after the timeline layout is complete to fade it in.\n */\nfunction showTimelineTitle(container) {\n  if (!container) return;\n  const title = container.previousElementSibling;\n  if (title && title.classList.contains('timeline__title')) {\n    // Trigger reflow to ensure transition works\n    title.offsetHeight;\n    title.classList.add('timeline__title--visible');\n  }\n}\n\n/**\n * Clear timeline cache\n */\nexport function clearTimelineCache(url) {\n  if (typeof(Storage) === 'undefined') {\n    console.warn('Timeline: localStorage not supported');\n    return;\n  }\n\n  if (url) {\n    const cacheKey = 'timeline_cache_' + url;\n    localStorage.removeItem(cacheKey);\n    console.log('Timeline: Cleared cache for', url);\n  } else {\n    // Clear all timeline caches\n    const keys = Object.keys(localStorage);\n    let cleared = 0;\n    keys.forEach(key => {\n      if (key.startsWith('timeline_cache_')) {\n        localStorage.removeItem(key);\n        cleared++;\n      }\n    });\n    console.log('Timeline: Cleared', cleared, 'cache(s)');\n  }\n}\n\n/**\n * Process timeline data (alias for renderTimelineFromData for backwards compat)\n */\nexport function processTimelineData(containerSelector, data, config) {\n  return renderTimelineFromData(containerSelector, data, config);\n}\n","/**\n * Lorem Ipsum placeholder text utility\n * Provides reusable placeholder content for timeline nodes\n */\n\n// Full paragraph of Lorem Ipsum\nconst LOREM_PARAGRAPH = 'Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident.';\n\n// Short sentence\nconst LOREM_SHORT = 'Lorem ipsum dolor sit amet, qui minim labore adipisicing minim sint cillum sint consectetur cupidatat.';\n\n// Multiple paragraphs\nconst LOREM_FULL = `<p>Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate.</p><p>Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.</p>`;\n\nexport { LOREM_PARAGRAPH, LOREM_SHORT, LOREM_FULL };\n","// --------------------------------------------------------------------------\r\n// timeline.js - a vanilla JS app to display timelines\r\n// \r\n// Created in 2018 by Mike Collins (https://github.com/squarechip/timeline)\r\n// Modified in 2026 by Ken Dawson (https://github.com/kendawson-online)\r\n// Last updated: 01/08/26\r\n//\r\n// --------------------------------------------------------------------------\r\n\r\nimport { createTimelineModal, openTimelineModal, closeTimelineModal } from './features/modals.js';\r\nimport { handleDeepLinking, navigateToNodeIndex } from './features/deep-linking.js';\r\nimport { renderTimelineFromData, timelineFromData, loadDataFromJson, processTimelineData, clearTimelineCache } from './features/data-loader.js';\r\nimport { timeline } from './core/timeline-engine.js';\r\nimport '../css/timeline.css';\r\n\r\nfunction autoInitJsonTimelines() {\r\n  const timelinesWithJson = document.querySelectorAll('[data-json-config]');\r\n  timelinesWithJson.forEach(function(timelineEl) {\r\n    const jsonUrl = timelineEl.getAttribute('data-json-config');\r\n    if (!jsonUrl) return;\r\n    const className = (timelineEl.className || '').split(' ')[0];\r\n    const selector = timelineEl.id ? '#' + timelineEl.id : (className ? '.' + className : null);\r\n    if (selector) {\r\n      loadDataFromJson(jsonUrl, selector);\r\n    }\r\n  });\r\n}\r\n\r\nfunction exposeGlobals() {\r\n  if (typeof window === 'undefined') return;\r\n  window.timeline = timeline;\r\n  window.timelineFromData = timelineFromData;\r\n  window.renderTimelineFromData = renderTimelineFromData;\r\n  window.processTimelineData = processTimelineData;\r\n  window.loadDataFromJson = loadDataFromJson;\r\n  window.clearTimelineCache = clearTimelineCache;\r\n  window.createTimelineModal = createTimelineModal;\r\n  window.openTimelineModal = openTimelineModal;\r\n  window.closeTimelineModal = closeTimelineModal;\r\n  window.handleTimelineDeepLinking = handleDeepLinking;\r\n  window.navigateTimelineToNodeIndex = navigateToNodeIndex;\r\n}\r\n\r\nexposeGlobals();\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  autoInitJsonTimelines();\r\n});\r\n\r\nif (typeof window !== 'undefined' && window.jQuery) {\r\n  (( $) => {\r\n    $.fn.timeline = function(opts) {\r\n      timeline(this, opts);\r\n      return this;\r\n    };\r\n  })(window.jQuery);\r\n}\r\n\r\nexport {\r\n  timeline,\r\n  timelineFromData,\r\n  renderTimelineFromData,\r\n  loadDataFromJson,\r\n  processTimelineData,\r\n  clearTimelineCache,\r\n  createTimelineModal,\r\n  openTimelineModal,\r\n  closeTimelineModal,\r\n  handleDeepLinking,\r\n  navigateToNodeIndex\r\n};"],"names":["modalState","modal","overlay","timelineRegistry","createTimelineModal","document","createElement","className","addEventListener","closeTimelineModal","innerHTML","closeBtn","querySelector","closeBottomBtn","e","stopPropagation","body","appendChild","key","classList","contains","openTimelineModal","itemEl","title","getAttribute","content","image","html","modalTitle","modalText","modalImage","textContent","src","alt","style","display","replace","setTimeout","add","overflow","remove","handleDeepLinking","containerSelector","urlParams","URLSearchParams","window","location","search","timelineId","get","nodeId","targetContainer","getElementById","console","warn","scrollIntoView","behavior","block","targetNode","querySelectorAll","forEach","n","itemIndex","Array","from","parentNode","children","indexOf","navigateToNodeIndex","container","index","id","tlData","setCurrentIndex","updatePosition","timelineBasePath","TimelineConfig","basePath","scripts","getElementsByTagName","i","length","dir","substring","lastIndexOf","showTimelineError","errorType","details","errorInfo","message","solution","errorDiv","errorIcon","width","height","errorTitle","errorMessage","errorSolution","errorDetails","error","evt","CustomEvent","detail","type","containerId","dispatchEvent","getColorBrightness","color","rgb","startsWith","hex","parseInt","matches","match","map","Number","applyTimelineColors","config","nodeColor","lineColor","navColor","setProperty","arrowColor","setAttribute","createArrowSVG","direction","clampInt","value","min","max","isNaN","Math","updateDeepLinkUrl","timelineEl","history","params","has","timelineParam","shouldUpdateDeepLinkForTimeline","url","URL","href","searchParams","set","String","toString","replaceState","timeline","collection","options","timelines","warningLabel","resizeTimer","winWidth","innerWidth","currentIndex","defaultSettings","minWidth","defaultValue","maxWidth","horizontalStartPosition","acceptedValues","mode","moveItems","rtlMode","startIndex","verticalStartPosition","verticalTrigger","itemWrap","el","wrapper","classes","insertBefore","isElementInViewport","triggerPosition","rect","getBoundingClientRect","windowHeight","innerHeight","documentElement","clientHeight","defaultTrigger","triggerUnit","unit","triggerValue","trigger","top","left","clientWidth","addTransforms","transform","webkitTransform","msTransform","timelinePosition","tl","safeIndex","items","str","offsetLeft","scroller","updateActiveItem","item","setUpHorinzontalTimeline","constraints","default","availableHeight","requiredHeight","scaleFactor","scaleValue","scaled","round","calculateHorizontalScale","settings","computedStyle","getComputedStyle","nodeWidth","getPropertyValue","itemWidth","scrollerWidth","setWidths","oddIndexTallest","evenIndexTallest","offsetHeight","transformString","computedVisibleCount","floor","wrap","offsetWidth","setHeights","setHeightandWidths","itemsVisible","activeIndex","viewportWidth","prevArrow","nextArrow","topPosition","maxActiveIndex","addNavigation","divider","removeChild","horizontalDivider","addHorizontalDivider","navArrows","arrowPrev","arrowNext","maxScrollIndex","handleArrowClick","preventDefault","stopImmediatePropagation","this","nextActive","activeItem","blur","arrow","listeners","push","element","handler","slideTimeline","idx","activateHandler","setUpTimelines","opacity","removeEventListener","observer","disconnect","removeAttribute","resetTimelines","useHorizontalMode","lastVisibleIndex","observerOptions","rootMargin","threshold","IntersectionObserver","entries","entry","isIntersecting","target","observe","scrollHandler","setUpVerticalTimeline","timelineName","errorPart","data","dataset","Error","slice","call","Object","keys","candidate","undefined","minwidth","forceVerticalMode","forceverticalmode","maxwidth","settingName","getData","k","toLowerCase","triggerArray","triggerValid","hasAttribute","heading","trim","firstP","img","ensureInlineModalData","enhanceInlineItems","Date","now","random","substr","clearTimeout","newWinWidth","renderTimelineFromData","itemsWrap","layoutMode","applyDataAttributes","existingHeading","previousElementSibling","isArray","normalized","rawData","date","summary","dateEl","loading","onerror","headingEl","summaryEl","modalContent","contentFull","clean","sanitizeContent","createItemNode","timelineFromData","waitForImages","then","loadDataFromJson","cacheKey","cachedData","cachedTime","cached","localStorage","getItem","parsedCache","JSON","parse","timestamp","fetch","response","ok","statusText","json","jsonData","lastupdated","nodes","setItem","stringify","toISOString","dataToUse","assign","showTimelineTitle","catch","log","Promise","resolve","imgs","remaining","checkDone","complete","onSettled","clearTimelineCache","removeItem","cleared","processTimelineData","handleTimelineDeepLinking","navigateTimelineToNodeIndex","jsonUrl","split","selector","jQuery","fn","opts"],"mappings":"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"}